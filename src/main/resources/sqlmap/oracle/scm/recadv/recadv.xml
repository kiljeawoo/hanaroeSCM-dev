<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="recadvDAO">
	<resultMap id="RecadvMasterMap" type="com.nh.escm.scm.recadv.vo.RecadvMasterVO">
		<result column="RN" property="RN" />
		<result column="NA_BZPLC" property="NA_BZPLC" />
		<result column="NA_TEAM_C" property="NA_TEAM_C" />
		<result column="SLP_DT" property="SLP_DT" />
		<result column="NA_SLPNO" property="NA_SLPNO" />
		<result column="NA_CRC_CAN_DSC" property="NA_CRC_CAN_DSC" />
		<result column="BCLNTNM" property="BCLNTNM" />
		<result column="NA_DVY_PLASH_SLPNO" property="NA_DVY_PLASH_SLPNO" />
		<result column="CCLNTNM" property="CCLNTNM" />
		<result column="CNR_DT" property="CNR_DT" />
		<result column="TRSLPNO" property="TRSLPNO" />
		<result column="RPY_PLA_DT" property="RPY_PLA_DT" />
		<result column="GAM_AM" property="GAM_AM" />
		<result column="BYNG_VAT" property="BYNG_VAT" />
		<result column="TOT_GAM" property="TOT_GAM" />
		<result column="CHRG_TOT" property="CHRG_TOT" />
		<result column="VCBT_AM" property="VCBT_AM" />
		<result column="VCBX_AM" property="VCBX_AM" />
		<result column="CBAM" property="CBAM" />
		<result column="NA_TR_DSC" property="NA_TR_DSC" />
		<result column="ROTS_CTR_DSC" property="ROTS_CTR_DSC" />
		<result column="MNGT_NA_TRPL_C" property="MNGT_NA_TRPL_C" />
		<result column="ACTL_BUYPL_NA_TRPL_C" property="ACTL_BUYPL_NA_TRPL_C" />
		<result column="COMP_FEE" property="COMP_FEE" />
		<result column="BYNG_SSDY" property="BYNG_SSDY" />
		<result column="ETR_AMN_FEE" property="ETR_AMN_FEE" />
		<result column="ETR_AMN_VAT" property="ETR_AMN_VAT" />
		<result column="SLGT_AMN_FEE" property="SLGT_AMN_FEE" />
		<result column="PHD_FEE" property="PHD_FEE" />
		<result column="PHD_FEE_VAT" property="PHD_FEE_VAT" />
		<result column="TRP_SVC_CST" property="TRP_SVC_CST" />
		<result column="TRP_SVCOS_VAT" property="TRP_SVCOS_VAT" />
		<result column="ETC_FEE" property="ETC_FEE" />
		<result column="ETC_FEE_VAT" property="ETC_FEE_VAT" />
		<result column="ADJ_NA_BZPLC" property="ADJ_NA_BZPLC" />
		<result column="ADJ_NA_TRPL_C" property="ADJ_NA_TRPL_C" />
		<result column="FSRGMN_ENO" property="FSRGMN_ENO" />
		<result column="EDIRG_DTM" property="EDIRG_DTM" />
		<result column="FS_RMS_DT" property="FS_RMS_DT" />
		<result column="TOTAL_GAM_AM" property="TOTAL_GAM_AM" />
		<result column="TOTAL_BYNG_VAT" property="TOTAL_BYNG_VAT" />
		<result column="TOTAL_TOT_GAM" property="TOTAL_TOT_GAM" />
		<result column="TOTAL_CHRG_TOT" property="TOTAL_CHRG_TOT" />
		<result column="TOTAL_VCBT_AM" property="TOTAL_VCBT_AM" />
		<result column="TOTAL_VCBX_AM" property="TOTAL_VCBX_AM" />
		<result column="TOTAL_CBAM" property="TOTAL_CBAM" />
		<result column="TOTAL_COMP_FEE" property="TOTAL_COMP_FEE" />
		<result column="TOTAL_BYNG_SSDY" property="TOTAL_BYNG_SSDY" />
		<result column="TOTAL_ETR_AMN_FEE" property="TOTAL_ETR_AMN_FEE" />
		<result column="TOTAL_ETR_AMN_VAT" property="TOTAL_ETR_AMN_VAT" />
		<result column="TOTAL_SLGT_AMN_FEE" property="TOTAL_SLGT_AMN_FEE" />
		<result column="TOTAL_PHD_FEE" property="TOTAL_PHD_FEE" />
		<result column="TOTAL_PHD_FEE_VAT" property="TOTAL_PHD_FEE_VAT" />
		<result column="TOTAL_TRP_SVC_CST" property="TOTAL_TRP_SVC_CST" />
		<result column="TOTAL_TRP_SVCOS_VAT" property="TOTAL_TRP_SVCOS_VAT" />
		<result column="TOTAL_ETC_FEE" property="TOTAL_ETC_FEE" />
		<result column="TOTAL_ETC_FEE_VAT" property="TOTAL_ETC_FEE_VAT" />
		<result column="APPLICATION_ID" property="APPLICATION_ID" />
		<result column="PBDDLY_YN" property="PBDDLY_YN" />
		<result column="DVY_PLASH_CRT_DSC" property="DVY_PLASH_CRT_DSC" />
		<result column="CNFM_YN" property="CNFM_YN" />
	</resultMap>
	
	<resultMap id="RecadvDetailMap" type="com.nh.escm.scm.recadv.vo.RecadvDetailVO">
		<result column="RN" property="RN" />
		<result column="NA_WRS_C" property="NA_WRS_C" />
		<result column="WRSNM" property="WRSNM" />
		<result column="TXT_DSC" property="TXT_DSC" />
		<result column="A.BYAM" property="A.BYAM" />
		<result column="BYNG_UPR" property="BYNG_UPR" />
		<result column="BYNG_QT" property="BYNG_QT" />
		<result column="GAM_AM" property="GAM_AM" />
		<result column="BYNG_VAT" property="BYNG_VAT" />
		<result column="WRS_STDNM" property="WRS_STDNM" />
		<result column="VCBT_NA_WRS_C" property="VCBT_NA_WRS_C" />
		<result column="VCBT_QT" property="VCBT_QT" />
		<result column="VCBT_UPR" property="VCBT_UPR" />
		<result column="INPD_QT" property="INPD_QT" />
		<result column="PD_YY" property="PD_YY" />
		<result column="BYNG_WT" property="BYNG_WT" />
		<result column="RPY_PLA_DT" property="RPY_PLA_DT" />
		<result column="NA_BZPLC" property="NA_BZPLC" />
		<result column="NA_TEAM_C" property="NA_TEAM_C" />
		<result column="SLP_DT" property="SLP_DT" />
		<result column="NA_SLPNO" property="NA_SLPNO" />
		<result column="SLP_SQNO" property="SLP_SQNO" />
		<result column="BYNG_AM" property="BYNG_AM" />
		<result column="NA_WRS_UNT_C" property="NA_WRS_UNT_C" />
		<result column="CNR_DS_AM" property="CNR_DS_AM" />
	</resultMap>
	
	<!-- 검수 매입처별 맵 -->
	<resultMap id="RecadvMaster_NA_TRPL_C_Map" type="com.nh.escm.scm.recadv.vo.RecadvMaster_NA_TRPL_C_VO">
		<result column="RN" property="RN" />
		<result column="NA_BZPLC" property="NA_BZPLC" />
		<result column="NA_TEAM_C" property="NA_TEAM_C" />
		<result column="SLP_DT" property="SLP_DT" />
		<result column="NA_SLPNO" property="NA_SLPNO" />
		<result column="NA_CRC_CAN_DSC" property="NA_CRC_CAN_DSC" />
		<result column="BCLNTNM" property="BCLNTNM" />
		<result column="NA_DVY_PLASH_SLPNO" property="NA_DVY_PLASH_SLPNO" />
		<result column="CCLNTNM" property="CCLNTNM" />
		<result column="CNR_DT" property="CNR_DT" />
		<result column="TRSLPNO" property="TRSLPNO" />
		<result column="RPY_PLA_DT" property="RPY_PLA_DT" />
		<result column="GAM_AM" property="GAM_AM" />
		<result column="BYNG_VAT" property="BYNG_VAT" />
		<result column="TOT_GAM" property="TOT_GAM" />
		<result column="CHRG_TOT" property="CHRG_TOT" />
		<result column="VCBT_AM" property="VCBT_AM" />
		<result column="VCBX_AM" property="VCBX_AM" />
		<result column="CBAM" property="CBAM" />
		<result column="NA_TR_DSC" property="NA_TR_DSC" />
		<result column="ROTS_CTR_DSC" property="ROTS_CTR_DSC" />
		<result column="MNGT_NA_TRPL_C" property="MNGT_NA_TRPL_C" />
		<result column="ACTL_BUYPL_NA_TRPL_C" property="ACTL_BUYPL_NA_TRPL_C" />
		<result column="COMP_FEE" property="COMP_FEE" />
		<result column="BYNG_SSDY" property="BYNG_SSDY" />
		<result column="ETR_AMN_FEE" property="ETR_AMN_FEE" />
		<result column="ETR_AMN_VAT" property="ETR_AMN_VAT" />
		<result column="SLGT_AMN_FEE" property="SLGT_AMN_FEE" />
		<result column="PHD_FEE" property="PHD_FEE" />
		<result column="PHD_FEE_VAT" property="PHD_FEE_VAT" />
		<result column="TRP_SVC_CST" property="TRP_SVC_CST" />
		<result column="TRP_SVCOS_VAT" property="TRP_SVCOS_VAT" />
		<result column="ETC_FEE" property="ETC_FEE" />
		<result column="ETC_FEE_VAT" property="ETC_FEE_VAT" />
		<result column="ADJ_NA_BZPLC" property="ADJ_NA_BZPLC" />
		<result column="ADJ_NA_TRPL_C" property="ADJ_NA_TRPL_C" />
		<result column="FSRGMN_ENO" property="FSRGMN_ENO" />
		<result column="EDIRG_DTM" property="EDIRG_DTM" />
		<result column="FS_RMS_DT" property="FS_RMS_DT" />
		<result column="TOTAL_GAM_AM" property="TOTAL_GAM_AM" />
		<result column="TOTAL_BYNG_VAT" property="TOTAL_BYNG_VAT" />
		<result column="TOTAL_TOT_GAM" property="TOTAL_TOT_GAM" />
		<result column="TOTAL_CHRG_TOT" property="TOTAL_CHRG_TOT" />
		<result column="TOTAL_VCBT_AM" property="TOTAL_VCBT_AM" />
		<result column="TOTAL_VCBX_AM" property="TOTAL_VCBX_AM" />
		<result column="TOTAL_CBAM" property="TOTAL_CBAM" />
		<result column="TOTAL_COMP_FEE" property="TOTAL_COMP_FEE" />
		<result column="TOTAL_BYNG_SSDY" property="TOTAL_BYNG_SSDY" />
		<result column="TOTAL_ETR_AMN_FEE" property="TOTAL_ETR_AMN_FEE" />
		<result column="TOTAL_ETR_AMN_VAT" property="TOTAL_ETR_AMN_VAT" />
		<result column="TOTAL_SLGT_AMN_FEE" property="TOTAL_SLGT_AMN_FEE" />
		<result column="TOTAL_PHD_FEE" property="TOTAL_PHD_FEE" />
		<result column="TOTAL_PHD_FEE_VAT" property="TOTAL_PHD_FEE_VAT" />
		<result column="TOTAL_TRP_SVC_CST" property="TOTAL_TRP_SVC_CST" />
		<result column="TOTAL_TRP_SVCOS_VAT" property="TOTAL_TRP_SVCOS_VAT" />
		<result column="TOTAL_ETC_FEE" property="TOTAL_ETC_FEE" />
		<result column="TOTAL_ETC_FEE_VAT" property="TOTAL_ETC_FEE_VAT" />
		<result column="APPLICATION_ID" property="APPLICATION_ID" />
	</resultMap>
	
	<!-- 검수 상품별 맵 -->
	<resultMap id="RecadvMasterVO_WRS_Map" type="com.nh.escm.scm.recadv.vo.RecadvMasterVO_WRS">	
		<result column="NA_WRS_C" property="NA_WRS_C" />
		<result column="WRSNM" property="WRSNM" />
		<result column="WRS_STDNM" property="WRS_STDNM" />
		<result column="TXT_DSC" property="TXT_DSC" />
		<result column="TXT_DSC_NM" property="TXT_DSC_NM" />
		<result column="DANGA" property="DANGA" />
		<result column="BYNG_QT" property="BYNG_QT" />
		<result column="GAM_AM" property="GAM_AM" />
		<result column="BYNG_VAT" property="BYNG_VAT" />
		<result column="TOT_GAM" property="TOT_GAM" />
		<result column="CHRG_TOT" property="CHRG_TOT" />
		<result column="COMP_FEE" property="COMP_FEE" />
		<result column="BYNG_SSDY" property="BYNG_SSDY" />
		<result column="ETR_AMN_FEE" property="ETR_AMN_FEE" />
		<result column="ETR_AMN_VAT" property="ETR_AMN_VAT" />
		<result column="SLGT_AMN_FEE" property="SLGT_AMN_FEE" />
		<result column="PHD_FEE" property="PHD_FEE" />
		<result column="PHD_FEE_VAT" property="PHD_FEE_VAT" />
		<result column="TRP_SVC_CST" property="TRP_SVC_CST" />
		<result column="TRP_SVCOS_VAT" property="TRP_SVCOS_VAT" />
		<result column="ETC_FEE" property="ETC_FEE" />
		<result column="ETC_FEE_VAT" property="ETC_FEE_VAT" />
	</resultMap>
	
	
	<resultMap id="RecadvDirectMasterMap" type="com.nh.escm.scm.recadv.vo.RecadvDirectMasterVO">
		<result column="RN" property="RN" />
		<result column="NA_BZPLC" property="NA_BZPLC" />
		<result column="NA_TEAM_C" property="NA_TEAM_C" />
		<result column="SLP_DT" property="SLP_DT" />
		<result column="NA_SLPNO" property="NA_SLPNO" />
		<result column="BCLNTNM" property="BCLNTNM" />
		<result column="NA_DVY_PLASH_SLPNO" property="NA_DVY_PLASH_SLPNO" />
		<result column="CCLNTNM" property="CCLNTNM" />
		<result column="DDLY_CCLNTNM" property="DDLY_CCLNTNM" />
		<result column="CNR_DT" property="CNR_DT" />
		<result column="TRSLPNO" property="TRSLPNO" />
		<result column="RPY_PLA_DT" property="RPY_PLA_DT" />
		<result column="GAM_AM" property="GAM_AM" />
		<result column="BYNG_VAT" property="BYNG_VAT" />
		<result column="TOT_GAM" property="TOT_GAM" />
		<result column="CHRG_TOT" property="CHRG_TOT" />
		<result column="VCBT_AM" property="VCBT_AM" />
		<result column="VCBX_AM" property="VCBX_AM" />
		<result column="CBAM" property="CBAM" />
		<result column="NA_TR_DSC" property="NA_TR_DSC" />
		<result column="NA_CRC_CAN_DSC" property="NA_CRC_CAN_DSC" />
		<result column="ROTS_CTR_DSC" property="ROTS_CTR_DSC" />
		<result column="MNGT_NA_TRPL_C" property="MNGT_NA_TRPL_C" />
		<result column="ACTL_BUYPL_NA_TRPL_C" property="ACTL_BUYPL_NA_TRPL_C" />
		<result column="DDLY_BUYPL_NA_TRPL_C" property="DDLY_BUYPL_NA_TRPL_C" />
		<result column="COMP_FEE" property="COMP_FEE" />
		<result column="BYNG_SSDY" property="BYNG_SSDY" />
		<result column="ETR_AMN_FEE" property="ETR_AMN_FEE" />
		<result column="ETR_AMN_VAT" property="ETR_AMN_VAT" />
		<result column="SLGT_AMN_FEE" property="SLGT_AMN_FEE" />
		<result column="PHD_FEE" property="PHD_FEE" />
		<result column="PHD_FEE_VAT" property="PHD_FEE_VAT" />
		<result column="TRP_SVC_CST" property="TRP_SVC_CST" />
		<result column="TRP_SVCOS_VAT" property="TRP_SVCOS_VAT" />
		<result column="ETC_FEE" property="ETC_FEE" />
		<result column="ETC_FEE_VAT" property="ETC_FEE_VAT" />
		<result column="FSRGMN_ENO" property="FSRGMN_ENO" />
		<result column="EDIRG_DTM" property="EDIRG_DTM" />
		<result column="FS_RMS_DT" property="FS_RMS_DT" />
		<result column="TOTAL_GAM_AM" property="TOTAL_GAM_AM" />
		<result column="TOTAL_BYNG_VAT" property="TOTAL_BYNG_VAT" />
		<result column="TOTAL_TOT_GAM" property="TOTAL_TOT_GAM" />
		<result column="TOTAL_CHRG_TOT" property="TOTAL_CHRG_TOT" />
		<result column="TOTAL_VCBT_AM" property="TOTAL_VCBT_AM" />
		<result column="TOTAL_VCBX_AM" property="TOTAL_VCBX_AM" />
		<result column="TOTAL_CBAM" property="TOTAL_CBAM" />
		<result column="TOTAL_COMP_FEE" property="TOTAL_COMP_FEE" />
		<result column="TOTAL_BYNG_SSDY" property="TOTAL_BYNG_SSDY" />
		<result column="TOTAL_ETR_AMN_FEE" property="TOTAL_ETR_AMN_FEE" />
		<result column="TOTAL_ETR_AMN_VAT" property="TOTAL_ETR_AMN_VAT" />
		<result column="TOTAL_SLGT_AMN_FEE" property="TOTAL_SLGT_AMN_FEE" />
		<result column="TOTAL_PHD_FEE" property="TOTAL_PHD_FEE" />
		<result column="TOTAL_PHD_FEE_VAT" property="TOTAL_PHD_FEE_VAT" />
		<result column="TOTAL_TRP_SVC_CST" property="TOTAL_TRP_SVC_CST" />
		<result column="TOTAL_TRP_SVCOS_VAT" property="TOTAL_TRP_SVCOS_VAT" />
		<result column="TOTAL_ETC_FEE" property="TOTAL_ETC_FEE" />
		<result column="TOTAL_ETC_FEE_VAT" property="TOTAL_ETC_FEE_VAT" />
		<result column="APPLICATION_ID" property="APPLICATION_ID" />
	</resultMap>
	
	<resultMap id="RecadvDirectDetailMap" type="com.nh.escm.scm.recadv.vo.RecadvDirectDetailVO">
		<result column="RN" property="RN" />
		<result column="NA_BZPLC" property="NA_BZPLC" />
		<result column="NA_TEAM_C" property="NA_TEAM_C" />
		<result column="SLP_DT" property="SLP_DT" />
		<result column="NA_SLPNO" property="NA_SLPNO" />
		<result column="SLP_SQNO" property="SLP_SQNO" />
		<result column="NA_WRS_C" property="NA_WRS_C" />
		<result column="PD_YY" property="PD_YY" />
		<result column="WRSNM" property="WRSNM" />
		<result column="TXT_DSC" property="TXT_DSC" />
		<result column="BYAM" property="BYAM" />
		<result column="BYNG_WT" property="BYNG_WT" />
		<result column="INPD_QT" property="INPD_QT" />
		<result column="BYNG_UPR" property="BYNG_UPR" />
		<result column="BYNG_QT" property="BYNG_QT" />
		<result column="GAM_AM" property="GAM_AM" />
		<result column="BYNG_VAT" property="BYNG_VAT" />
		<result column="WRS_STDNM" property="WRS_STDNM" />
		<result column="BYNG_AM" property="BYNG_AM" />
		<result column="NA_WRS_UNT_C" property="NA_WRS_UNT_C" />
		<result column="CNR_DS_AM" property="CNR_DS_AM" />
	</resultMap>
	
	<resultMap id="TbCmBzplMap" type="com.nh.escm.common.vo.TbCmBzplVO">
		<result column="NA_BZPLC" property="NA_BZPLC" />
		<result column="SHRT_BZPLNM" property="SHRT_BZPLNM" />
		<result column="BZPL_TPC" property="BZPL_TPC" />
		<result column="BZPL_DTI_TPC" property="BZPL_DTI_TPC" />
		<result column="BZPL_TPNM" property="BZPL_TPNM" />
		<result column="BZPL_DTI_TPNM" property="BZPL_DTI_TPNM" />
		
	</resultMap>
	
	<!-- 검수실적 수수료 내역 -->
	<select id="retrieveCommissionList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT 
			SLP_SQNO,
			NA_FEE_C,			
			NVL(FEENM,'기타') FEENM, /* 수수료명 */			
			(NVL(#{CNR_DS_AM},0)*(SPY_AM - TXT_VAT)) SPY_AM_VAT,
			SPY_AM,
			(NVL(#{CNR_DS_AM},0)*TXT_VAT) AS TXT_VAT
			<!-- ,			
			FEE_ACG_ACCC, /*수수료회계계정코드*/
			BZPL_ACCNM AS FEE_ACCOUNT /*수수료계정명*/ -->
		FROM TB_BY_BYNG_FEE
		WHERE NA_BZPLC = #{NA_BZPLC}
		AND NA_TEAM_C = #{NA_TEAM_C}
		AND SLP_DT = #{SLP_DT}
		AND NA_SLPNO = #{NA_SLPNO}
		AND SLP_SQNO = #{SLP_SQNO}
		AND (SPY_AM > 0 OR TXT_VAT > 0)
	</select>
	
	<!-- 검수실적-전표별 마스터조회 -->
	<sql id="sql_retrieveRecadvSlpMasterList_backup">
	with temp_tab as (
		SELECT /*+ leading(a wrs d b c tc f) use_nl(a wrs d d b c tc f) */
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO			
			,DECODE(A.NA_CRC_CAN_DSC,'2','[2] 정정','3','[3] 취소', '[' || A.NA_CRC_CAN_DSC || '] 정상') NA_CRC_CAN_DSC
			,C.CLNTNM CCLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			
			<!--,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/ -->
			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/

			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/

			
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC			
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			
			<!-- ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/  배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			<!-- ,'DESADV' FSRGMN_ENO -->
			<!-- ,NVL(MIN(A.DVYAA_NA_TRPL_C     ),' ')    DVYAA_NA_TRPL_C -->
			,NVL(MIN(A.DVYAA_NA_TRPL_C     ),A.NA_BZPLC)    DVYAA_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
		FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>				
		GROUP BY
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.NA_CRC_CAN_DSC
			,C.CLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			<!-- ,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처명*/ -->
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,WRS.RPY_PLA_DT
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)	
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
			,A.BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*실매입처(농협)*/			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			,A.NA_BZPLC 
			,A.NA_TEAM_C 
			,A.SLP_DT                      
            ,A.NA_SLPNO
            ,WRS.SLP_SQNO
	)
	SELECT 
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.NA_CRC_CAN_DSC,
		A.CCLNTNM,
		A.NA_DVY_PLASH_SLPNO,
		<!-- BCLNTNM, -->
		B.CLNTNM BCLNTNM /*실매입처명*/,
		A.CNR_DT,
		A.TRSLPNO,
		A.RPY_PLA_DT,
		SUM(A.BYAM-A.BYNG_VAT) GAM_AM,
		SUM(A.BYNG_VAT) BYNG_VAT,
		SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM,
		SUM(A.CHRG_TOT) CHRG_TOT,
		SUM(A.VCBT_AM) VCBT_AM,
		SUM(A.VCBX_AM) VCBX_AM,
		SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM)-(A.CHRG_TOT)) CBAM,
		A.NA_TR_DSC,
		A.ROTS_CTR_DSC,
		A.ACTL_BUYPL_NA_TRPL_C,
		A.MNGT_NA_TRPL_C,
		SUM(A.COMP_FEE) COMP_FEE,
		SUM(A.BYNG_SSDY) BYNG_SSDY,
		SUM(A.ETR_AMN_FEE) ETR_AMN_FEE,
		SUM(A.ETR_AMN_VAT) ETR_AMN_VAT,
		SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE,
		SUM(A.PHD_FEE) PHD_FEE,
		SUM(A.PHD_FEE_VAT) PHD_FEE_VAT,
		SUM(A.TRP_SVC_CST) TRP_SVC_CST,
		SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT,
		SUM(A.ETC_FEE) ETC_FEE,
		SUM(A.ETC_FEE_VAT) ETC_FEE_VAT,
		A.ADJ_NA_BZPLC,
		A.ADJ_NA_TRPL_C,
		<!-- A.FSRGMN_ENO, -->
		MIN(Y.fsrgmn_eno) FSRGMN_ENO,
		A.EDIRG_DTM,
		A.FS_RMS_DT
	FROM
	temp_tab A
	, TB_TR_TRPL_CIF B
	, TB_OD_DLVPNSHT_M Y              
	WHERE 1=1
	AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
	<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
		<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
			AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
		</if>
	</if>
	AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
	AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
	AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
		GROUP BY
			A.NA_BZPLC,
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO,
			A.NA_CRC_CAN_DSC,
			A.CCLNTNM,
			A.NA_DVY_PLASH_SLPNO,
			B.CLNTNM,
			A.CNR_DT,
			A.TRSLPNO,
			A.RPY_PLA_DT,
			A.NA_TR_DSC,
			A.ROTS_CTR_DSC,
			A.ACTL_BUYPL_NA_TRPL_C,
			A.MNGT_NA_TRPL_C,
			A.ADJ_NA_BZPLC,
			A.ADJ_NA_TRPL_C,		
			A.EDIRG_DTM,
			A.FS_RMS_DT	
	</sql>
	
	<!-- 검수실적-전표별 마스터조회 -->
	<sql id="sql_retrieveRecadvSlpMasterList">
		SELECT /** 검수실적-전표별 마스터조회(sql_retrieveRecadvSlpMasterList) */
		       A.*
			 , B.FSRGMN_ENO
			 , B.EDIRG_DTM
			 , B.FS_RMS_DT
			 , DECODE(B.PBDDLY_YN, '1', 'PB직송', '일반') AS PBDDLY_YN /* 배송예정서 PB직송구분 */
			 , DECODE(B.DVY_PLASH_CRT_DSC, '002', '혁신', '일반') AS DVY_PLASH_CRT_DSC /* 배송예정서 혁신구분 */
		  FROM ( SELECT 
						MIN(A.NA_BZPLC) AS NA_BZPLC
					  , MIN(A.NA_TEAM_C) AS NA_TEAM_C
					  , A.TR_DT AS SLP_DT
					  , A.NA_SLPNO AS NA_SLPNO
					  , '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC										/* 정정취소구분 */
					  , FN_TRPL_CIF_NM(MIN(A.NA_TRPL_C)) AS CCLNTNM					/* 본/지사명 */
					  , A.NA_DVY_PLASH_SLPNO										/* 배송예정서번호 */
					  , FN_TRPL_CIF_NM(A.ACTL_BUYPL_NA_TRPL_C) AS BCLNTNM			/* 실매입처명 */
					  , MIN(A.CNR_DT) AS CNR_DT										/* 검수일자 */
					  , TO_CHAR(TO_DATE(A.TR_DT), 'YYYY-MM-DD') || '-' || A.NA_SLPNO AS TRSLPNO
					  , A.PY_PLA_DT AS RPY_PLA_DT									/* 지급예정일 */
					  , SUM(A.BYAM - A.BYNG_VAT) AS GAM_AM							/* 공급금액(A) */
					  , SUM(A.BYNG_VAT) AS BYNG_VAT									/* 부가세(B) */
					  , SUM(A.BYAM) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM) AS TOT_GAM	/* 총공급금액(C=A+B+E+F) */
					  , SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) + SUM(A.TRP_SVC_CST) + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) AS CHRG_TOT	/* 총공제금액(D=P~Y) */
					  , SUM(A.VCBT_AM) AS VCBT_AM									/* 공병금액(E) */
					  , SUM(A.VCBX_AM) AS VCBX_AM									/* 공상자금액(F) */
					  , SUM(A.BYAM) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM)
						- ( SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) + SUM(A.TRP_SVC_CST) + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) ) AS CBAM	/* 순공급금액(G=C-D) */
					  , CASE 
							 WHEN A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04') THEN '매출'
							 WHEN A.NA_TR_DSC = '' OR A.NA_TR_DSC IS NULL THEN ''
							 ELSE '반품'
						END AS NA_TR_DSC											/* 거래구분 */
					  , CASE 
							 WHEN M.DOC_NAME = 'CONADV' AND M.FS_RMS_DT IS NULL THEN '검수미확인'
							 WHEN M.DOC_NAME = 'CONRET' AND M.FS_RMS_DT IS NULL THEN '반품미확인'
							 WHEN M.DOC_NAME = 'CONADV' AND M.FS_RMS_DT IS NOT NULL THEN '검수확인'
							 WHEN M.DOC_NAME = 'CONRET' AND M.FS_RMS_DT IS NOT NULL THEN '반품확인'
						END AS CNFM_YN											/* 확인여부 */
					  , '[' || MIN(A.ROTS_CTR_DSC) || '] ' || FN_CM_SIMP_CNM('ROTS_CTR_DSC', MIN(A.ROTS_CTR_DSC)) AS ROTS_CTR_DSC	/* 계통구분 */
					  , MIN(A.NA_TRPL_C) AS ACTL_BUYPL_NA_TRPL_C					/* 본/지사코드 */
					  , MIN(A.ACTL_BUYPL_NA_TRPL_C) AS MNGT_NA_TRPL_C				/* 실매입처(농협) */
					  , SUM(A.COMP_FEE) AS COMP_FEE									/* 업체수수료(O=P+Q+R+S) */
					  , SUM(A.BYNG_SSDY) AS BYNG_SSDY								/* 매입장려금(P) */
					  , SUM(A.ETR_AMN_FEE) AS ETR_AMN_FEE							/* 관리수수료R2(Q) */
					  , SUM(A.ETR_AMN_VAT) AS ETR_AMN_VAT							/* 관리부가세R2(R) */
					  , SUM(A.SLGT_AMN_FEE) AS SLGT_AMN_FEE							/* 관리수수료R1(S) */
					  , SUM(A.PHD_FEE) AS PHD_FEE									/* 물류수수료(T) */
					  , SUM(A.PHD_FEE_VAT) AS PHD_FEE_VAT							/* 물류부가세(U) */
					  , SUM(A.TRP_SVC_CST) AS TRP_SVC_CST							/* 운송용역비(V) */
					  , SUM(A.TRP_SVCOS_VAT) AS TRP_SVCOS_VAT						/* 운송부가세(W) */
					  , SUM(A.ETC_FEE) AS ETC_FEE									/* 기타수수료(X) */
					  , SUM(A.ETC_FEE_VAT) AS ETC_FEE_VAT							/* 기타부가세(Y) */
					  , MIN(A.ADJ_NA_BZPLC) AS ADJ_NA_BZPLC							/* 정산사업장코드 */
					  , MIN(A.NA_ADJPL_C) AS ADJ_NA_TRPL_C							/* 정산처코드 */
					  , A.DVYAA_NA_TRPL_C AS DVYAA_NA_TRPL_C						/* 배송지코드 */
					  ,	A.APPLICATION_ID											/* XML 문서번호 */
				   FROM TB_DP_CM_SLP_CNR_RZS A
				      , TB_BY_BYNG_M M
				  WHERE A.NA_TRPL_C IN 
				<foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach> 
				<choose>
					<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.TR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
					</when>
					<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
					</when>
					<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.PY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
					</when>
				</choose>
				<choose>
					<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					AND A.NA_TR_DSC <![CDATA[ <> ]]> 'ID01'
					</when>
					<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
					</when>
					<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
					</when>
					<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
					</when>
					<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
					</when>
				</choose>
				<choose>
					<when test="CNFM_YN == null or CNFM_YN == ''">
						AND A.NA_TRPL_C = M.BUYPL_NA_TRPL_C
						AND A.TR_DT = M.SLP_DT
						AND A.NA_TEAM_C = M.NA_TEAM_C
						AND A.NA_SLPNO = M.NA_SLPNO
						AND A.NA_BZPLC = M.NA_BZPLC
					</when>
					<when test="CNFM_YN == '1'.toString()">
						AND A.NA_TRPL_C = M.BUYPL_NA_TRPL_C
						AND A.TR_DT = M.SLP_DT
						AND A.NA_TEAM_C = M.NA_TEAM_C
						AND A.NA_SLPNO = M.NA_SLPNO
						AND A.NA_BZPLC = M.NA_BZPLC
						AND M.DOC_NAME IN ('CONADV')
						AND M.FS_RMS_DT IS NULL
					</when>
					<when test="CNFM_YN == '2'.toString()">
						AND A.NA_TRPL_C = M.BUYPL_NA_TRPL_C
						AND A.TR_DT = M.SLP_DT
						AND A.NA_TEAM_C = M.NA_TEAM_C
						AND A.NA_SLPNO = M.NA_SLPNO
						AND A.NA_BZPLC = M.NA_BZPLC
						AND M.DOC_NAME IN ('CONRET')
						AND M.FS_RMS_DT IS NULL
					</when>
					<when test="CNFM_YN == '3'.toString()">
						AND A.NA_TRPL_C = M.BUYPL_NA_TRPL_C
						AND A.TR_DT = M.SLP_DT
						AND A.NA_TEAM_C = M.NA_TEAM_C
						AND A.NA_SLPNO = M.NA_SLPNO
						AND A.NA_BZPLC = M.NA_BZPLC
						AND M.DOC_NAME IN ('CONRET', 'CONADV')
						AND M.FS_RMS_DT IS NULL
					</when>
				</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				  GROUP BY A.NA_CRC_CAN_DSC
						 , A.ACTL_BUYPL_NA_TRPL_C
						 , A.TR_DT
						 , A.NA_SLPNO
						 , A.NA_DVY_PLASH_SLPNO
						 , A.DVYAA_NA_TRPL_C
						 , A.PY_PLA_DT
						 , A.NA_TR_DSC
						 , M.DOC_NAME
						 , M.FS_RMS_DT
						 , A.APPLICATION_ID
				  ORDER BY A.DVYAA_NA_TRPL_C
						 , A.NA_DVY_PLASH_SLPNO
			   ) A
			 , TB_OD_DLVPNSHT_M B
		 WHERE A.NA_DVY_PLASH_SLPNO = B.NA_DVY_PLASH_SLPNO(+)
		   AND A.ACTL_BUYPL_NA_TRPL_C = B.SPYPL_NA_TRPL_C(+)
		   AND A.MNGT_NA_TRPL_C = B.DVYAA_NA_TRPL_C(+)
		<if test="@org.apache.commons.lang.StringUtils@isNotEmpty(NA_BZPLC) and @org.apache.commons.lang.StringUtils@isNotEmpty(IS_NA_ALL) and IS_NA_ALL == '2'.toString()">
		   AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
		</if>
		
		   AND B.DVY_PLA_DT(+) > TO_CHAR( TO_DATE(a.slp_dt, 'YYYYMMDD') - 190, 'YYYYMMDD') /* 검수일로부터 6개월 이전 배송예정서만 조회 하도록 제한. */
		    
	</sql>
	
	<!-- 검수실적-매입처별 마스터조회 -->
	<sql id="sql_retrieveRecadvSlpMasterList_NA_TRPL_C">
	with temp_tab as (
		SELECT /*+ leading(a wrs d b c tc f) use_nl(a wrs d d b c tc f) */
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			, '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC
			,C.CLNTNM CCLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			
			<!--,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/ -->
			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/

			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/

			
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC			
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			
			<!-- ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/  배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			<!-- ,'DESADV' FSRGMN_ENO -->
			<!-- ,NVL(MIN(A.DVYAA_NA_TRPL_C     ),' ')    DVYAA_NA_TRPL_C -->
			,NVL(MIN(A.DVYAA_NA_TRPL_C     ),A.NA_BZPLC)    DVYAA_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			
			, nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.liq_yn='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end     ),0)    liq_spy_am /*주류금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.liq_yn='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byng_vat end ),0)    liq_vat /*주류부가세*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='2' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    extx_am /*면세금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='3' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    sma_am /*영세금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    txt_am  /*과세금액*/
        
		FROM TB_BY_BYNG_M A,
			TB_BY_BYNG_WRS WRS,
			TB_BY_BYNG_FEE D,
			TB_TR_TRPL_CIF B,
			TB_TR_TRPL_CIF C,
			TB_CM_SIMPC TC,
			TB_CM_BZPL F                  
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
		GROUP BY
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.NA_CRC_CAN_DSC
			,C.CLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			<!-- ,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처명*/ -->
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,WRS.RPY_PLA_DT
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)	
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
			,A.BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*실매입처(농협)*/			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			,A.NA_BZPLC 
			,A.NA_TEAM_C 
			,A.SLP_DT                      
            ,A.NA_SLPNO
            ,WRS.SLP_SQNO
	)
	SELECT /*+ use_nl(a b) */		
		A.CCLNTNM /*본지사명*/		
		, B.CLNTNM BCLNTNM /*사업장명*/
		, SUM(A.BYAM-A.BYNG_VAT) GAM_AM /*공급금액*/
		, SUM(A.BYNG_VAT) BYNG_VAT /*부가세*/
		, SUM(A.VCBT_AM) VCBT_AM /*공병금액*/
		, SUM(A.VCBX_AM) VCBX_AM /*공상자금액*/
		, SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM /*총공급금액*/
		, SUM(A.CHRG_TOT) CHRG_TOT /*총공제금액*/		
		, SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM)-(A.CHRG_TOT)) CBAM /*순공급금액*/		
		, A.ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
		, A.MNGT_NA_TRPL_C /*사업장코드*/
		, SUM(A.COMP_FEE) COMP_FEE /*업체별수수료*/
		, SUM(A.BYNG_SSDY) BYNG_SSDY /*매입장려금*/
		, SUM(A.ETR_AMN_FEE) ETR_AMN_FEE /*관리수수료*/
		, SUM(A.ETR_AMN_VAT) ETR_AMN_VAT /*관리부가세*/
		, SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE /*관리수수료*/
		, SUM(A.PHD_FEE) PHD_FEE /*물류수수료*/
		, SUM(A.PHD_FEE_VAT) PHD_FEE_VAT /*물류부가세*/
		, SUM(A.TRP_SVC_CST) TRP_SVC_CST /*운송용역비*/
		, SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT /*운송부가세*/
		, SUM(A.ETC_FEE) ETC_FEE /*기타수수료*/
		, SUM(A.ETC_FEE_VAT) ETC_FEE_VAT /*기타수수료부가세*/
		
		, SUM(A.BYAM)-SUM(A.BYNG_VAT)-SUM(A.EXTX_AM)-SUM(A.SMA_AM)-(SUM(A.LIQ_SPY_AM)-SUM(A.LIQ_VAT)) GWA_AM /*과세공급*/
		, SUM(A.BYNG_VAT)-SUM(A.LIQ_VAT) GWA_VAT /*과세부가세*/
		, SUM(A.LIQ_SPY_AM)-SUM(A.LIQ_VAT) LIQ_GAM /*주류공급*/
		, SUM(A.LIQ_VAT)  LIQ_VAT /*주류부가세*/
		, SUM(A.EXTX_AM)  EXTX_AM /*면세금액*/
		, SUM(A.SMA_AM)  SMA_AM /*영세금액*/
	FROM
	temp_tab A
	, TB_TR_TRPL_CIF B	              
	WHERE 1=1
	AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
	<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 배송지여야 함, DVYAA_NA_TRPL_C -->
		<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">				
			AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
		</if>	
	</if>
		GROUP BY			
			A.CCLNTNM,			
			B.CLNTNM,			
			A.ACTL_BUYPL_NA_TRPL_C,
			A.MNGT_NA_TRPL_C				
	</sql>
	
	<!-- 검수실적-매입처별 마스터 페이지 추가 쿼리 -->	
	<select id="retrieveRecadvSlpMasterList_NA_TRPL_C" parameterType="java.util.Map" resultMap="RecadvMaster_NA_TRPL_C_Map">
		<bind name="sortName" value="'ACTL_BUYPL_NA_TRPL_C ,MNGT_NA_TRPL_C'" />
		<bind name="sortType" value="'asc'" />            
		
		<include refid="common.paging_start" />
		<include refid="sql_retrieveRecadvSlpMasterList_NA_TRPL_C" />
		<include refid="common.paging_end" />
	</select>
	
	<!-- 검수실적-매입처별 마스터 엑셀쿼리 -->	
	<select id="downloadExcelRecadvSlp_NA_TRPL_C_M_backup" parameterType="java.util.Map" resultType="java.util.Map">
		with temp_tab as (
		SELECT /*+ leading(a wrs d b c tc f) use_nl(a wrs d d b c tc f) */
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO			
			,DECODE(A.NA_CRC_CAN_DSC,'2','[2] 정정','3','[3] 취소', '[' || A.NA_CRC_CAN_DSC || '] 정상') NA_CRC_CAN_DSC
			,C.CLNTNM CCLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			
			<!--,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/ -->
			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/

			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/

			
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC			
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			
			<!-- ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/  배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			<!-- ,'DESADV' FSRGMN_ENO -->
			<!-- ,NVL(MIN(A.DVYAA_NA_TRPL_C     ),' ')    DVYAA_NA_TRPL_C -->
			,NVL(MIN(A.DVYAA_NA_TRPL_C     ),A.NA_BZPLC)    DVYAA_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			
			, nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.liq_yn='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end     ),0)    liq_spy_am /*주류금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.liq_yn='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byng_vat end ),0)    liq_vat /*주류부가세*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='2' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    extx_am /*면세금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='3' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    sma_am /*영세금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    txt_am  /*과세금액*/
                     
			FROM TB_BY_BYNG_M A,
				TB_BY_BYNG_WRS WRS,
				TB_BY_BYNG_FEE D,
				TB_TR_TRPL_CIF B,
				TB_TR_TRPL_CIF C,
				TB_CM_SIMPC TC,
				TB_CM_BZPL F		
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
		GROUP BY
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.NA_CRC_CAN_DSC
			,C.CLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			<!-- ,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처명*/ -->
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,WRS.RPY_PLA_DT
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)	
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
			,A.BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*실매입처(농협)*/			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			,A.NA_BZPLC 
			,A.NA_TEAM_C 
			,A.SLP_DT                      
            ,A.NA_SLPNO
            ,WRS.SLP_SQNO
	)
	SELECT /*+ use_nl(a b) */	
		DECODE(X.seq, '2', A.ACTL_BUYPL_NA_TRPL_C||B.NA_USR_SYS_KDC, '3', A.ACTL_BUYPL_NA_TRPL_C||B.NA_USR_SYS_KDC, NULL) ACTL_BUYPL_NA_TRPL_C /*매출처 코드(본지사)*/
		, DECODE(x.seq, '1','',MIN(A.CCLNTNM)) ACTL_BUYPL_NA_TRPL_C_NM /*매출처 명(본지사)*/
		, DECODE(X.seq, '1', NULL, '3', NULL, A.MNGT_NA_TRPL_C) MNGT_NA_TRPL_C /*매입처 코드 (농협 사업장)*/
		, DECODE(x.seq, '1', '합계', '3', '소계', MIN(B.CLNTNM)) MNGT_NA_TRPL_C_NM /*매입처 명(농협 사업장)*/      
		, SUM(A.BYAM-A.BYNG_VAT) GAM_AM /*공급금액*/
		, SUM(A.BYNG_VAT) BYNG_VAT /*부가세*/
		, SUM(A.VCBT_AM) VCBT_AM /*공병금액*/
		, SUM(A.VCBX_AM) VCBX_AM /*공상자금액*/
		, SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM /*총공급금액*/
		, SUM(A.CHRG_TOT) CHRG_TOT /*총공제금액*/		
		, SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM)-(A.CHRG_TOT)) CBAM /*순공급금액*/
		, SUM(A.BYAM)-SUM(A.BYNG_VAT)-SUM(A.EXTX_AM)-SUM(A.SMA_AM)-(SUM(A.LIQ_SPY_AM)-SUM(A.LIQ_VAT)) GWA_AM /*과세공급*/
		, SUM(A.BYNG_VAT)-SUM(A.LIQ_VAT) GWA_VAT /*과세부가세*/
		, SUM(A.LIQ_SPY_AM)-SUM(A.LIQ_VAT) LIQ_GAM /*주류공급*/
		, SUM(A.LIQ_VAT)  LIQ_VAT /*주류부가세*/
		, SUM(A.EXTX_AM)  EXTX_AM /*면세금액*/
		, SUM(A.SMA_AM)  SMA_AM /*영세금액*/
		, SUM(A.COMP_FEE) COMP_FEE /*업체별수수료*/      
		, SUM(A.ETR_AMN_FEE) ETR_AMN_FEE /*관리수수료*/
		, SUM(A.ETR_AMN_VAT) ETR_AMN_VAT /*관리부가세*/
		, SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE /*관리수수료*/
		, SUM(A.PHD_FEE) PHD_FEE /*물류수수료*/
		, SUM(A.PHD_FEE_VAT) PHD_FEE_VAT /*물류부가세*/
		, SUM(A.TRP_SVC_CST) TRP_SVC_CST /*운송용역비*/
		, SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT /*운송부가세*/
		, SUM(A.ETC_FEE) ETC_FEE /*기타수수료*/
		, SUM(A.ETC_FEE_VAT) ETC_FEE_VAT /*기타수수료부가세*/
		, SUM(A.BYNG_SSDY) BYNG_SSDY /*매입장려금*/              
		, 0 ACRV /*미수금*/
		, 0 PPYAM /*선급금*/
		, 0 PPYAM_INT /*선급금이자*/
		, 0 AST_SAM /*보조금*/
		, 0 CSH_AM /*현금금액*/
		, 0 TFR_AM /*대체금액*/
		, 0 AC_FTR_AM /*계좌이체금액*/
		, 0 FC_AM /* 외화금액*/
	FROM
	temp_tab A
	, TB_TR_TRPL_CIF B
	, (SELECT LEVEL seq FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> 3) X          
	WHERE 1=1
	AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
	<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 배송지여야 함, DVYAA_NA_TRPL_C -->
		<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">				
			AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
		</if>	
	</if>
	GROUP BY 
		DECODE(X.seq, '2', A.ACTL_BUYPL_NA_TRPL_C||B.NA_USR_SYS_KDC, '3', A.ACTL_BUYPL_NA_TRPL_C||B.NA_USR_SYS_KDC, NULL)
		 , X.seq
		 , DECODE(X.seq, '1', NULL, '3', NULL, A.MNGT_NA_TRPL_C)
	ORDER BY DECODE(X.seq, 1, 1, 2), 1,3
	</select>
	
	<!-- 검수실적-매입처별 마스터 엑셀쿼리 -->	
	<sql id="sql_recadvSlp_NA_TRPL_C_M">
		SELECT 
		    DECODE(X.seq, '2', A.ACTL_BUYPL_NA_TRPL_C||B.NA_USR_SYS_KDC, '3', A.ACTL_BUYPL_NA_TRPL_C||B.NA_USR_SYS_KDC, NULL) ACTL_BUYPL_NA_TRPL_C2,
		    DECODE(x.seq, '1','',MIN(A.CCLNTNM)) ACTL_BUYPL_NA_TRPL_C_NM,
		    DECODE(X.seq, '1', NULL, '3', NULL, A.MNGT_NA_TRPL_C) MNGT_NA_TRPL_C,
		    DECODE(x.seq, '1', '합계', '3', '소계', MIN(B.CLNTNM)) MNGT_NA_TRPL_C_NM,
		    DECODE(X.seq, '2', MIN(A.ACTL_BUYPL_NA_TRPL_C), '3', MIN(A.ACTL_BUYPL_NA_TRPL_C), NULL) ACTL_BUYPL_NA_TRPL_C,
		    SUM(A.GAM_AM) GAM_AM,
		    SUM(A.BYNG_VAT) BYNG_VAT,
		    SUM(A.VCBT_AM) VCBT_AM, 
		    SUM(A.VCBX_AM) VCBX_AM,
		    SUM(A.TOT_GAM) TOT_GAM,
		    SUM(A.CHRG_TOT) CHRG_TOT,
		    SUM(A.CBAM) CBAM,
		    SUM(A.GWA_AM) GWA_AM,
		    SUM(A.GWA_VAT) GWA_VAT,
		    SUM(A.LIQ_GAM) LIQ_GAM,
		    SUM(A.LIQ_VAT) LIQ_VAT,
		    SUM(A.EXTX_AM) EXTX_AM,
		    SUM(A.SMA_AM) SMA_AM,
		    SUM(A.COMP_FEE) COMP_FEE,
		    SUM(A.ETR_AMN_FEE) ETR_AMN_FEE, 
		    SUM(A.ETR_AMN_VAT) ETR_AMN_VAT,
		    SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE, 
		    SUM(A.PHD_FEE) PHD_FEE, 
		    SUM(A.PHD_FEE_VAT) PHD_FEE_VAT,
		    SUM(A.TRP_SVC_CST) TRP_SVC_CST, 
		    SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT, 
		    SUM(A.ETC_FEE) ETC_FEE, 
		    SUM(A.ETC_FEE_VAT) ETC_FEE_VAT,
		    SUM(A.BYNG_SSDY) BYNG_SSDY,
		    0 ACRV, 
		    0 PPYAM, 
		    0 PPYAM_INT, 
		    0 AST_SAM, 
		    0 CSH_AM, 
		    0 TFR_AM, 
		    0 AC_FTR_AM, 
		    0 FC_AM
		FROM 
		(
		SELECT        
		          MIN(A.NA_BZPLC) NA_BZPLC, 
		          MIN(A.NA_TEAM_C) NA_TEAM_C, 
		          A.TR_DT SLP_DT, 
		          A.NA_SLPNO NA_SLPNO, 
		          '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC, 
		          FN_TRPL_CIF_NM(MIN(A.NA_TRPL_C)) CCLNTNM, 
		          A.NA_DVY_PLASH_SLPNO, 
		          FN_TRPL_CIF_NM(A.ACTL_BUYPL_NA_TRPL_C) BCLNTNM, 
		          MIN(A.CNR_DT) CNR_DT, 
		          SUBSTR(A.TR_DT,1,4)||'-'||SUBSTR(A.TR_DT,5,2)||'-'|| SUBSTR(A.TR_DT,7,2)||'-'|| A.NA_SLPNO TRSLPNO, 
		          A.PY_PLA_DT RPY_PLA_DT, 
		          SUM(A.byam-A.byng_vat) GAM_AM, 
		          SUM(A.byng_vat) BYNG_VAT, 
		          SUM(A.byam) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM) TOT_GAM, 
		          SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) + SUM(A.TRP_SVC_CST) + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) CHRG_TOT, 
		          SUM(A.VCBT_AM) VCBT_AM, 
		          SUM(A.VCBX_AM) VCBX_AM, 
		          SUM(A.byam) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM) - ( SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) + SUM(A.TRP_SVC_CST) + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) ) CBAM, 
		          DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC, 
		          '['||MIN(A.ROTS_CTR_DSC)||'] '||FN_CM_SIMP_CNM('ROTS_CTR_DSC',MIN(A.ROTS_CTR_DSC)) ROTS_CTR_DSC, 
		          MIN(A.NA_TRPL_C) ACTL_BUYPL_NA_TRPL_C, 
		          MIN(A.ACTL_BUYPL_NA_TRPL_C) MNGT_NA_TRPL_C,    
		          MIN(A.ADJ_NA_BZPLC) ADJ_NA_BZPLC, 
		          MIN(A.NA_ADJPL_C) NA_TRPL_C,
		          SUM(A.BYAM)-SUM(A.BYNG_VAT)-SUM(NVL(A.EXTX_AM,0))-SUM(NVL(A.SMA_AM,0))-(SUM(NVL(A.LIQ_SPY_AM,0))-SUM(NVL(A.LIQ_VAT,0))) GWA_AM,
		          SUM(NVL(A.BYNG_VAT,0))-SUM(NVL(A.LIQ_VAT,0)) GWA_VAT,
		          SUM(NVL(A.LIQ_SPY_AM,0))-SUM(NVL(A.LIQ_VAT,0)) LIQ_GAM,
		          SUM(NVL(A.LIQ_VAT,0)) LIQ_VAT,
		          SUM(NVL(A.EXTX_AM,0)) EXTX_AM,
		          SUM(NVL(A.SMA_AM,0)) SMA_AM,
		          SUM(A.COMP_FEE) COMP_FEE,
		          SUM(A.ETR_AMN_FEE) ETR_AMN_FEE, 
		          SUM(A.ETR_AMN_VAT) ETR_AMN_VAT,
		          SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE, 
		          SUM(A.PHD_FEE) PHD_FEE, 
		          SUM(A.PHD_FEE_VAT) PHD_FEE_VAT,
		          SUM(A.TRP_SVC_CST) TRP_SVC_CST, 
		          SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT, 
		          SUM(A.ETC_FEE) ETC_FEE, 
		          SUM(A.ETC_FEE_VAT) ETC_FEE_VAT,
		          SUM(A.BYNG_SSDY) BYNG_SSDY
		     FROM TB_DP_CM_SLP_CNR_RZS A
		    WHERE A.NA_TRPL_C IN 
		          <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		    	   #{item}
				  </foreach> 
		          <choose>
					<when test="SEARCH_DATE_TYPE == '1'.toString()">
						AND A.TR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
					</when>
					<when test="SEARCH_DATE_TYPE == '2'.toString()">
						AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
					</when>
					<when test="SEARCH_DATE_TYPE == '3'.toString()">
						AND A.PY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
					</when>
				  </choose>
		          <choose>
					<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
						<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
					</when>
					<when test="TRADE_TYPE == '1'.toString()">
						AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
						AND A.NA_CRC_CAN_DSC = '1'
					</when>
					<when test="TRADE_TYPE == '2'.toString()">
						AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
						AND A.NA_CRC_CAN_DSC = '1'
					</when>
					<when test="TRADE_TYPE == '3'.toString()">
						AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
					</when>
					<when test="TRADE_TYPE == '4'.toString()">
						AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
					</when>
				</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
		    GROUP BY A.NA_CRC_CAN_DSC, 
		          A.ACTL_BUYPL_NA_TRPL_C, 
		          A.TR_DT, 
		          A.NA_SLPNO, 
		          A.NA_DVY_PLASH_SLPNO, 
		          A.DVYAA_NA_TRPL_C, 
		          A.PY_PLA_DT, 
		          A.NA_TR_DSC 
		 ORDER BY A.DVYAA_NA_TRPL_C, 
		          A.NA_DVY_PLASH_SLPNO 
		 ) A,
		 TB_TR_TRPL_CIF B , 
		       (SELECT LEVEL seq 
		         FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> 3
		       ) X 
		 WHERE 1=1 
		       AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
		       <if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 배송지여야 함, DVYAA_NA_TRPL_C -->
					<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">				
						AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
					</if>	
				</if> 
		 GROUP BY 
		 	   DECODE(X.seq, '2', A.ACTL_BUYPL_NA_TRPL_C||B.NA_USR_SYS_KDC, '3', A.ACTL_BUYPL_NA_TRPL_C||B.NA_USR_SYS_KDC, NULL) , 
		       X.seq , DECODE(X.seq, '1', NULL, '3', NULL, A.MNGT_NA_TRPL_C) 
		ORDER BY DECODE(X.seq, 1, 1, 2), 1, 3  
	</sql>
	
	<select id="downloadExcelRecadvSlp_NA_TRPL_C_M" parameterType="java.util.Map" resultType="java.util.Map">
		<include refid="sql_recadvSlp_NA_TRPL_C_M" />
	</select>
	
	<!-- 검수실적-매입처별 상세조회 -->
	<select id="retrieveRecadvSlp_NA_TRPL_C_Detail" parameterType="java.util.Map" resultMap="RecadvMaster_NA_TRPL_C_Map">
	with temp_tab as (
		SELECT /*+ materialize */
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO			
			, '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC
			,C.CLNTNM CCLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			
			<!--,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/ -->
			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/

			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/

			
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC			
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			
			<!-- ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/  배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			<!-- ,'DESADV' FSRGMN_ENO -->
			<!-- ,NVL(MIN(A.DVYAA_NA_TRPL_C     ),' ')    DVYAA_NA_TRPL_C -->
			,NVL(MIN(A.DVYAA_NA_TRPL_C     ),A.NA_BZPLC)    DVYAA_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			
			, nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.liq_yn='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end     ),0)    liq_spy_am /*주류금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.liq_yn='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byng_vat end ),0)    liq_vat /*주류부가세*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='2' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    extx_am /*면세금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='3' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    sma_am /*영세금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    txt_am  /*과세금액*/
                     
		FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)
<!-- 			AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
<!-- 					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE} -->
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
                    AND WRS.SLP_DT > TO_CHAR( TO_DATE(#{FROM_DATE}, 'YYYYMMDD') - 91, 'YYYYMMDD')
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
		GROUP BY
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.NA_CRC_CAN_DSC
			,C.CLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			<!-- ,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처명*/ -->
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,WRS.RPY_PLA_DT
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)	
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
			,A.BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*실매입처(농협)*/			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			,A.NA_BZPLC 
			,A.NA_TEAM_C 
			,A.SLP_DT                      
            ,A.NA_SLPNO
            ,WRS.SLP_SQNO
	)
	SELECT
			
 		A.NA_BZPLC 
        , A.NA_TEAM_C 
        , A.SLP_DT
        , A.NA_SLPNO              
        , A.CNR_DT /*검수일자*/
        , A.TRSLPNO/*매출일자전표번호*/  
        , A.RPY_PLA_DT /*지급예정일*/
        , A.NA_DVY_PLASH_SLPNO /*배송예정서번호*/
        , A.NA_TR_DSC /*거래구분*/
        , A.NA_CRC_CAN_DSC /*정정취소구분*/
        , A.ROTS_CTR_DSC /*계통구분*/
		, SUM(A.BYAM-A.BYNG_VAT) GAM_AM /*공급금액*/
		, SUM(A.BYNG_VAT) BYNG_VAT /*부가세*/
		, SUM(A.VCBT_AM) VCBT_AM /*공병금액*/
		, SUM(A.VCBX_AM) VCBX_AM /*공상자금액*/
		, SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM /*총공급금액*/
		, SUM(A.CHRG_TOT) CHRG_TOT /*총공제금액*/		
		, SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM)-(A.CHRG_TOT)) CBAM /*순공급금액*/
		, SUM(A.BYAM)-SUM(A.BYNG_VAT)-SUM(A.EXTX_AM)-SUM(A.SMA_AM)-(SUM(A.LIQ_SPY_AM)-SUM(A.LIQ_VAT)) GWA_AM /*과세공급*/
		, SUM(A.BYNG_VAT)-SUM(A.LIQ_VAT) GWA_VAT /*과세부가세*/
		, SUM(A.LIQ_SPY_AM)-SUM(A.LIQ_VAT) LIQ_GAM /*주류공급*/
		, SUM(A.LIQ_VAT)  LIQ_VAT /*주류부가세*/
		, SUM(A.EXTX_AM)  EXTX_AM /*면세금액*/
		, SUM(A.SMA_AM)  SMA_AM /*영세금액*/
      	, A.CCLNTNM /*본지사명*/ 
        , A.ACTL_BUYPL_NA_TRPL_C  /*본지사코드*/
        , B.CLNTNM BCLNTNM /*사업장명*/
        , A.MNGT_NA_TRPL_C /*사업장코드*/
		, SUM(A.COMP_FEE) COMP_FEE /*업체별수수료*/
		, SUM(A.BYNG_SSDY) BYNG_SSDY /*매입장려금*/
		, SUM(A.ETR_AMN_FEE) ETR_AMN_FEE /*관리수수료*/
		, SUM(A.ETR_AMN_VAT) ETR_AMN_VAT /*관리부가세*/
		, SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE /*관리수수료*/
		, SUM(A.PHD_FEE) PHD_FEE /*물류수수료*/
		, SUM(A.PHD_FEE_VAT) PHD_FEE_VAT /*물류부가세*/
		, SUM(A.TRP_SVC_CST) TRP_SVC_CST /*운송용역비*/
		, SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT /*운송부가세*/
		, SUM(A.ETC_FEE) ETC_FEE /*기타수수료*/
		, SUM(A.ETC_FEE_VAT) ETC_FEE_VAT /*기타수수료부가세*/
	FROM
	temp_tab A
	, TB_TR_TRPL_CIF B	              
	WHERE 1=1
	AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
	<if test="MNGT_NA_TRPL_C != null and MNGT_NA_TRPL_C.length() >  0 and MNGT_NA_TRPL_C != 'all'.toString()">
		AND A.MNGT_NA_TRPL_C = #{MNGT_NA_TRPL_C} /*클릭시 사업장코드*/
	</if>
	GROUP BY A.NA_BZPLC, 
              A.NA_TEAM_C, 
              A.SLP_DT, 
              A.NA_SLPNO, 
              A.NA_CRC_CAN_DSC, 
              A.CCLNTNM, 
              A.NA_DVY_PLASH_SLPNO, 
              B.CLNTNM, 
              A.CNR_DT, 
              A.TRSLPNO, 
              A.RPY_PLA_DT, 
              A.NA_TR_DSC, 
              A.ROTS_CTR_DSC, 
              A.ACTL_BUYPL_NA_TRPL_C, 
              A.MNGT_NA_TRPL_C
	ORDER BY A.TRSLPNO
	</select>
	
	<!-- 검수실적-매입처별 상세 엑셀 다운로드 -->
	<select id="downloadExcelRecadvSlp_NA_TRPL_C_D" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
	with temp_tab as (
		SELECT /*+ materialize */
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO			
			, '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC
			,C.CLNTNM CCLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			
			<!--,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/ -->
			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/

			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/

			
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC			
			, TC.SIMP_CNM AS ROTS_CTR_DSC
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			
			<!-- ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/  배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			<!-- ,'DESADV' FSRGMN_ENO -->
			<!-- ,NVL(MIN(A.DVYAA_NA_TRPL_C     ),' ')    DVYAA_NA_TRPL_C -->
			,NVL(MIN(A.DVYAA_NA_TRPL_C     ),A.NA_BZPLC)    DVYAA_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			
			, nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.liq_yn='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end     ),0)    liq_spy_am /*주류금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.liq_yn='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byng_vat end ),0)    liq_vat /*주류부가세*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='2' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    extx_am /*면세금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='3' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    sma_am /*영세금액*/
            , nvl(min( case when substr(WRS.na_lled_c,1,1) != '9' and WRS.TXT_DSC='1' then FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)*WRS.byam end    ),0)    txt_am  /*과세금액*/
                     
		FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

<!-- 			AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
		GROUP BY
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.NA_CRC_CAN_DSC
			,C.CLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			<!-- ,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처명*/ -->
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,WRS.RPY_PLA_DT
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)	
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,TC.SIMP_CNM
			,A.BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*실매입처(농협)*/			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			,A.NA_BZPLC 
			,A.NA_TEAM_C 
			,A.SLP_DT                      
            ,A.NA_SLPNO
            ,WRS.SLP_SQNO
	)
	SELECT			
		DECODE(X.SEQ, '2', A.ACTL_BUYPL_NA_TRPL_C, NULL) ACTL_BUYPL_NA_TRPL_C /*매출처 코드(본지사)*/
		, DECODE(X.SEQ, '1','',MIN(A.CCLNTNM)) ACTL_BUYPL_NA_TRPL_C_NM /*매출처 명(본지사)*/
		, DECODE(X.SEQ, '1', NULL, A.MNGT_NA_TRPL_C) MNGT_NA_TRPL_C /*매입처 코드 (농협 사업장)*/
		, DECODE(X.SEQ, '1', '합계', MIN(B.CLNTNM)) MNGT_NA_TRPL_C_NM /*매입처 명(농협 사업장)*/      
		, SUM(A.BYAM-A.BYNG_VAT) GAM_AM /*공급금액*/
		, SUM(A.BYNG_VAT) BYNG_VAT /*부가세*/
		, SUM(A.VCBT_AM) VCBT_AM /*공병금액*/
		, SUM(A.VCBX_AM) VCBX_AM /*공상자금액*/
		, SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM /*총공급금액*/
		, SUM(A.CHRG_TOT) CHRG_TOT /*총공제금액*/		
		, SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM)-(A.CHRG_TOT)) CBAM /*순공급금액*/
		, SUM(A.BYAM)-SUM(A.BYNG_VAT)-SUM(A.EXTX_AM)-SUM(A.SMA_AM)-(SUM(A.LIQ_SPY_AM)-SUM(A.LIQ_VAT)) GWA_AM /*과세공급*/
		, SUM(A.BYNG_VAT)-SUM(A.LIQ_VAT) GWA_VAT /*과세부가세*/
		, SUM(A.LIQ_SPY_AM)-SUM(A.LIQ_VAT) LIQ_GAM /*주류공급*/
		, SUM(A.LIQ_VAT)  LIQ_VAT /*주류부가세*/
		, SUM(A.EXTX_AM)  EXTX_AM /*면세금액*/
		, SUM(A.SMA_AM)  SMA_AM /*영세금액*/
		, SUM(A.COMP_FEE) COMP_FEE /*업체별수수료*/      
		, SUM(A.ETR_AMN_FEE) ETR_AMN_FEE /*관리수수료*/
		, SUM(A.ETR_AMN_VAT) ETR_AMN_VAT /*관리부가세*/
		, SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE /*관리수수료*/
		, SUM(A.PHD_FEE) PHD_FEE /*물류수수료*/
		, SUM(A.PHD_FEE_VAT) PHD_FEE_VAT /*물류부가세*/
		, SUM(A.TRP_SVC_CST) TRP_SVC_CST /*운송용역비*/
		, SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT /*운송부가세*/
		, SUM(A.ETC_FEE) ETC_FEE /*기타수수료*/
		, SUM(A.ETC_FEE_VAT) ETC_FEE_VAT /*기타수수료부가세*/
		, SUM(A.BYNG_SSDY) BYNG_SSDY /*매입장려금*/              
		, 0 ACRV /*미수금*/
		, 0 PPYAM /*선급금*/
		, 0 PPYAM_INT /*선급금이자*/
		, 0 AST_SAM /*보조금*/
		, 0 CSH_AM /*현금금액*/
		, 0 TFR_AM /*대체금액*/
		, 0 AC_FTR_AM /*계좌이체금액*/
		, 0 FC_AM /* 외화금액*/
		, DECODE(X.SEQ, '1', NULL, TRSLPNO) TRSLPNO
		, DECODE(X.SEQ, '1', NULL, CNR_DT) CNR_DT
		, DECODE(X.SEQ, '1', NULL, RPY_PLA_DT) RPY_PLA_DT
		, DECODE(X.SEQ, '1', NULL, NA_DVY_PLASH_SLPNO) NA_DVY_PLASH_SLPNO
		, DECODE(X.SEQ, '1', NULL, NA_TR_DSC) NA_TR_DSC
		, DECODE(X.SEQ, '1', NULL, NA_CRC_CAN_DSC) NA_CRC_CAN_DSC
		, DECODE(X.SEQ, '1', NULL, ROTS_CTR_DSC) ROTS_CTR_DSC
	FROM
	temp_tab A
	, TB_TR_TRPL_CIF B
	, (SELECT LEVEL seq FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> 2) X
	WHERE 1=1
	AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
	<if test="MNGT_NA_TRPL_C != null and MNGT_NA_TRPL_C.length() >  0 and MNGT_NA_TRPL_C != 'all'.toString()">
		AND A.MNGT_NA_TRPL_C = #{MNGT_NA_TRPL_C} /*클릭시 사업장코드*/
	</if>
	GROUP BY
		DECODE(X.seq, '2', A.ACTL_BUYPL_NA_TRPL_C, NULL)
		, X.seq
		, DECODE(X.seq, '1', NULL, A.MNGT_NA_TRPL_C)
		, DECODE(X.seq, '1', NULL, trslpno)
		, DECODE(X.seq, '1', NULL, cnr_dt)
		, DECODE(X.seq, '1', NULL, RPY_PLA_DT)
		, DECODE(X.seq, '1', NULL, na_dvy_plash_slpno) 
		, DECODE(X.seq, '1', NULL, na_tr_dsc)
		, DECODE(X.seq, '1', NULL, na_crc_can_dsc) 
		, DECODE(X.seq, '1', NULL, rots_ctr_dsc)
	ORDER BY DECODE(X.SEQ, 1, 1, 2), 1, 3, DECODE(X.SEQ, '1', NULL, TRSLPNO)
	</select>
	
	<sql id="sql_retrieveRecadvSlpMasterList_20151122">
	SELECT 
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.NA_CRC_CAN_DSC,
		A.CCLNTNM,
		A.NA_DVY_PLASH_SLPNO,
		<!-- BCLNTNM, -->
		B.CLNTNM BCLNTNM /*실매입처명*/,
		A.CNR_DT,
		A.TRSLPNO,
		A.RPY_PLA_DT,
		SUM(A.BYAM-A.BYNG_VAT) GAM_AM,
		SUM(A.BYNG_VAT) BYNG_VAT,
		SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM,
		SUM(A.CHRG_TOT) CHRG_TOT,
		SUM(A.VCBT_AM) VCBT_AM,
		SUM(A.VCBX_AM) VCBX_AM,
		SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM)-(A.CHRG_TOT)) CBAM,
		A.NA_TR_DSC,
		A.ROTS_CTR_DSC,
		A.ACTL_BUYPL_NA_TRPL_C,
		A.MNGT_NA_TRPL_C,
		SUM(A.COMP_FEE) COMP_FEE,
		SUM(A.BYNG_SSDY) BYNG_SSDY,
		SUM(A.ETR_AMN_FEE) ETR_AMN_FEE,
		SUM(A.ETR_AMN_VAT) ETR_AMN_VAT,
		SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE,
		SUM(A.PHD_FEE) PHD_FEE,
		SUM(A.PHD_FEE_VAT) PHD_FEE_VAT,
		SUM(A.TRP_SVC_CST) TRP_SVC_CST,
		SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT,
		SUM(A.ETC_FEE) ETC_FEE,
		SUM(A.ETC_FEE_VAT) ETC_FEE_VAT,
		A.ADJ_NA_BZPLC,
		A.ADJ_NA_TRPL_C,
		<!-- A.FSRGMN_ENO, -->
		MIN(Y.fsrgmn_eno) FSRGMN_ENO,
		A.EDIRG_DTM,
		A.FS_RMS_DT
	FROM (
	
		SELECT
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO			
			,DECODE(A.NA_CRC_CAN_DSC,'2','[2] 정정','3','[3] 취소', '[' || A.NA_CRC_CAN_DSC || '] 정상') NA_CRC_CAN_DSC
			,C.CLNTNM CCLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			
			<!--,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/ -->
			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/

			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/

			
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC			
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			
			<!-- ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/  배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			<!-- ,'DESADV' FSRGMN_ENO -->
			,NVL(MIN(A.DVYAA_NA_TRPL_C     ),' ')    DVYAA_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
		FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

			AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 배송지여야 함, DVYAA_NA_TRPL_C -->
					AND A.DVYAA_NA_TRPL_C = #{NA_BZPLC}
				</if>
		GROUP BY
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.NA_CRC_CAN_DSC
			,C.CLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			<!-- ,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처명*/ -->
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,WRS.RPY_PLA_DT
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)	
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
			,A.BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*실매입처(농협)*/			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			,A.NA_BZPLC 
			,A.NA_TEAM_C 
			,A.SLP_DT                      
            ,A.NA_SLPNO
            ,WRS.SLP_SQNO 		
		
	) A
	, TB_TR_TRPL_CIF B
	, TB_OD_DLVPNSHT_M Y              
WHERE 1=1
AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
	GROUP BY
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.NA_CRC_CAN_DSC,
		A.CCLNTNM,
		A.NA_DVY_PLASH_SLPNO,
		B.CLNTNM,
		A.CNR_DT,
		A.TRSLPNO,
		A.RPY_PLA_DT,
		A.NA_TR_DSC,
		A.ROTS_CTR_DSC,
		A.ACTL_BUYPL_NA_TRPL_C,
		A.MNGT_NA_TRPL_C,
		A.ADJ_NA_BZPLC,
		A.ADJ_NA_TRPL_C,		
		A.EDIRG_DTM,
		A.FS_RMS_DT	
<!--     ORDER BY 
    		MNGT_NA_TRPL_C , 
            B.CLNTNM , 
            ACTL_BUYPL_NA_TRPL_C , 
            TRSLPNO , 
            CNR_DT ,
            RPY_PLA_DT -->
	</sql>
	
	<sql id="sql_retrieveRecadvSlpMasterList_IN_NA_LLED_C">
	SELECT
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.NA_CRC_CAN_DSC,
		A.CCLNTNM,
		A.NA_DVY_PLASH_SLPNO,
		<!-- BCLNTNM, -->
		B.CLNTNM BCLNTNM /*실매입처명*/,
		A.CNR_DT,
		A.TRSLPNO,
		A.RPY_PLA_DT,
		SUM(A.BYAM-A.BYNG_VAT) GAM_AM,
		SUM(A.BYNG_VAT) BYNG_VAT,
		SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM,
		SUM(A.CHRG_TOT) CHRG_TOT,
		SUM(A.VCBT_AM) VCBT_AM,
		SUM(A.VCBX_AM) VCBX_AM,
		SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM)-(A.CHRG_TOT)) CBAM,
		A.NA_TR_DSC,
		A.ROTS_CTR_DSC,
		A.ACTL_BUYPL_NA_TRPL_C,
		A.MNGT_NA_TRPL_C,
		SUM(A.COMP_FEE) COMP_FEE,
		SUM(A.BYNG_SSDY) BYNG_SSDY,
		SUM(A.ETR_AMN_FEE) ETR_AMN_FEE,
		SUM(A.ETR_AMN_VAT) ETR_AMN_VAT,
		SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE,
		SUM(A.PHD_FEE) PHD_FEE,
		SUM(A.PHD_FEE_VAT) PHD_FEE_VAT,
		SUM(A.TRP_SVC_CST) TRP_SVC_CST,
		SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT,
		SUM(A.ETC_FEE) ETC_FEE,
		SUM(A.ETC_FEE_VAT) ETC_FEE_VAT,
		A.ADJ_NA_BZPLC,
		A.ADJ_NA_TRPL_C,
		<!-- A.FSRGMN_ENO, -->
		MIN(Y.fsrgmn_eno) FSRGMN_ENO,
		A.EDIRG_DTM,
		A.FS_RMS_DT		
	FROM (
	
		SELECT
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO			
			, '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC
			,C.CLNTNM CCLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			
			<!-- ,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/  배송지거래처코드가 없을땐 경제통합사업장코드명으로 -->

			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/

			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
						
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.VCBT_AM),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(A.VCBX_AM),0) AS VCBX_AM /*공상자금액 F*/

			
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC			
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			
			<!-- ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/  배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			<!-- ,'DESADV' FSRGMN_ENO -->
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
		FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.ACTL_BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

			AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 배송지여야 함, DVYAA_NA_TRPL_C -->
					AND A.DVYAA_NA_TRPL_C = #{NA_BZPLC}
				</if>
		GROUP BY
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.NA_CRC_CAN_DSC
			,C.CLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			<!-- ,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처명*/ -->
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,WRS.RPY_PLA_DT
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)	
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
			,A.BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*실매입처(농협)*/			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			,A.NA_BZPLC 
			,A.NA_TEAM_C 
			,A.SLP_DT                      
            ,A.NA_SLPNO
            ,WRS.SLP_SQNO 		
		
	) A
	, TB_TR_TRPL_CIF B
	, TB_OD_DLVPNSHT_M Y     
WHERE 1=1
AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
	GROUP BY
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.NA_CRC_CAN_DSC,
		A.CCLNTNM,
		A.NA_DVY_PLASH_SLPNO,
		B.CLNTNM,
		A.CNR_DT,
		A.TRSLPNO,
		A.RPY_PLA_DT,
		A.NA_TR_DSC,
		A.ROTS_CTR_DSC,
		A.ACTL_BUYPL_NA_TRPL_C,
		A.MNGT_NA_TRPL_C,
		A.ADJ_NA_BZPLC,
		A.ADJ_NA_TRPL_C,		
		A.EDIRG_DTM,
		A.FS_RMS_DT
<!--     ORDER BY 
    		MNGT_NA_TRPL_C , 
            BCLNTNM , 
            ACTL_BUYPL_NA_TRPL_C , 
            TRSLPNO , 
            CNR_DT ,
            RPY_PLA_DT -->
	</sql>
		
	<!-- 검수실적-전표별 마스터 페이지 추가 쿼리 -->	
	<select id="retrieveRecadvSlpMasterList" parameterType="java.util.Map" resultMap="RecadvMasterMap">
		<bind name="sortName" value="'ACTL_BUYPL_NA_TRPL_C ,MNGT_NA_TRPL_C,TRSLPNO,CNR_DT ,RPY_PLA_DT'" />
		<bind name="sortType" value="'asc'" />            
		
		<include refid="common.paging_start" />
		<include refid="sql_retrieveRecadvSlpMasterList" />
		<include refid="common.paging_end" />
	</select>
	
	<!-- 검수실적-전표별 마스터 총 카운트 -->
	<select id="getRecadvSlpCount" parameterType="java.util.Map" resultType="int">
		<include refid="common.count_start" />
		<include refid="sql_retrieveRecadvSlpMasterList" />
		<include refid="common.count_end" />
	</select>
	
	<!--검수실적-전표별 마스터 총 합계 수량/금액 -->
	<select id="getRecadvSlpTotal" parameterType="java.util.Map" resultMap="RecadvMasterMap">
		SELECT
			NVL(SUM(LIST.GAM_AM), 0) AS TOTAL_GAM_AM,
			NVL(SUM(LIST.BYNG_VAT), 0) AS TOTAL_BYNG_VAT,
			NVL(SUM(LIST.TOT_GAM), 0) AS TOTAL_TOT_GAM,
			NVL(SUM(LIST.CHRG_TOT), 0) AS TOTAL_CHRG_TOT,
			NVL(SUM(LIST.VCBT_AM), 0) AS TOTAL_VCBT_AM,
			NVL(SUM(LIST.VCBX_AM), 0) AS TOTAL_VCBX_AM,
			NVL(SUM(LIST.CBAM), 0) AS TOTAL_CBAM,
			NVL(SUM(LIST.COMP_FEE), 0) AS TOTAL_COMP_FEE,
			NVL(SUM(LIST.BYNG_SSDY), 0) AS TOTAL_BYNG_SSDY,
			NVL(SUM(LIST.ETR_AMN_FEE), 0) AS TOTAL_ETR_AMN_FEE,
			NVL(SUM(LIST.ETR_AMN_VAT), 0) AS TOTAL_ETR_AMN_VAT,
			NVL(SUM(LIST.SLGT_AMN_FEE), 0) AS TOTAL_SLGT_AMN_FEE,
			NVL(SUM(LIST.PHD_FEE), 0) AS TOTAL_PHD_FEE,
			NVL(SUM(LIST.PHD_FEE_VAT), 0) AS TOTAL_PHD_FEE_VAT,
			NVL(SUM(LIST.TRP_SVC_CST), 0) AS TOTAL_TRP_SVC_CST,
			NVL(SUM(LIST.TRP_SVCOS_VAT), 0) AS TOTAL_TRP_SVCOS_VAT,
			NVL(SUM(LIST.ETC_FEE), 0) AS TOTAL_ETC_FEE,
			NVL(SUM(LIST.ETC_FEE_VAT), 0) AS TOTAL_ETC_FEE_VAT
		FROM
		(
		<include refid="sql_retrieveRecadvSlpMasterList" />
		) LIST
	</select>
	
	<!-- 검수실적 전표별 사후장려금 보정 금액 구하기 -->
	<select id="getBlbSpyAm" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT                                                                                
			NVL(SUM(BLB_SPY_AM),0) SUM_BLB_SPY_AM FROM (
				SELECT DECODE(SUBSTR(NA_TR_DSC, 1, 2)
					, 'OB', DECODE(na_crc_can_dsc, '1', SUM( AFF_SSDY), SUM( AFF_SSDY*-1))
					, 'OS', DECODE(na_crc_can_dsc, '1', SUM( AFF_SSDY), SUM( AFF_SSDY*-1)),0) BLB_SPY_AM
				FROM TB_LG_WA_OH_ICT
				WHERE 1=1					
				<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
					AND PHD_NA_BZPLC = #{NA_BZPLC}
				</if>
					AND SLPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>				
					<!-- AND tr_dt <![CDATA[>]]> '20081024' -->
					<!-- AND AFF_SSDY <![CDATA[<>]]> 0 -->
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
				    AND TR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
				    AND '0' BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<otherwise>				
				    AND PY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</otherwise>
			</choose>			
				GROUP BY NA_TR_DSC, NA_CRC_CAN_DSC				
			)
	</select>
	
	<!-- 검수실적-전표별 디테일조회 -->
	<sql id="sql_retrieveRecadvSlpDetailList">
		SELECT
			   A.NA_BZPLC
			 , A.NA_TEAM_C
			 , A.SLP_DT
			 , A.NA_SLPNO
			 , A.SLP_SQNO
			 , A.NA_WRS_C
			 , B.WRSNM
			 , '[' || A.TXT_DSC || '] ' || FN_CM_SIMP_CNM('TXT_DSC', A.TXT_DSC) AS TXT_DSC	/* 과세구분*/
			 , FN_CNR_DS_AM(A.NA_TR_DSC, A.NA_CRC_CAN_DSC) * A.BYAM AS BYAM					/*총공급금액*/
			 , A.BYNG_UPR
			 , FN_CNR_DS_AM(A.NA_TR_DSC, A.NA_CRC_CAN_DSC) * A.BYNG_QT AS BYNG_QT
			 , (FN_CNR_DS_AM(A.NA_TR_DSC, A.NA_CRC_CAN_DSC) * A.BYAM) - (FN_CNR_DS_AM(A.NA_TR_DSC, A.NA_CRC_CAN_DSC) * A.BYNG_VAT) AS GAM_AM	/*공급금액*/
			 , FN_CNR_DS_AM(A.NA_TR_DSC, A.NA_CRC_CAN_DSC) * A.BYNG_VAT AS BYNG_VAT			/*매입부가세*/
			 , C.WRS_STDNM
			 , A.VCBT_NA_WRS_C
			 , A.VCBT_QT
			 , NVL(A.VCBT_AM/DECODE(A.VCBT_QT,0,NULL,A.VCBT_QT),0) AS VCBT_UPR
			 , B.INPD_QT
			 , B.PD_YY
			 , A.BYNG_WT
			 , A.RPY_PLA_DT
			 , TRUNC(NVL(A.BYNG_UPR * A.BYNG_QT, 0)) AS BYNG_AM
			 , CASE TO_CHAR(C.WHT)
					WHEN '0' THEN '없음'
					ELSE C.WHT || FN_CM_SIMP_CNM('NA_WRS_UNT_C', LPAD(C.NA_WRS_UNT_C, 3, '0'))
			   END AS NA_WRS_UNT_C /* 단위 */
			 , FN_CNR_DS_AM(A.NA_TR_DSC, A.NA_CRC_CAN_DSC) AS CNR_DS_AM						/*검수구분금액 매출정상:+ 매출 정정,취소:- 반품정상:- 반품 정정,취소:+ */
		  FROM TB_BY_BYNG_WRS A
			 , TB_OD_TRTWRS B
			 , TB_GD_WRS C
		 WHERE A.NA_BZPLC = B.NA_BZPLC
		   AND A.NA_WRS_C = B.NA_WRS_C
		   AND A.NA_WRS_C = C.NA_WRS_C
		   AND NVL(A.DEL_YN, 0) = '0'  /* 삭제여부 (1: 여, 0: 부) */
		<if test="NA_BZPLC != null and NA_BZPLC.length() > 0">
		   AND A.NA_BZPLC = #{NA_BZPLC}
		</if>
		<if test="NA_TEAM_C != null and NA_TEAM_C.length() >  0">
		   AND A.NA_TEAM_C = #{NA_TEAM_C}
		</if>
		<if test="SLP_DT != null and SLP_DT.length() > 0">
		   AND A.SLP_DT = #{SLP_DT}
		</if>
		<if test="NA_SLPNO != null and NA_SLPNO.length() > 0">
		   AND A.NA_SLPNO = #{NA_SLPNO}
		</if>
		<if test="RPY_PLA_DT != null and RPY_PLA_DT.length() > 0">
		   AND A.RPY_PLA_DT = #{RPY_PLA_DT}
		</if>		
		 ORDER BY A.NA_BZPLC
				, A.NA_WRS_C
				, A.SLP_DT
	</sql>
	
	<!-- 검수실적-전표별 디테일 페이지 추가 쿼리 -->	
	<select id="retrieveRecadvSlpDetailList" parameterType="java.util.Map" resultMap="RecadvDetailMap">
		<bind name="sortName" value="'SLP_SQNO'" />
		<bind name="sortType" value="'asc'" />
		
		<include refid="common.paging_start" />
		<include refid="sql_retrieveRecadvSlpDetailList" />
		<include refid="common.paging_end" />
	</select>
	
	<!-- 검수실적-전표별 디테일 총 카운트 -->
	<select id="getRecadvSlpDetailCount" parameterType="java.util.Map" resultType="int">
		<include refid="common.count_start" />
		<include refid="sql_retrieveRecadvSlpDetailList" />
		<include refid="common.count_end" />
	</select>	
	
	<!-- 검수실적-전표별 마스터  엑셀 다운로드 -->
	<select id="downloadExcelRecadvSlpMaster_backup" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			X.SEQ
			, DECODE(X.SEQ, 1,   NULL, A.NA_BZPLC     ) NA_BZPLC
			, DECODE(X.SEQ, 1,   NULL, MIN(A.NA_TEAM_C             )) NA_TEAM_C
			, DECODE(X.SEQ, 1,   NULL, MIN(A.SLP_DT             )) SLP_DT
			, DECODE(X.SEQ, 1,   NULL, MIN(A.NA_SLPNO              )) NA_SLPNO
			, DECODE(X.SEQ, 1,   NULL, A.ACTL_BUYPL_NA_TRPL_C     ) ACTL_BUYPL_NA_TRPL_C
			, DECODE(X.SEQ, 1,   NULL, MIN(A.CCLNTNM             )) CCLNTNM
			, DECODE(X.SEQ, 1,   NULL, MIN(A.TRSLPNO             )) TRSLPNO
			, DECODE(X.SEQ, 1,   NULL, MIN(A.CNR_DT              )) CNR_DT
			, DECODE(X.SEQ, 1,   NULL, MIN(A.RPY_PLA_DT           )) RPY_PLA_DT
			, DECODE(X.SEQ, 1,   NULL, MIN(A.MNGT_NA_TRPL_C)) MNGT_NA_TRPL_C
<!-- 			, DECODE(X.SEQ, 1,   NULL, MIN(BCLNTNM             )) BCLNTNM -->
			, DECODE(X.SEQ, 1,   NULL, MIN(B.CLNTNM             )) BCLNTNM			
			, DECODE(X.SEQ, 1,   NULL, MIN(A.NA_DVY_PLASH_SLPNO  )) NA_DVY_PLASH_SLPNO
			, DECODE(X.SEQ, 1,   NULL, MIN(A.NA_TR_DSC           )) NA_TR_DSC
			, DECODE(X.SEQ, 1,  '합계', MIN(A.NA_CRC_CAN_DSC      )) NA_CRC_CAN_DSC
			, DECODE(X.SEQ, 1,   NULL, MIN(A.ROTS_CTR_DSC        )) ROTS_CTR_DSC			
			, SUM(A.BYAM-A.BYNG_VAT) GAM_AM
			, SUM(A.BYNG_VAT      ) BYNG_VAT
			, SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM       ) TOT_GAM
			, SUM(A.CHRG_TOT      ) CHRG_TOT
			, SUM(A.VCBT_AM       ) VCBT_AM
			, SUM(A.VCBX_AM       ) VCBX_AM
			, SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM) - A.CHRG_TOT) CBAM
			, SUM(A.COMP_FEE      ) COMP_FEE
			, SUM(A.ETR_AMN_FEE   ) ETR_AMN_FEE
			, SUM(A.ETR_AMN_VAT   ) ETR_AMN_VAT
			, SUM(A.SLGT_AMN_FEE  ) SLGT_AMN_FEE
			, SUM(A.PHD_FEE       ) PHD_FEE
			, SUM(A.PHD_FEE_VAT   ) PHD_FEE_VAT
			, SUM(A.TRP_SVC_CST   ) TRP_SVC_CST
			, SUM(A.TRP_SVCOS_VAT ) TRP_SVCOS_VAT
			, SUM(A.ETC_FEE       ) ETC_FEE
			, SUM(A.ETC_FEE_VAT   ) ETC_FEE_VAT
			, SUM(A.BYNG_SSDY     ) BYNG_SSDY
			, SUM(A.ACRV          ) ACRV
			, SUM(A.PPYAM         ) PPYAM
			, SUM(A.PPYAM_INT     ) PPYAM_INT
			, SUM(A.AST_SAM       ) AST_SAM
			, SUM(A.CSH_AM        ) CSH_AM
			, SUM(A.TFR_AM        ) TFR_AM
			, SUM(A.AC_FTR_AM     ) AC_FTR_AM
			, SUM(A.FC_AM         ) FC_AM
			, MIN(A.CNR_DS_AM     ) CNR_DS_AM
			, DECODE(X.SEQ, 1,   NULL, MIN(Y.FSRGMN_ENO           )) FSRGMN_ENO
			, DECODE(X.SEQ, 1,   NULL, MIN(A.ADJ_NA_BZPLC      )) ADJ_NA_BZPLC
			, DECODE(X.SEQ, 1,   NULL, MIN(A.ADJ_NA_TRPL_C        )) ADJ_NA_TRPL_C
		FROM
			( SELECT /*+ leading(a wrs d b c tc f) use_nl(a wrs d d b c tc f) */
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			,C.CLNTNM CCLNTNM /*본지사명*/
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,A.CNR_DT /*검수일자*/
			,WRS.RPY_PLA_DT /*지급예정일*/			
			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			<!-- ,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*물류센터명*/ -->
			
			,A.NA_DVY_PLASH_SLPNO
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC
            ,DECODE(A.NA_CRC_CAN_DSC,'2','[2] 정정','3','[3] 취소', '[' || A.NA_CRC_CAN_DSC || '] 정상') NA_CRC_CAN_DSC
              
			,TC.SIMP_CNM AS ROTS_CTR_DSC /*계통구분*/
			
			<!-- 
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/			 
			-->
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(min( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(min( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			<!-- 
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.VCBT_AM),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(A.VCBX_AM),0) AS VCBX_AM /*공상자금액 F*/
			-->
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
						
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
			
			, 0                ACRV                /* 30 미수금 */
			, 0                PPYAM               /* 31 선급금 */
			, 0                PPYAM_INT           /* 32 선급금이자 */
			, 0                AST_SAM             /* 33 보조금 */
			, 0                CSH_AM              /* 34 현금금액 */
			, 0                TFR_AM              /* 35 대체금액 */
			, 0                AC_FTR_AM           /* 36 계좌이체금액 */
			, 0                FC_AM               /* 37 외화금액 */
			, FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) CNR_DS_AM                           /* 38 검수구분금액 */
			
			,A.ADJ_NA_BZPLC AS ADJ_NA_BZPLC /*정산처사업장코드*/
			,A.ADJ_NA_TRPL_C AS ADJ_NA_TRPL_C /*정산처코드*/
			
			<!-- ,'DEV' FSRGMN_ENO -->
			
			FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.ACTL_BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
            AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)
			
			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
			GROUP BY
	            A.NA_BZPLC
	            ,A.NA_TEAM_C
	            ,A.SLP_DT
	            ,A.NA_SLPNO
	            ,A.NA_CRC_CAN_DSC
	            ,C.CLNTNM /*본지사명*/
	            ,A.NA_DVY_PLASH_SLPNO
	            ,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처명*/
	            ,A.CNR_DT
	            ,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
	            ,WRS.RPY_PLA_DT
	            ,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
	            ,TC.SIMP_CNM
	            ,A.BUYPL_NA_TRPL_C /*본지사코드*/
	            ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*실매입처(농협)*/	
	            ,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)
	            ,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)		
	            ,A.ADJ_NA_BZPLC
	            ,A.ADJ_NA_TRPL_C
	            ,A.EDIRG_DTM /*배달일시*/
	            ,A.FS_RMS_DT /*수신일시*/
	            ,A.NA_BZPLC 
				,A.NA_TEAM_C 
				,A.SLP_DT                      
	            ,A.NA_SLPNO
	            ,WRS.SLP_SQNO
			)A			
			, (SELECT LEVEL SEQ FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> 2) X
			, TB_TR_TRPL_CIF B
			, TB_OD_DLVPNSHT_M Y
		WHERE 1=1
		AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
		<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
			</if>
		</if>
		AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
		AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
		AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
		GROUP BY X.SEQ
			, DECODE(X.SEQ, 1,   NULL, A.NA_BZPLC)
			, DECODE(X.SEQ, 1,   NULL, A.NA_TEAM_C)
			, DECODE(X.SEQ, 1,   NULL, A.SLP_DT)
			, DECODE(X.SEQ, 1,   NULL, A.NA_SLPNO)
			, DECODE(X.SEQ, 1, NULL, A.MNGT_NA_TRPL_C)
			, DECODE(X.SEQ, 1, NULL, A.TRSLPNO)
			, DECODE(X.SEQ, 1, NULL, A.RPY_PLA_DT)
			, DECODE(X.SEQ, 1, NULL, A.ACTL_BUYPL_NA_TRPL_C)
		<!-- ORDER BY SEQ, MNGT_NA_TRPL_C , BCLNTNM , ACTL_BUYPL_NA_TRPL_C , TRSLPNO , CNR_DT , RPY_PLA_DT -->
		ORDER BY SEQ,ACTL_BUYPL_NA_TRPL_C ,MNGT_NA_TRPL_C,TRSLPNO,CNR_DT ,RPY_PLA_DT
	</select>
	
	<sql id="sql_recadvSlpMaster">
	SELECT X.SEQ , 
       DECODE(X.SEQ, 1, NULL, A.NA_BZPLC ) NA_BZPLC , 
       DECODE(X.SEQ, 1, NULL, MIN(A.NA_TEAM_C )) NA_TEAM_C , 
       DECODE(X.SEQ, 1, NULL, MIN(A.SLP_DT )) SLP_DT , 
       DECODE(X.SEQ, 1, NULL, MIN(A.NA_SLPNO )) NA_SLPNO , 
       DECODE(X.SEQ, 1, NULL, A.ACTL_BUYPL_NA_TRPL_C ) ACTL_BUYPL_NA_TRPL_C , 
       DECODE(X.SEQ, 1, NULL, MIN(A.CCLNTNM )) CCLNTNM , 
       DECODE(X.SEQ, 1, NULL, MIN(A.TRSLPNO )) TRSLPNO , 
       DECODE(X.SEQ, 1, NULL, MIN(A.CNR_DT )) CNR_DT , 
       DECODE(X.SEQ, 1, NULL, MIN(A.RPY_PLA_DT )) RPY_PLA_DT , 
       DECODE(X.SEQ, 1, NULL, MIN(A.MNGT_NA_TRPL_C)) MNGT_NA_TRPL_C , 
       DECODE(X.SEQ, 1, NULL, MIN(A.BCLNTNM )) BCLNTNM , 
       DECODE(X.SEQ, 1, NULL, MIN(A.NA_DVY_PLASH_SLPNO )) NA_DVY_PLASH_SLPNO , 
       DECODE(X.SEQ, 1, NULL, MIN(A.NA_TR_DSC )) NA_TR_DSC , 
       DECODE(X.SEQ, 1, '합계', MIN(A.NA_CRC_CAN_DSC )) NA_CRC_CAN_DSC , 
       DECODE(X.SEQ, 1, NULL, MIN(A.ROTS_CTR_DSC )) ROTS_CTR_DSC , 
       SUM(A.GAM_AM) GAM_AM , 
       SUM(A.BYNG_VAT ) BYNG_VAT , 
       SUM(A.TOT_GAM ) TOT_GAM , 
       SUM(A.CHRG_TOT ) CHRG_TOT , 
       SUM(A.VCBT_AM ) VCBT_AM , 
       SUM(A.VCBX_AM ) VCBX_AM , 
       SUM(A.CBAM ) CBAM , 
       SUM(A.COMP_FEE ) COMP_FEE , 
       SUM(A.ETR_AMN_FEE ) ETR_AMN_FEE , 
       SUM(A.ETR_AMN_VAT ) ETR_AMN_VAT , 
       SUM(A.SLGT_AMN_FEE ) SLGT_AMN_FEE , 
       SUM(A.PHD_FEE ) PHD_FEE , 
       SUM(A.PHD_FEE_VAT ) PHD_FEE_VAT , 
       SUM(A.TRP_SVC_CST ) TRP_SVC_CST , 
       SUM(A.TRP_SVCOS_VAT ) TRP_SVCOS_VAT , 
       SUM(A.ETC_FEE ) ETC_FEE , 
       SUM(A.ETC_FEE_VAT ) ETC_FEE_VAT , 
       SUM(A.BYNG_SSDY ) BYNG_SSDY , 
       SUM(A.ACRV ) ACRV , 
       SUM(A.PPYAM ) PPYAM , 
       SUM(A.PPYAM_INT ) PPYAM_INT , 
       SUM(A.AST_SAM ) AST_SAM , 
       SUM(A.CSH_AM ) CSH_AM , 
       SUM(A.TFR_AM ) TFR_AM , 
       SUM(A.AC_FTR_AM ) AC_FTR_AM , 
       SUM(A.FC_AM ) FC_AM , 
       MIN(A.CNR_DS_AM ) CNR_DS_AM , 
       DECODE(X.SEQ, 1, NULL, MIN(A.FSRGMN_ENO )) FSRGMN_ENO , 
       DECODE(X.SEQ, 1, NULL, MIN(A.ADJ_NA_BZPLC )) ADJ_NA_BZPLC , 
       DECODE(X.SEQ, 1, NULL, MIN(A.ADJ_NA_TRPL_C )) ADJ_NA_TRPL_C,
       DECODE(X.SEQ, 1, NULL, MIN(A.APPLICATION_ID )) APPLICATION_ID,
       DECODE(X.SEQ, 1, NULL, MIN(DECODE(A.PBDDLY_YN, '1', 'PB직송', '일반'))) PBDDLY_YN,
       DECODE(X.SEQ, 1, NULL, MIN(DECODE(A.DVY_PLASH_CRT_DSC, '002', '혁신', '일반'))) DVY_PLASH_CRT_DSC
       FROM 
       (
SELECT A.* , B.FSRGMN_ENO, B.EDIRG_DTM, B.FS_RMS_DT, B.PBDDLY_YN, B.DVY_PLASH_CRT_DSC
		FROM (
			SELECT 
			       MIN(A.byam) BYAM,
			       MIN(A.NA_BZPLC) NA_BZPLC,
			       MIN(A.NA_TEAM_C) NA_TEAM_C,
			       A.TR_DT SLP_DT,
			       A.NA_SLPNO NA_SLPNO,
			       '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC,  
			       FN_TRPL_CIF_NM(MIN(A.NA_TRPL_C)) CCLNTNM, 		<!-- 본/지사명  -->  
			       A.NA_DVY_PLASH_SLPNO, 							<!-- 배송예정서번호  -->  
			       FN_TRPL_CIF_NM(A.ACTL_BUYPL_NA_TRPL_C) BCLNTNM, 	<!-- 실매입처명  --> 
			       MIN(A.CNR_DT) CNR_DT, 							<!-- 검수일자  -->   
			       SUBSTR(A.TR_DT,1,4)||'-'||SUBSTR(A.TR_DT,5,2)||'-'|| SUBSTR(A.TR_DT,7,2)||'-'|| A.NA_SLPNO TRSLPNO,
			       A.PY_PLA_DT RPY_PLA_DT, 							<!-- 지급예정일  --> 
			       SUM(A.byam-A.byng_vat) GAM_AM, 	<!-- 공급금액(A)  -->   
			       SUM(A.byng_vat) BYNG_VAT, 		<!-- 부가세(B)  -->  
			       SUM(A.byam) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM) TOT_GAM, 	<!-- 총공급금액(C=A+B+E+F)  -->  
			       SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) 
			       + SUM(A.TRP_SVC_CST) + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) CHRG_TOT, 			<!-- 총공제금액(D=P~Y)  -->  
			       SUM(A.VCBT_AM) VCBT_AM, 		<!-- 공병금액(E)  --> 
			       SUM(A.VCBX_AM) VCBX_AM, 		<!-- 공상자금액(F)  -->  
			       SUM(A.byam) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM) - 
			       ( SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) + SUM(A.TRP_SVC_CST) 
			       + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) ) CBAM, 								<!-- 순공급금액(G=C-D)  --> 
			       DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC, 			<!-- 거래구분  -->  
			       FN_CM_SIMP_CNM('ROTS_CTR_DSC',MIN(A.ROTS_CTR_DSC)) ROTS_CTR_DSC, 	<!-- 계통구분  --> 
			       MIN(A.NA_TRPL_C) ACTL_BUYPL_NA_TRPL_C, 					<!-- 본/지사코드  -->  
			       MIN(A.ACTL_BUYPL_NA_TRPL_C) MNGT_NA_TRPL_C,   			<!-- 실매입처(농협)  --> 
			       SUM(A.COMP_FEE) COMP_FEE, 								<!-- 업체수수료(O=P+Q+R+S)  -->  
			       SUM(A.BYNG_SSDY) BYNG_SSDY, 								<!-- 매입장려금(P)  -->  
			       SUM(A.ETR_AMN_FEE) ETR_AMN_FEE, 							<!-- 관리수수료R2(Q)  -->  
			       SUM(A.ETR_AMN_VAT) ETR_AMN_VAT, 							<!-- 관리부가세R2(R)  -->  
			       SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE, 						<!-- 관리수수료R1(S)  -->  
			       SUM(A.PHD_FEE) PHD_FEE, 									<!-- 물류수수료(T)  -->   
			       SUM(A.PHD_FEE_VAT) PHD_FEE_VAT, 							<!-- 물류부가세(U)   -->  
			       SUM(A.TRP_SVC_CST) TRP_SVC_CST, 							<!-- 운송용역비(V)    -->   
			       SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT, 						<!-- 운송부가세(W)    -->  
			       SUM(A.ETC_FEE) ETC_FEE, 									<!-- 기타수수료(X)    --> 
			       SUM(A.ETC_FEE_VAT) ETC_FEE_VAT, 							<!-- 기타부가세(Y)    -->  
			       MIN(A.ADJ_NA_BZPLC) ADJ_NA_BZPLC, 						<!-- 정산사업장코드    -->  
			       MIN(A.NA_ADJPL_C) ADJ_NA_TRPL_C, 						<!-- 정산처코드    --> 
			       0 ACRV 													<!-- 미수금    --> 
			       , 0 PPYAM 												<!-- 선급금    -->  
			       , 0 PPYAM_INT 											<!-- 선급금이자    -->  
			       , 0 AST_SAM 												<!-- 보조금    -->  
			       , 0 CSH_AM 												<!-- 현금금액    -->  
			       , 0 TFR_AM 												<!-- 대체금액    -->  
			       , 0 AC_FTR_AM 											<!-- 계좌이체금액    -->  
			       , 0 FC_AM 												<!-- 외화금액    --> 
			       , FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) CNR_DS_AM 	<!-- 선급금    --> 
			       , A.APPLICATION_ID
			  FROM TB_DP_CM_SLP_CNR_RZS A
			 WHERE A.NA_TRPL_C IN 
			 		<foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
				    #{item}
					</foreach>
			       <choose>
						<when test="SEARCH_DATE_TYPE == '1'.toString()">
							AND A.TR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
						<when test="SEARCH_DATE_TYPE == '2'.toString()">
							AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
						<when test="SEARCH_DATE_TYPE == '3'.toString()">
							AND A.PY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
					</choose>
					<choose>
							<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
								<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
							</when>
							<when test="TRADE_TYPE == '1'.toString()">
								AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
								AND A.NA_CRC_CAN_DSC = '1'
							</when>
							<when test="TRADE_TYPE == '2'.toString()">
								AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
								AND A.NA_CRC_CAN_DSC = '1'
							</when>
							<when test="TRADE_TYPE == '3'.toString()">
								AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
							</when>
							<when test="TRADE_TYPE == '4'.toString()">
								AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
							</when>
						</choose>
						<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
								AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
						</if>
			 GROUP BY 
			       A.NA_CRC_CAN_DSC, 
			       A.ACTL_BUYPL_NA_TRPL_C, 
			       A.TR_DT, 
			       A.NA_SLPNO, 
			       A.NA_DVY_PLASH_SLPNO, 
			       A.DVYAA_NA_TRPL_C, 
			       A.PY_PLA_DT, 
			       A.NA_TR_DSC,
			       A.APPLICATION_ID
			 ORDER BY 
			       A.DVYAA_NA_TRPL_C, 
			       A.NA_DVY_PLASH_SLPNO
       ) A
       , TB_OD_DLVPNSHT_M B
        WHERE A.NA_DVY_PLASH_SLPNO = B.NA_DVY_PLASH_SLPNO(+) 
        AND A.ACTL_BUYPL_NA_TRPL_C = B.SPYPL_NA_TRPL_C(+) 
        AND A.MNGT_NA_TRPL_C = B.DVYAA_NA_TRPL_C(+)
        <if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
		<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
			AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
		</if>
	  	</if>
	  	AND B.DVY_PLA_DT(+) BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-180,'YYYYMMDD') AND #{TO_DATE}
        )A , 
     (SELECT LEVEL SEQ 
       FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> 2
     ) X
 GROUP BY X.SEQ , 
       DECODE(X.SEQ, 1, NULL, A.NA_BZPLC) , 
       DECODE(X.SEQ, 1, NULL, A.NA_TEAM_C) , 
       DECODE(X.SEQ, 1, NULL, A.SLP_DT) , 
       DECODE(X.SEQ, 1, NULL, A.NA_SLPNO) , 
       DECODE(X.SEQ, 1, NULL, A.MNGT_NA_TRPL_C) , 
       DECODE(X.SEQ, 1, NULL, A.TRSLPNO) , 
       DECODE(X.SEQ, 1, NULL, A.RPY_PLA_DT) , 
       DECODE(X.SEQ, 1, NULL, A.ACTL_BUYPL_NA_TRPL_C) ,
       DECODE(X.SEQ, 1, NULL, A.APPLICATION_ID),
       DECODE(X.SEQ, 1, NULL, A.PBDDLY_YN),
       DECODE(X.SEQ, 1, NULL, A.DVY_PLASH_CRT_DSC)
ORDER BY SEQ,
       ACTL_BUYPL_NA_TRPL_C ,
       MNGT_NA_TRPL_C,
       TRSLPNO,
       CNR_DT ,
       RPY_PLA_DT
	</sql>
	
	<!-- 검수실적-전표별 마스터  엑셀 다운로드 -->
	<select id="downloadExcelRecadvSlpMaster" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		SELECT /** 검수실적-전표별 마스터  엑셀 다운로드(downloadExcelRecadvSlpMaster) */
	       X.SEQ , 
       DECODE(X.SEQ, 1, NULL, A.NA_BZPLC ) NA_BZPLC , 
       DECODE(X.SEQ, 1, NULL, MIN(A.NA_TEAM_C )) NA_TEAM_C , 
       DECODE(X.SEQ, 1, NULL, MIN(A.SLP_DT )) SLP_DT , 
       DECODE(X.SEQ, 1, NULL, MIN(A.NA_SLPNO )) NA_SLPNO , 
       DECODE(X.SEQ, 1, NULL, A.ACTL_BUYPL_NA_TRPL_C ) ACTL_BUYPL_NA_TRPL_C , 
       DECODE(X.SEQ, 1, NULL, MIN(A.CCLNTNM )) CCLNTNM , 
       DECODE(X.SEQ, 1, NULL, MIN(A.TRSLPNO )) TRSLPNO , 
       DECODE(X.SEQ, 1, NULL, MIN(A.CNR_DT )) CNR_DT , 
       DECODE(X.SEQ, 1, NULL, MIN(A.RPY_PLA_DT )) RPY_PLA_DT , 
       DECODE(X.SEQ, 1, NULL, MIN(A.MNGT_NA_TRPL_C)) MNGT_NA_TRPL_C , 
       DECODE(X.SEQ, 1, NULL, MIN(A.BCLNTNM )) BCLNTNM , 
       DECODE(X.SEQ, 1, NULL, MIN(A.NA_DVY_PLASH_SLPNO )) NA_DVY_PLASH_SLPNO , 
       DECODE(X.SEQ, 1, NULL, MIN(A.NA_TR_DSC )) NA_TR_DSC , 
       DECODE(X.SEQ, 1, '합계', MIN(A.NA_CRC_CAN_DSC )) NA_CRC_CAN_DSC , 
       DECODE(X.SEQ, 1, NULL, MIN(A.ROTS_CTR_DSC )) ROTS_CTR_DSC , 
       SUM(A.GAM_AM) GAM_AM , 
       SUM(A.BYNG_VAT ) BYNG_VAT , 
       SUM(A.TOT_GAM ) TOT_GAM , 
       SUM(A.CHRG_TOT ) CHRG_TOT , 
       SUM(A.VCBT_AM ) VCBT_AM , 
       SUM(A.VCBX_AM ) VCBX_AM , 
       SUM(A.CBAM ) CBAM , 
       SUM(A.COMP_FEE ) COMP_FEE , 
       SUM(A.ETR_AMN_FEE ) ETR_AMN_FEE , 
       SUM(A.ETR_AMN_VAT ) ETR_AMN_VAT , 
       SUM(A.SLGT_AMN_FEE ) SLGT_AMN_FEE , 
       SUM(A.PHD_FEE ) PHD_FEE , 
       SUM(A.PHD_FEE_VAT ) PHD_FEE_VAT , 
       SUM(A.TRP_SVC_CST ) TRP_SVC_CST , 
       SUM(A.TRP_SVCOS_VAT ) TRP_SVCOS_VAT , 
       SUM(A.ETC_FEE ) ETC_FEE , 
       SUM(A.ETC_FEE_VAT ) ETC_FEE_VAT , 
       SUM(A.BYNG_SSDY ) BYNG_SSDY , 
       SUM(A.ACRV ) ACRV , 
       SUM(A.PPYAM ) PPYAM , 
       SUM(A.PPYAM_INT ) PPYAM_INT , 
       SUM(A.AST_SAM ) AST_SAM , 
       SUM(A.CSH_AM ) CSH_AM , 
       SUM(A.TFR_AM ) TFR_AM , 
       SUM(A.AC_FTR_AM ) AC_FTR_AM , 
       SUM(A.FC_AM ) FC_AM , 
       MIN(A.CNR_DS_AM ) CNR_DS_AM , 
       DECODE(X.SEQ, 1, NULL, MIN(A.FSRGMN_ENO )) FSRGMN_ENO , 
       DECODE(X.SEQ, 1, NULL, MIN(A.ADJ_NA_BZPLC )) ADJ_NA_BZPLC , 
       DECODE(X.SEQ, 1, NULL, MIN(A.ADJ_NA_TRPL_C )) ADJ_NA_TRPL_C,
       DECODE(X.SEQ, 1, NULL, MIN(A.APPLICATION_ID )) APPLICATION_ID,
       DECODE(X.SEQ, 1, NULL, MIN(DECODE(A.PBDDLY_YN, '1', 'PB직송', '일반'))) PBDDLY_YN,
       DECODE(X.SEQ, 1, NULL, MIN(DECODE(A.DVY_PLASH_CRT_DSC, '002', '혁신', '일반'))) DVY_PLASH_CRT_DSC,
  	   DECODE(X.SEQ, 1, NULL, A.CNFM_YN ) CNFM_YN
       FROM 
       (
SELECT A.* , B.FSRGMN_ENO, B.EDIRG_DTM, B.FS_RMS_DT, B.PBDDLY_YN, B.DVY_PLASH_CRT_DSC
		FROM (
			SELECT 
			       MIN(A.byam) BYAM,
			       MIN(A.NA_BZPLC) NA_BZPLC,
			       MIN(A.NA_TEAM_C) NA_TEAM_C,
			       A.TR_DT SLP_DT,
			       A.NA_SLPNO NA_SLPNO,
			       '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC,  
			       FN_TRPL_CIF_NM(MIN(A.NA_TRPL_C)) CCLNTNM, 		<!-- 본/지사명  -->  
			       A.NA_DVY_PLASH_SLPNO, 							<!-- 배송예정서번호  -->  
			       FN_TRPL_CIF_NM(A.ACTL_BUYPL_NA_TRPL_C) BCLNTNM, 	<!-- 실매입처명  --> 
			       MIN(A.CNR_DT) CNR_DT, 							<!-- 검수일자  -->   
			       SUBSTR(A.TR_DT,1,4)||'-'||SUBSTR(A.TR_DT,5,2)||'-'|| SUBSTR(A.TR_DT,7,2)||'-'|| A.NA_SLPNO TRSLPNO,
			       A.PY_PLA_DT RPY_PLA_DT, 							<!-- 지급예정일  --> 
			       SUM(A.byam-A.byng_vat) GAM_AM, 	<!-- 공급금액(A)  -->   
			       SUM(A.byng_vat) BYNG_VAT, 		<!-- 부가세(B)  -->  
			       SUM(A.byam) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM) TOT_GAM, 	<!-- 총공급금액(C=A+B+E+F)  -->  
			       SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) 
			       + SUM(A.TRP_SVC_CST) + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) CHRG_TOT, 			<!-- 총공제금액(D=P~Y)  -->  
			       SUM(A.VCBT_AM) VCBT_AM, 		<!-- 공병금액(E)  --> 
			       SUM(A.VCBX_AM) VCBX_AM, 		<!-- 공상자금액(F)  -->  
			       SUM(A.byam) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM) - 
			       ( SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) + SUM(A.TRP_SVC_CST) 
			       + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) ) CBAM, 								<!-- 순공급금액(G=C-D)  --> 
			       DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC, 			<!-- 거래구분  -->  
			       FN_CM_SIMP_CNM('ROTS_CTR_DSC',MIN(A.ROTS_CTR_DSC)) ROTS_CTR_DSC, 	<!-- 계통구분  --> 
			       MIN(A.NA_TRPL_C) ACTL_BUYPL_NA_TRPL_C, 					<!-- 본/지사코드  -->  
			       MIN(A.ACTL_BUYPL_NA_TRPL_C) MNGT_NA_TRPL_C,   			<!-- 실매입처(농협)  --> 
			       SUM(A.COMP_FEE) COMP_FEE, 								<!-- 업체수수료(O=P+Q+R+S)  -->  
			       SUM(A.BYNG_SSDY) BYNG_SSDY, 								<!-- 매입장려금(P)  -->  
			       SUM(A.ETR_AMN_FEE) ETR_AMN_FEE, 							<!-- 관리수수료R2(Q)  -->  
			       SUM(A.ETR_AMN_VAT) ETR_AMN_VAT, 							<!-- 관리부가세R2(R)  -->  
			       SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE, 						<!-- 관리수수료R1(S)  -->  
			       SUM(A.PHD_FEE) PHD_FEE, 									<!-- 물류수수료(T)  -->   
			       SUM(A.PHD_FEE_VAT) PHD_FEE_VAT, 							<!-- 물류부가세(U)   -->  
			       SUM(A.TRP_SVC_CST) TRP_SVC_CST, 							<!-- 운송용역비(V)    -->   
			       SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT, 						<!-- 운송부가세(W)    -->  
			       SUM(A.ETC_FEE) ETC_FEE, 									<!-- 기타수수료(X)    --> 
			       SUM(A.ETC_FEE_VAT) ETC_FEE_VAT, 							<!-- 기타부가세(Y)    -->  
			       MIN(A.ADJ_NA_BZPLC) ADJ_NA_BZPLC, 						<!-- 정산사업장코드    -->  
			       MIN(A.NA_ADJPL_C) ADJ_NA_TRPL_C, 						<!-- 정산처코드    --> 
			       0 ACRV 													<!-- 미수금    --> 
			       , 0 PPYAM 												<!-- 선급금    -->  
			       , 0 PPYAM_INT 											<!-- 선급금이자    -->  
			       , 0 AST_SAM 												<!-- 보조금    -->  
			       , 0 CSH_AM 												<!-- 현금금액    -->  
			       , 0 TFR_AM 												<!-- 대체금액    -->  
			       , 0 AC_FTR_AM 											<!-- 계좌이체금액    -->  
			       , 0 FC_AM 												<!-- 외화금액    --> 
			       , FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) CNR_DS_AM 	<!-- 선급금    --> 
			       , A.APPLICATION_ID
			       , CASE 
						 WHEN M.DOC_NAME = 'CONADV' AND M.FS_RMS_DT IS NULL THEN '검수미확인'
						 WHEN M.DOC_NAME = 'CONRET' AND M.FS_RMS_DT IS NULL THEN '반품미확인'
						 WHEN M.DOC_NAME = 'CONADV' AND M.FS_RMS_DT IS NOT NULL THEN '검수확인'
						 WHEN M.DOC_NAME = 'CONRET' AND M.FS_RMS_DT IS NOT NULL THEN '반품확인'
					END AS CNFM_YN
			  FROM TB_DP_CM_SLP_CNR_RZS A
				 , TB_BY_BYNG_M M
			 WHERE A.NA_TRPL_C IN 
			 		<foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
				    #{item}
					</foreach>
			       <choose>
						<when test="SEARCH_DATE_TYPE == '1'.toString()">
							AND A.TR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
						<when test="SEARCH_DATE_TYPE == '2'.toString()">
							AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
						<when test="SEARCH_DATE_TYPE == '3'.toString()">
							AND A.PY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
					</choose>
					<choose>
						<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
							<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
						</when>
						<when test="TRADE_TYPE == '1'.toString()">
							AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
							AND A.NA_CRC_CAN_DSC = '1'
						</when>
						<when test="TRADE_TYPE == '2'.toString()">
							AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
							AND A.NA_CRC_CAN_DSC = '1'
						</when>
						<when test="TRADE_TYPE == '3'.toString()">
							AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
						</when>
						<when test="TRADE_TYPE == '4'.toString()">
							AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
						</when>
					</choose>
					<choose>
						<when test="CNFM_YN == null or CNFM_YN == ''">
							AND A.NA_TRPL_C = M.BUYPL_NA_TRPL_C
							AND A.TR_DT = M.SLP_DT
							AND A.NA_TEAM_C = M.NA_TEAM_C
							AND A.NA_SLPNO = M.NA_SLPNO
							AND A.NA_BZPLC = M.NA_BZPLC
						</when>
						<when test="CNFM_YN == '1'.toString()">
							AND A.NA_TRPL_C = M.BUYPL_NA_TRPL_C
							AND A.TR_DT = M.SLP_DT
							AND A.NA_TEAM_C = M.NA_TEAM_C
							AND A.NA_SLPNO = M.NA_SLPNO
							AND A.NA_BZPLC = M.NA_BZPLC
							AND M.DOC_NAME IN ('CONADV')
							AND M.FS_RMS_DT IS NULL													
						</when>
						<when test="CNFM_YN == '2'.toString()">
							AND A.NA_TRPL_C = M.BUYPL_NA_TRPL_C
							AND A.TR_DT = M.SLP_DT
							AND A.NA_TEAM_C = M.NA_TEAM_C
							AND A.NA_SLPNO = M.NA_SLPNO
							AND A.NA_BZPLC = M.NA_BZPLC
							AND M.DOC_NAME IN ('CONRET')
							AND M.FS_RMS_DT IS NULL							
						</when>
						<when test="CNFM_YN == '3'.toString()">
							AND A.NA_TRPL_C = M.BUYPL_NA_TRPL_C
							AND A.TR_DT = M.SLP_DT
							AND A.NA_TEAM_C = M.NA_TEAM_C
							AND A.NA_SLPNO = M.NA_SLPNO
							AND A.NA_BZPLC = M.NA_BZPLC
							AND M.DOC_NAME IN ('CONRET', 'CONADV')
							AND M.FS_RMS_DT IS NULL
						</when>
					</choose>					
					<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
						AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
					</if>
			 GROUP BY 
			       A.NA_CRC_CAN_DSC, 
			       A.ACTL_BUYPL_NA_TRPL_C, 
			       A.TR_DT, 
			       A.NA_SLPNO, 
			       A.NA_DVY_PLASH_SLPNO, 
			       A.DVYAA_NA_TRPL_C, 
			       A.PY_PLA_DT, 
			       A.NA_TR_DSC,
				   M.DOC_NAME,
				   M.FS_RMS_DT,
			       A.APPLICATION_ID
			 ORDER BY 
			       A.DVYAA_NA_TRPL_C, 
			       A.NA_DVY_PLASH_SLPNO
       ) A
       , TB_OD_DLVPNSHT_M B
        WHERE A.NA_DVY_PLASH_SLPNO = B.NA_DVY_PLASH_SLPNO(+) 
        AND A.ACTL_BUYPL_NA_TRPL_C = B.SPYPL_NA_TRPL_C(+) 
        AND A.MNGT_NA_TRPL_C = B.DVYAA_NA_TRPL_C(+)
        <if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
		<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
			AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
		</if>
	  	</if>
	  	AND B.DVY_PLA_DT(+) BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-180,'YYYYMMDD') AND #{TO_DATE}
        )A , 
     (SELECT LEVEL SEQ 
       FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> 2
     ) X
 GROUP BY X.SEQ , 
       DECODE(X.SEQ, 1, NULL, A.NA_BZPLC) , 
       DECODE(X.SEQ, 1, NULL, A.NA_TEAM_C) , 
       DECODE(X.SEQ, 1, NULL, A.SLP_DT) , 
       DECODE(X.SEQ, 1, NULL, A.NA_SLPNO) , 
       DECODE(X.SEQ, 1, NULL, A.MNGT_NA_TRPL_C) , 
       DECODE(X.SEQ, 1, NULL, A.TRSLPNO) , 
       DECODE(X.SEQ, 1, NULL, A.RPY_PLA_DT) , 
       DECODE(X.SEQ, 1, NULL, A.ACTL_BUYPL_NA_TRPL_C) ,
       DECODE(X.SEQ, 1, NULL, A.APPLICATION_ID),
       DECODE(X.SEQ, 1, NULL, A.PBDDLY_YN),
       DECODE(X.SEQ, 1, NULL, A.DVY_PLASH_CRT_DSC),
       DECODE(X.SEQ, 1, NULL, A.CNFM_YN )
ORDER BY SEQ,
       ACTL_BUYPL_NA_TRPL_C ,
       MNGT_NA_TRPL_C,
       TRSLPNO,
       CNR_DT ,
       RPY_PLA_DT
	</select>
	
	<select id="downloadExcelRecadvSlpMaster_Join_back" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT GRDM.*, GRDD.*, GRDS.*
		FROM
		(SELECT
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO			
			,DECODE(NA_CRC_CAN_DSC,'2','[2] 정정','3','[3] 취소', '[' || NA_CRC_CAN_DSC || '] 정상') NA_CRC_CAN_DSC
			,C.CLNTNM CCLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/ <!-- 배송지거래처코드가 없을땐 경제통합사업장코드명으로 -->
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,A.RPY_PLA_DT

			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM - BYNG_VAT) AS GAM_AM /*공급금액 A*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * BYNG_VAT AS BYNG_VAT /*부가세 B*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM + VCBT_AM + VCBX_AM) TOT_GAM /*총공급금액 C=A+B+E+F*/			
			
			,(NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) + 
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) + 
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) + 
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
			0+0 CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBT_AM AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBX_AM AS VCBX_AM /*공상자금액 F*/
			
			,(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM + VCBT_AM + VCBX_AM)) -
			((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) + 
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) + 
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) + 
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
			0+0) CBAM /*순공급금액 G=C-D*/
			
			, DECODE(NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC			
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
			,A.ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/ <!-- 배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			,(NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) + 
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) + 
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
			(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) COMP_FEE /* O 업체수수료      */
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
		
		   <!--  , NVL(SUM( CASE WHEN D.SLP_SQNO != 0 THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETC_FEE                                    /* 기타수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETC_FEE_VAT                                /* 기타수수료부가세 */ -->		 
			, 0 ETC_FEE /* 기타수수료       */
			, 0 ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,'DESADV' FSRGMN_ENO
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
		FROM TB_BY_BYNG_M A, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC	
		WHERE 1=1
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.ACTL_BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = D.NA_BZPLC(+)
			AND A.NA_TEAM_C = D.NA_TEAM_C(+)
			AND A.SLP_DT = D.SLP_DT(+)
			AND A.NA_SLPNO = D.NA_SLPNO(+)
			
			AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">				
					AND A.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 배송지여야 함, DVYAA_NA_TRPL_C -->
					AND A.DVYAA_NA_TRPL_C = #{NA_BZPLC}
				</if>
		GROUP BY
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,NA_CRC_CAN_DSC
			,C.CLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처명*/
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,A.RPY_PLA_DT
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM - BYNG_VAT) /*공급금액 A*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * BYNG_VAT /*부가세 B*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM + VCBT_AM + VCBX_AM) /*총공급금액 C=A+B+E+F*/		
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBX_AM /*공상자금액 F*/		
			,DECODE(NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
			,A.ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*실매입처(농협)*/			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
		) GRDM,
		(SELECT
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.SLP_SQNO
			,A.NA_WRS_C
			,B.WRSNM				
			,'['||A.TXT_DSC||'] '||FN_CM_SIMP_CNM('TXT_DSC',A.TXT_DSC) TXT_DSC /* 과세구분*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYAM AS BYAM /*총공급금액*/
			,A.BYNG_UPR
			,A.BYNG_QT
			,(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYAM)-(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYNG_VAT) AS GAM_AM /*공급금액*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYNG_VAT AS BYNG_VAT /*매입부가세*/
			,C.WRS_STDNM
			,A.VCBT_NA_WRS_C
			,A.VCBT_QT
			,NVL(A.VCBT_AM/DECODE(A.VCBT_QT,0,NULL,A.VCBT_QT),0) AS VCBT_UPR
			,B.INPD_QT
			,B.PD_YY
			,A.BYNG_WT
			,A.RPY_PLA_DT
			,NVL(A.BYNG_UPR*A.BYNG_QT,0) AS BYNG_AM
			,DECODE(C.WHT,'0','없음',C.WHT||FN_CM_SIMP_CNM('NA_WRS_UNT_C',LPAD(C.NA_WRS_UNT_C,3,'0'))) AS NA_WRS_UNT_C /* 단위 */
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) AS CNR_DS_AM /*검수구분금액 매출정상:+ 매출 정정,취소:- 반품정상:- 반품 정정,취소:+ */
		FROM TB_BY_BYNG_WRS A, TB_OD_TRTWRS B, TB_GD_WRS C 
		WHERE A.NA_BZPLC = B.NA_BZPLC
		AND A.NA_WRS_C = B.NA_WRS_C
		AND A.NA_WRS_C = C.NA_WRS_C
		) GRDD,
		(SELECT /*+ no_push_pred(b) */
			A.SLP_SQNO,
			A.NA_FEE_C,			
			NVL(A.FEENM,'기타') FEENM, /* 수수료명 */
			(NVL(FN_CNR_DS_AM(B.NA_TR_DSC,B.NA_CRC_CAN_DSC),0)*(SPY_AM - TXT_VAT)) SPY_AM_VAT,
			A.SPY_AM,
			(NVL(FN_CNR_DS_AM(B.NA_TR_DSC,B.NA_CRC_CAN_DSC),0)*TXT_VAT) AS TXT_VAT,			
			A.NA_SLPNO,
			A.SLP_DT,
			A.NA_TEAM_C,
			A.NA_BZPLC
		FROM TB_BY_BYNG_FEE A, TB_BY_BYNG_WRS B
		WHERE 1=1
			AND B.NA_BZPLC = A.NA_BZPLC(+) 
			AND B.NA_TEAM_C = A.NA_TEAM_C(+) 
			AND B.SLP_DT = A.SLP_DT(+) 
			AND B.NA_SLPNO = A.NA_SLPNO(+) 
			AND B.SLP_SQNO = A.SLP_SQNO(+) 
			AND (SPY_AM > 0 OR TXT_VAT > 0)
		) GRDS
		WHERE 1=1
			AND GRDM.NA_BZPLC = GRDD.NA_BZPLC
			AND GRDM.NA_TEAM_C = GRDD.NA_TEAM_C
			AND GRDM.SLP_DT = GRDD.SLP_DT
			AND GRDM.NA_SLPNO = GRDD.NA_SLPNO
			AND GRDD.NA_BZPLC = GRDS.NA_BZPLC(+)
			AND GRDD.NA_TEAM_C = GRDS.NA_TEAM_C(+)		
			AND GRDD.SLP_DT = GRDS.SLP_DT(+)
			AND GRDD.NA_SLPNO = GRDS.NA_SLPNO(+)
			AND GRDD.SLP_SQNO = GRDS.SLP_SQNO(+)
		ORDER BY GRDM.MNGT_NA_TRPL_C, GRDM.BCLNTNM, GRDM.CCLNTNM, GRDM.CNR_DT,GRDM.RPY_PLA_DT,GRDM.ACTL_BUYPL_NA_TRPL_C,GRDD.SLP_SQNO
	</select>
		
	<select id="downloadExcelRecadvSlpMaster_back" parameterType="java.util.Map" resultType="java.util.Map">
			SELECT GRDM.*, GRDD.*, GRDS.*
			FROM
			(SELECT
				NA_BZPLC
				,NA_TEAM_C
				,SLP_DT
				,NA_SLPNO
				<!-- ,NA_CRC_CAN_DSC -->
				, (SELECT '('||TC.SIMP_C||') '||TC.SIMP_CNM FROM TB_CM_SIMPC TC WHERE TC.SIMP_TPC='NA_CRC_CAN_DSC' AND TC.SIMP_C = A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC
				,B.CLNTNM BCLNTNM
				, NA_DVY_PLASH_SLPNO
				,C.CLNTNM CCLNTNM
				,CNR_DT
				,SUBSTR(SLP_DT,1,4)||'-'||SUBSTR(SLP_DT,5,2)||'-'|| SUBSTR(SLP_DT,7,2)||'-'||NA_SLPNO  TRSLPNO
				,RPY_PLA_DT
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) * (BYAM - BYNG_VAT) AS GAM_AM /*공급금액 A*/
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) * BYNG_VAT AS BYNG_VAT /*부가세 B*/
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) * (BYAM + VCBT_AM + VCBX_AM) TOT_GAM /*총공급금액 C=A+B+E+F*/
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) * 0 CHRG_TOT /*총공제금액 D=P~Y*/
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) * VCBT_AM AS VCBT_AM /*공병금액 E*/
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) * VCBX_AM AS VCBX_AM /*공상자금액 F*/
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) * (BYAM + VCBT_AM + VCBX_AM)-0 CBAM /*순공급금액 G=C-D*/
				<!-- ,NA_TR_DSC -->
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB','매출','반품') AS NA_TR_DSC
				<!-- ,ROTS_CTR_DSC -->
				,(SELECT TC.SIMP_CNM FROM TB_CM_SIMPC TC WHERE TC.SIMP_TPC='ROTS_CTR_DSC' AND TC.SIMP_C = A.ROTS_CTR_DSC ) AS ROTS_CTR_DSC
				,MNGT_NA_TRPL_C
				,ACTL_BUYPL_NA_TRPL_C
				,0 COMP_FEE
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) * BYNG_SSDY AS BYNG_SSDY /*매입장려금 P*/
				,0 ETR_AMN_FEE
				,0 ETR_AMN_VAT
				,0 SLGT_AMN_FEE
				,0 PHD_FEE
				,0 PHD_FEE_VAT
				,0 TRP_SVC_CST
				,0 TRP_SVCOS_VAT
				,0 ETC_FEE
				,0 ETC_FEE_VAT
				,ADJ_NA_BZPLC
				,ADJ_NA_TRPL_C
				,'DEV' FSRGMN_ENO
				,EDIRG_DTM /*배달일시*/
				,FS_RMS_DT /*수신일시*/
			FROM TB_BY_BYNG_M A, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C
			WHERE 1=1
			AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
			AND A.ACTL_BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)			
			AND A.BUYPL_NA_TRPL_C IN
        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
    		#{item}
		</foreach>
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
				AND slp_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
				AND cnr_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
				AND rpy_pla_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
				<![CDATA[AND na_tr_dsc <> 'ID01']]>
			</when>
			<when test="TRADE_TYPE == '1'.toString()">
				AND na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06')
				AND na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND na_tr_dsc IN ('OB01', 'OB03', 'OB04')
				AND na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND na_crc_can_dsc = '1') OR (na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND na_crc_can_dsc IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND na_crc_can_dsc IN ('2','3')) OR (na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND na_crc_can_dsc = '1'))
			</when>
		</choose>
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
				AND ACTL_BUYPL_NA_TRPL_C = #{NA_BZPLC}
			</if>) GRDM,
			(SELECT				
				A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,A.SLP_SQNO
				,A.NA_WRS_C
				,B.WRSNM				
				,'['||A.TXT_DSC||'] '||FN_CM_SIMP_CNM('TXT_DSC',A.TXT_DSC) TXT_DSC /* 과세구분*/
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) *A.BYAM AS BYAM /*총공급금액*/
				,A.BYNG_UPR
				,A.BYNG_QT
				,(DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) *A.BYAM)
				 -(DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) *A.BYNG_VAT) AS GAM_AM /*공급금액*/
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) *A.BYNG_VAT AS BYNG_VAT /*매입부가세*/
				,C.WRS_STDNM
				,A.VCBT_NA_WRS_C
				,A.VCBT_QT
				,NVL(A.VCBT_AM/DECODE(A.VCBT_QT,0,NULL,A.VCBT_QT),0) AS VCBT_UPR
				,B.INPD_QT
				,B.PD_YY
				,A.BYNG_WT
				,A.RPY_PLA_DT
				,NVL(A.BYNG_UPR*A.BYNG_QT,0) AS BYNG_AM
				,DECODE(C.WHT,'0','없음',C.WHT||FN_CM_SIMP_CNM('NA_WRS_UNT_C',LPAD(C.NA_WRS_UNT_C,3,'0'))) AS NA_WRS_UNT_C /* 단위 */
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) AS CNR_DS_AM /*검수구분금액 매출정상:+ 매출 정정,취소:- 반품정상:- 반품 정정,취소:+ */				
			FROM TB_BY_BYNG_WRS A, TB_OD_TRTWRS B, TB_GD_WRS C 
			WHERE A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_WRS_C = B.NA_WRS_C
			AND A.NA_WRS_C = C.NA_WRS_C
			) GRDD,
		(SELECT
			SLP_SQNO,
			NA_FEE_C,
			FEENM,
			(SPY_AM - TXT_VAT) SPY_AM_VAT,
			TXT_VAT,
			NA_SLPNO,
			SLP_DT,
			NA_TEAM_C,
			NA_BZPLC
		FROM TB_BY_BYNG_FEE
		WHERE 1=1
		AND (SPY_AM > 0 OR TXT_VAT > 0)) GRDS
		WHERE 1=1
			AND GRDM.NA_BZPLC = GRDD.NA_BZPLC(+)
			AND GRDM.NA_TEAM_C = GRDD.NA_TEAM_C(+)		
			AND GRDM.SLP_DT = GRDD.SLP_DT(+)
			AND GRDM.NA_SLPNO = GRDD.NA_SLPNO(+)
			AND GRDD.NA_BZPLC = GRDS.NA_BZPLC(+)
			AND GRDD.NA_TEAM_C = GRDS.NA_TEAM_C(+)		
			AND GRDD.SLP_DT = GRDS.SLP_DT(+)
			AND GRDD.NA_SLPNO = GRDS.NA_SLPNO(+)
			AND GRDD.SLP_SQNO = GRDS.SLP_SQNO(+)
		ORDER BY GRDM.MNGT_NA_TRPL_C, GRDM.BCLNTNM, GRDM.CCLNTNM, GRDM.CNR_DT,GRDM.RPY_PLA_DT,GRDM.ACTL_BUYPL_NA_TRPL_C
	</select>
	
	<!-- 검수실적-전표별 디테일  엑셀 다운로드 -->
	<select id="downloadExcelRecadvSlpDetail" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		SELECT GRDM.*, GRDD.*, GRDS.*
		FROM
		(SELECT 
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.NA_CRC_CAN_DSC,
		A.CCLNTNM,
		A.NA_DVY_PLASH_SLPNO,
		<!-- BCLNTNM, -->
		B.CLNTNM BCLNTNM /*실매입처명*/,
		A.CNR_DT,
		A.TRSLPNO,
		A.RPY_PLA_DT,
		SUM(A.BYAM-A.BYNG_VAT) GAM_AM,
		SUM(A.BYNG_VAT) BYNG_VAT,
		SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM,
		SUM(A.CHRG_TOT) CHRG_TOT,
		SUM(A.VCBT_AM) VCBT_AM,
		SUM(A.VCBX_AM) VCBX_AM,
		SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM)-(A.CHRG_TOT)) CBAM,
		A.NA_TR_DSC,
		A.ROTS_CTR_DSC,
		A.ACTL_BUYPL_NA_TRPL_C,
		A.MNGT_NA_TRPL_C,
		SUM(A.COMP_FEE) COMP_FEE,
		SUM(A.BYNG_SSDY) BYNG_SSDY,
		SUM(A.ETR_AMN_FEE) ETR_AMN_FEE,
		SUM(A.ETR_AMN_VAT) ETR_AMN_VAT,
		SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE,
		SUM(A.PHD_FEE) PHD_FEE,
		SUM(A.PHD_FEE_VAT) PHD_FEE_VAT,
		SUM(A.TRP_SVC_CST) TRP_SVC_CST,
		SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT,
		SUM(A.ETC_FEE) ETC_FEE,
		SUM(A.ETC_FEE_VAT) ETC_FEE_VAT,
		A.ADJ_NA_BZPLC,
		A.ADJ_NA_TRPL_C,
		<!-- A.FSRGMN_ENO, -->
		MIN(Y.fsrgmn_eno) FSRGMN_ENO,
		A.EDIRG_DTM,
		A.FS_RMS_DT
	FROM (
	
		SELECT
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO			
			, '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC
			,C.CLNTNM CCLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			
			<!--,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/ -->
			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/

			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/

			
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC			
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			
			<!-- ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/  배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			<!-- ,'DESADV' FSRGMN_ENO -->
			,NVL(MIN(A.DVYAA_NA_TRPL_C     ),' ')    DVYAA_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
		FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
		GROUP BY
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.NA_CRC_CAN_DSC
			,C.CLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			<!-- ,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처명*/ -->
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,WRS.RPY_PLA_DT
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)	
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
			,A.BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*실매입처(농협)*/			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			,A.NA_BZPLC 
			,A.NA_TEAM_C 
			,A.SLP_DT                      
            ,A.NA_SLPNO
            ,WRS.SLP_SQNO 		
		
	) A
	, TB_TR_TRPL_CIF B
	, TB_OD_DLVPNSHT_M Y              
WHERE 1=1
AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
	GROUP BY
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.NA_CRC_CAN_DSC,
		A.CCLNTNM,
		A.NA_DVY_PLASH_SLPNO,
		B.CLNTNM,
		A.CNR_DT,
		A.TRSLPNO,
		A.RPY_PLA_DT,
		A.NA_TR_DSC,
		A.ROTS_CTR_DSC,
		A.ACTL_BUYPL_NA_TRPL_C,
		A.MNGT_NA_TRPL_C,
		A.ADJ_NA_BZPLC,
		A.ADJ_NA_TRPL_C,		
		A.EDIRG_DTM,
		A.FS_RMS_DT	
		) GRDM,
		(SELECT
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.SLP_SQNO
			,A.NA_WRS_C
			,B.WRSNM				
			,'['||A.TXT_DSC||'] '||FN_CM_SIMP_CNM('TXT_DSC',A.TXT_DSC) TXT_DSC /* 과세구분*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYAM AS BYAM_D /*총공급금액*/
			,A.BYNG_UPR BYNG_UPR_D
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYNG_QT AS BYNG_QT_D
			,(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYAM)-(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYNG_VAT) AS GAM_AM_D /*공급금액*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYNG_VAT AS BYNG_VAT_D /*매입부가세*/
			,C.WRS_STDNM
			,A.VCBT_NA_WRS_C
			,A.VCBT_QT
			,NVL(A.VCBT_AM/DECODE(A.VCBT_QT,0,NULL,A.VCBT_QT),0) AS VCBT_UPR
			,B.INPD_QT
			,B.PD_YY
			,A.BYNG_WT
			,A.RPY_PLA_DT
			<!-- ,NVL(A.BYNG_UPR*A.BYNG_QT,0) AS BYNG_AM -->
			,TRUNC(NVL(A.BYNG_UPR*A.BYNG_QT,0)) AS BYNG_AM
			,DECODE(C.WHT,'0','없음',C.WHT||FN_CM_SIMP_CNM('NA_WRS_UNT_C',LPAD(C.NA_WRS_UNT_C,3,'0'))) AS NA_WRS_UNT_C /* 단위 */
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) AS CNR_DS_AM /*검수구분금액 매출정상:+ 매출 정정,취소:- 반품정상:- 반품 정정,취소:+ */
		FROM TB_BY_BYNG_WRS A, TB_OD_TRTWRS B, TB_GD_WRS C 
		WHERE A.NA_BZPLC = B.NA_BZPLC
		AND A.NA_WRS_C = B.NA_WRS_C
		AND A.NA_WRS_C = C.NA_WRS_C
		AND NVL(A.DEL_YN, 0) = 0  /* 삭제여부 (1: 여, 0: 부) */
		) GRDD,
		(SELECT /*+ no_push_pred(b) */
			A.SLP_SQNO,
			A.NA_FEE_C,			
			NVL(A.FEENM,'기타') FEENM, /* 수수료명 */
			(NVL(FN_CNR_DS_AM(B.NA_TR_DSC,B.NA_CRC_CAN_DSC),0)*(SPY_AM - TXT_VAT)) SPY_AM_VAT,
			A.SPY_AM,
			(NVL(FN_CNR_DS_AM(B.NA_TR_DSC,B.NA_CRC_CAN_DSC),0)*TXT_VAT) AS TXT_VAT,			
			A.NA_SLPNO,
			A.SLP_DT,
			A.NA_TEAM_C,
			A.NA_BZPLC
		FROM TB_BY_BYNG_FEE A, TB_BY_BYNG_WRS B
		WHERE 1=1
			AND B.NA_BZPLC = A.NA_BZPLC(+) 
			AND B.NA_TEAM_C = A.NA_TEAM_C(+) 
			AND B.SLP_DT = A.SLP_DT(+) 
			AND B.NA_SLPNO = A.NA_SLPNO(+) 
			AND B.SLP_SQNO = A.SLP_SQNO(+) 
			AND (SPY_AM > 0 OR TXT_VAT > 0)
		) GRDS
		WHERE 1=1
			AND GRDM.NA_BZPLC = GRDD.NA_BZPLC
			AND GRDM.NA_TEAM_C = GRDD.NA_TEAM_C
			AND GRDM.SLP_DT = GRDD.SLP_DT
			AND GRDM.NA_SLPNO = GRDD.NA_SLPNO
			AND GRDM.RPY_PLA_DT = GRDD.RPY_PLA_DT
			AND GRDD.NA_BZPLC = GRDS.NA_BZPLC(+)
			AND GRDD.NA_TEAM_C = GRDS.NA_TEAM_C(+)		
			AND GRDD.SLP_DT = GRDS.SLP_DT(+)
			AND GRDD.NA_SLPNO = GRDS.NA_SLPNO(+)
			AND GRDD.SLP_SQNO = GRDS.SLP_SQNO(+)
			<if test="NA_BZPLC != null and NA_BZPLC.length() > 0">
			AND GRDD.NA_BZPLC = #{NA_BZPLC}
			</if>
			<if test="NA_TEAM_C != null and NA_TEAM_C.length() >  0">
				AND GRDD.NA_TEAM_C = #{NA_TEAM_C}
			</if>
			<if test="SLP_DT != null and SLP_DT.length() > 0">
				AND GRDD.SLP_DT = #{SLP_DT}
			</if>
			<if test="NA_SLPNO != null and NA_SLPNO.length() > 0">
				AND GRDD.NA_SLPNO = #{NA_SLPNO}
			</if>
			<if test="RPY_PLA_DT != null and RPY_PLA_DT.length() > 0">
				AND GRDD.RPY_PLA_DT = #{RPY_PLA_DT}
			</if>	
		ORDER BY GRDM.MNGT_NA_TRPL_C, GRDM.BCLNTNM, GRDM.CCLNTNM, GRDM.CNR_DT,GRDM.RPY_PLA_DT,GRDM.ACTL_BUYPL_NA_TRPL_C,GRDD.SLP_SQNO
	</select>
	
	<select id="downloadExcelRecadvSlpDetail_20151116" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT GRDM.*, GRDD.*, GRDS.*
		FROM
		(SELECT
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO			
			,DECODE(NA_CRC_CAN_DSC,'2','[2] 정정','3','[3] 취소', '[' || NA_CRC_CAN_DSC || '] 정상') NA_CRC_CAN_DSC
			,C.CLNTNM CCLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/ <!-- 배송지거래처코드가 없을땐 경제통합사업장코드명으로 -->
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,A.RPY_PLA_DT

			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM - BYNG_VAT) AS GAM_AM /*공급금액 A*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * BYNG_VAT AS BYNG_VAT /*부가세 B*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM + VCBT_AM + VCBX_AM) TOT_GAM /*총공급금액 C=A+B+E+F*/			
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.VCBT_AM AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.VCBX_AM AS VCBX_AM /*공상자금액 F*/
			
			,(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (A.BYAM + A.VCBT_AM + A.VCBX_AM)) -
			(NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      )) CBAM /*순공급금액 G=C-D*/
			
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC			
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
			,A.ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/ <!-- 배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,'DESADV' FSRGMN_ENO
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
		FROM TB_BY_BYNG_M A, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.ACTL_BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = D.NA_BZPLC(+)
			AND A.NA_TEAM_C = D.NA_TEAM_C(+)
			AND A.SLP_DT = D.SLP_DT(+)
			AND A.NA_SLPNO = D.NA_SLPNO(+)
			
			AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 배송지여야 함, DVYAA_NA_TRPL_C -->
					AND A.DVYAA_NA_TRPL_C = #{NA_BZPLC}
				</if>
		GROUP BY
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,NA_CRC_CAN_DSC
			,C.CLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			,NVL(B.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처명*/
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,A.RPY_PLA_DT
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM - BYNG_VAT) /*공급금액 A*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * BYNG_VAT /*부가세 B*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM + VCBT_AM + VCBX_AM) /*총공급금액 C=A+B+E+F*/		
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBX_AM /*공상자금액 F*/		
			,DECODE(NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
			,A.ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*실매입처(농협)*/			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
		) GRDM,
		(SELECT
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.SLP_SQNO
			,A.NA_WRS_C
			,B.WRSNM				
			,'['||A.TXT_DSC||'] '||FN_CM_SIMP_CNM('TXT_DSC',A.TXT_DSC) TXT_DSC /* 과세구분*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYAM AS BYAM /*총공급금액*/
			,A.BYNG_UPR
			,A.BYNG_QT
			,(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYAM)-(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYNG_VAT) AS GAM_AM /*공급금액*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYNG_VAT AS BYNG_VAT /*매입부가세*/
			,C.WRS_STDNM
			,A.VCBT_NA_WRS_C
			,A.VCBT_QT
			,NVL(A.VCBT_AM/DECODE(A.VCBT_QT,0,NULL,A.VCBT_QT),0) AS VCBT_UPR
			,B.INPD_QT
			,B.PD_YY
			,A.BYNG_WT
			,A.RPY_PLA_DT
			,NVL(A.BYNG_UPR*A.BYNG_QT,0) AS BYNG_AM
			,DECODE(C.WHT,'0','없음',C.WHT||FN_CM_SIMP_CNM('NA_WRS_UNT_C',LPAD(C.NA_WRS_UNT_C,3,'0'))) AS NA_WRS_UNT_C /* 단위 */
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) AS CNR_DS_AM /*검수구분금액 매출정상:+ 매출 정정,취소:- 반품정상:- 반품 정정,취소:+ */
		FROM TB_BY_BYNG_WRS A, TB_OD_TRTWRS B, TB_GD_WRS C 
		WHERE A.NA_BZPLC = B.NA_BZPLC
		AND A.NA_WRS_C = B.NA_WRS_C
		AND A.NA_WRS_C = C.NA_WRS_C
		) GRDD,
		(SELECT /*+ no_push_pred(b) */
			A.SLP_SQNO,
			A.NA_FEE_C,			
			NVL(A.FEENM,'기타') FEENM, /* 수수료명 */
			(NVL(FN_CNR_DS_AM(B.NA_TR_DSC,B.NA_CRC_CAN_DSC),0)*(SPY_AM - TXT_VAT)) SPY_AM_VAT,
			A.SPY_AM,
			(NVL(FN_CNR_DS_AM(B.NA_TR_DSC,B.NA_CRC_CAN_DSC),0)*TXT_VAT) AS TXT_VAT,			
			A.NA_SLPNO,
			A.SLP_DT,
			A.NA_TEAM_C,
			A.NA_BZPLC
		FROM TB_BY_BYNG_FEE A, TB_BY_BYNG_WRS B
		WHERE 1=1
			AND B.NA_BZPLC = A.NA_BZPLC(+) 
			AND B.NA_TEAM_C = A.NA_TEAM_C(+) 
			AND B.SLP_DT = A.SLP_DT(+) 
			AND B.NA_SLPNO = A.NA_SLPNO(+) 
			AND B.SLP_SQNO = A.SLP_SQNO(+) 
			AND (SPY_AM > 0 OR TXT_VAT > 0)
		) GRDS
		WHERE 1=1
			AND GRDM.NA_BZPLC = GRDD.NA_BZPLC
			AND GRDM.NA_TEAM_C = GRDD.NA_TEAM_C
			AND GRDM.SLP_DT = GRDD.SLP_DT
			AND GRDM.NA_SLPNO = GRDD.NA_SLPNO
			AND GRDD.NA_BZPLC = GRDS.NA_BZPLC(+)
			AND GRDD.NA_TEAM_C = GRDS.NA_TEAM_C(+)		
			AND GRDD.SLP_DT = GRDS.SLP_DT(+)
			AND GRDD.NA_SLPNO = GRDS.NA_SLPNO(+)
			AND GRDD.SLP_SQNO = GRDS.SLP_SQNO(+)
			<if test="NA_BZPLC != null and NA_BZPLC.length() > 0">
			AND GRDD.NA_BZPLC = #{NA_BZPLC}
			</if>
			<if test="NA_TEAM_C != null and NA_TEAM_C.length() >  0">
				AND GRDD.NA_TEAM_C = #{NA_TEAM_C}
			</if>
			<if test="SLP_DT != null and SLP_DT.length() > 0">
				AND GRDD.SLP_DT = #{SLP_DT}
			</if>
			<if test="NA_SLPNO != null and NA_SLPNO.length() > 0">
				AND GRDD.NA_SLPNO = #{NA_SLPNO}
			</if>
			<if test="RPY_PLA_DT != null and RPY_PLA_DT.length() > 0">
				AND GRDD.RPY_PLA_DT = #{RPY_PLA_DT}
			</if>	
		ORDER BY GRDM.MNGT_NA_TRPL_C, GRDM.BCLNTNM, GRDM.CCLNTNM, GRDM.CNR_DT,GRDM.RPY_PLA_DT,GRDM.ACTL_BUYPL_NA_TRPL_C,GRDD.SLP_SQNO
	</select>
	
	<select id="downloadExcelRecadvSlpDetail_back" parameterType="java.util.Map" resultType="java.util.Map">
			SELECT GRDM.*, GRDD.*, GRDS.*
			FROM
			(SELECT
				NA_BZPLC
				,NA_TEAM_C
				,SLP_DT
				,NA_SLPNO
				<!-- ,NA_CRC_CAN_DSC -->
				, (SELECT '('||TC.SIMP_C||') '||TC.SIMP_CNM FROM TB_CM_SIMPC TC WHERE TC.SIMP_TPC='NA_CRC_CAN_DSC' AND TC.SIMP_C = A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC
				,B.CLNTNM BCLNTNM
				, NA_DVY_PLASH_SLPNO
				,C.CLNTNM CCLNTNM
				,CNR_DT
				,SUBSTR(SLP_DT,1,4)||'-'||SUBSTR(SLP_DT,5,2)||'-'|| SUBSTR(SLP_DT,7,2)||'-'||NA_SLPNO  TRSLPNO
				,RPY_PLA_DT
				,(BYAM - BYNG_VAT) GAM_AM
				,BYNG_VAT
				,(BYAM + VCBT_AM + VCBX_AM) TOT_GAM
				,0 CHRG_TOT
				,VCBT_AM
				,VCBX_AM
				,(BYAM + VCBT_AM + VCBX_AM)-0 CBAM
				<!-- ,NA_TR_DSC -->
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB','매출','반품') AS NA_TR_DSC
				<!-- ,ROTS_CTR_DSC -->
				,(SELECT TC.SIMP_CNM FROM TB_CM_SIMPC TC WHERE TC.SIMP_TPC='ROTS_CTR_DSC' AND TC.SIMP_C = A.ROTS_CTR_DSC ) AS ROTS_CTR_DSC
				,MNGT_NA_TRPL_C
				,ACTL_BUYPL_NA_TRPL_C
				,0 COMP_FEE
				,BYNG_SSDY
				,0 ETR_AMN_FEE
				,0 ETR_AMN_VAT
				,0 SLGT_AMN_FEE
				,0 PHD_FEE
				,0 PHD_FEE_VAT
				,0 TRP_SVC_CST
				,0 TRP_SVCOS_VAT
				,0 ETC_FEE
				,0 ETC_FEE_VAT
				,ADJ_NA_BZPLC
				,ADJ_NA_TRPL_C
				,'DEV' FSRGMN_ENO
				,EDIRG_DTM /*배달일시*/
				,FS_RMS_DT /*수신일시*/
			FROM TB_BY_BYNG_M A, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C
			WHERE 1=1
			AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
			AND A.ACTL_BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)			
			AND A.BUYPL_NA_TRPL_C IN
        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
    		#{item}
		</foreach>
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
				AND slp_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
				AND cnr_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
				AND rpy_pla_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
				<![CDATA[AND na_tr_dsc <> 'ID01']]>
			</when>
			<when test="TRADE_TYPE == '1'.toString()">
				AND na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06')
				AND na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND na_tr_dsc IN ('OB01', 'OB03', 'OB04')
				AND na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND na_crc_can_dsc = '1') OR (na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND na_crc_can_dsc IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND na_crc_can_dsc IN ('2','3')) OR (na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND na_crc_can_dsc = '1'))
			</when>
		</choose>
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
				AND ACTL_BUYPL_NA_TRPL_C = #{NA_BZPLC}
			</if>) GRDM,
			(SELECT				
				A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,A.SLP_SQNO
				,A.NA_WRS_C
				,B.WRSNM				
				,'['||A.TXT_DSC||'] '||FN_CM_SIMP_CNM('TXT_DSC',A.TXT_DSC) TXT_DSC /* 과세구분*/
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) *A.BYAM AS BYAM /*총공급금액*/
				,A.BYNG_UPR
				,A.BYNG_QT
				,(DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) *A.BYAM)
				 -(DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) *A.BYNG_VAT) AS GAM_AM /*공급금액*/
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) *A.BYNG_VAT AS BYNG_VAT /*매입부가세*/
				,C.WRS_STDNM
				,A.VCBT_NA_WRS_C
				,A.VCBT_QT
				,NVL(A.VCBT_AM/DECODE(A.VCBT_QT,0,NULL,A.VCBT_QT),0) AS VCBT_UPR
				,B.INPD_QT
				,B.PD_YY
				,A.BYNG_WT
				,A.RPY_PLA_DT
				,NVL(A.BYNG_UPR*A.BYNG_QT,0) AS BYNG_AM
				,DECODE(C.WHT,'0','없음',C.WHT||FN_CM_SIMP_CNM('NA_WRS_UNT_C',LPAD(C.NA_WRS_UNT_C,3,'0'))) AS NA_WRS_UNT_C /* 단위 */
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB',DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','1','-1'),DECODE(SUBSTR(NA_CRC_CAN_DSC,0,1),'1','-1','1')) AS CNR_DS_AM /*검수구분금액 매출정상:+ 매출 정정,취소:- 반품정상:- 반품 정정,취소:+ */				
			FROM TB_BY_BYNG_WRS A, TB_OD_TRTWRS B, TB_GD_WRS C 
			WHERE A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_WRS_C = B.NA_WRS_C
			AND A.NA_WRS_C = C.NA_WRS_C
			) GRDD,
		(SELECT 
			SLP_SQNO,
			NA_FEE_C,
			FEENM,
			(SPY_AM - TXT_VAT) SPY_AM_VAT,
			TXT_VAT,
			NA_SLPNO,
			SLP_DT,
			NA_TEAM_C,
			NA_BZPLC
		FROM TB_BY_BYNG_FEE
		WHERE 1=1
		AND (SPY_AM > 0 OR TXT_VAT > 0)) GRDS
		WHERE 1=1
		AND GRDM.NA_BZPLC = GRDD.NA_BZPLC(+)
		AND GRDM.NA_TEAM_C = GRDD.NA_TEAM_C(+)		
		AND GRDM.SLP_DT = GRDD.SLP_DT(+)
		AND GRDM.NA_SLPNO = GRDD.NA_SLPNO(+)
		AND GRDD.NA_BZPLC = GRDS.NA_BZPLC(+)
		AND GRDD.NA_TEAM_C = GRDS.NA_TEAM_C(+)		
		AND GRDD.SLP_DT = GRDS.SLP_DT(+)
		AND GRDD.NA_SLPNO = GRDS.NA_SLPNO(+)
		AND GRDD.SLP_SQNO = GRDS.SLP_SQNO(+)
		<if test="NA_BZPLC != null and NA_BZPLC.length() > 0">
			AND GRDD.NA_BZPLC = #{NA_BZPLC}
		</if>
		<if test="NA_TEAM_C != null and NA_TEAM_C.length() >  0">
			AND GRDD.NA_TEAM_C = #{NA_TEAM_C}
		</if>
		<if test="SLP_DT != null and SLP_DT.length() > 0">
			AND GRDD.SLP_DT = #{SLP_DT}
		</if>
		<if test="NA_SLPNO != null and NA_SLPNO.length() > 0">
			AND GRDD.NA_SLPNO = #{NA_SLPNO}
		</if>
		ORDER BY GRDM.MNGT_NA_TRPL_C, GRDM.BCLNTNM, GRDM.CCLNTNM, GRDM.CNR_DT,GRDM.RPY_PLA_DT,GRDM.ACTL_BUYPL_NA_TRPL_C
	</select>
	
	<!-- 검수실적-전표별 전표 상품 수수료 합계  엑셀 다운로드 -->
	<select id="downloadExcelRecadvSlpCommisionSum" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
	SELECT /** 검수실적-전표별 전표 상품 수수료 합계  엑셀 다운로드(downloadExcelRecadvSlpCommisionSum) */
		A.MNGT_NA_TRPL_C
		, B.CLNTNM BCLNTNM
		, A.TRSLPNO
		, A.CNR_DT
		, A.RPY_PLA_DT
		, A.NA_DVY_PLASH_SLPNO
		, A.ACTL_BUYPL_NA_TRPL_C
		, A.CCLNTNM
		, A.NA_BZPLC
		, A.BZPL_NM
		, A.SPY_TPC
		, A.ROTS_CTR_DSC
		, A.SLP_SQNO
		, A.NA_WRS_C
		, A.PD_YY
		, A.WRSNM
		, A.WRS_STDNM
		, A.TXT_DSC
		, A.BYNG_WT
		, A.INPD_QT
		, A.BYNG_UPR
		, A.BYNG_QT
		, A.GAM_AM
		, A.BYNG_VAT
		, A.BYAM
		, A.SPY_AM_VAT
		, A.TXT_VAT
		, A.NA_TR_DSC
		, A.NA_TR_DSC_NM
		, A.NA_CRC_CAN_DSC
		, A.NA_CRC_CAN_DSC_NM
		<!-- , FSRGMN_ENO -->
		, (Y.fsrgmn_eno) FSRGMN_ENO		
		, A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
		, DECODE(Y.PBDDLY_YN, '1', 'PB직송', '일반') PBDDLY_YN
		, DECODE(Y.DVY_PLASH_CRT_DSC, '002', '혁신', '일반') DVY_PLASH_CRT_DSC
		, A.CNFM_YN
		FROM
		(SELECT		
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO,
					 
			NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
						
			<!-- ,NVL(FN_TRPL_CIF_NM(A.DVYAA_NA_TRPL_C),FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/ -->
			
			
			
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO /*매출일자-전표번호*/
			,A.CNR_DT /* 검수일자*/
			<!-- ,A.RPY_PLA_DT /*지급예정일*/ -->
			,(B.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/
			,A.NA_DVY_PLASH_SLPNO /*배송예정서번호*/
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본/지사코드*/
			,FN_TRPL_CIF_NM(A.BUYPL_NA_TRPL_C) CCLNTNM /*본/지사명*/
			,A.NA_BZPLC /*경제통합사업장코드*/
			,FN_TRPL_CIF_NM(A.NA_BZPLC) BZPL_NM /*사업장명*/
			,FN_CM_SIMP_CNM('SPY_TPC',B.SPY_TPC) SPY_TPC /*공급유형*/
			,FN_CM_SIMP_CNM('ROTS_CTR_DSC',A.ROTS_CTR_DSC) ROTS_CTR_DSC /*계통계약구분*/
			,B.SLP_SQNO/*전표일련번호*/
			,B.NA_WRS_C/*경제통합상품코드*/
			,C.PD_YY/*생산년도*/
			,C.WRSNM/*상품명*/
			,D.WRS_STDNM/*상품규격*/
			,DECODE(B.TXT_DSC,'1','과세','2','면세','3','영세',B.TXT_DSC) TXT_DSC /*과세구분코드명*/
						
			,NVL(B.BYNG_WT,0) BYNG_WT/*입고중량*/			
			,C.INPD_QT/*내품수량*/
			,B.BYNG_UPR/*매입단가*/
			,B.BYNG_QT/*매입수량*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (B.BYAM - B.BYNG_VAT) AS GAM_AM /*공급금액 A*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * B.BYNG_VAT AS BYNG_VAT /*매입 부가세*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (B.BYAM) BYAM /*매입금액*/
			
			,NVL(SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (E.SPY_AM - E.TXT_VAT)),0) SPY_AM_VAT/*수수료*/
			,NVL(SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * E.TXT_VAT),0) TXT_VAT /*수수료부가세*/
			
			, A.NA_TR_DSC
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC_NM
			, A.NA_CRC_CAN_DSC
			, '(' || A.NA_CRC_CAN_DSC || ') ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC_NM
			, CASE 
				 WHEN A.DOC_NAME = 'CONADV' AND A.FS_RMS_DT IS NULL THEN '검수미확인'
				 WHEN A.DOC_NAME = 'CONRET' AND A.FS_RMS_DT IS NULL THEN '반품미확인'
				 WHEN A.DOC_NAME = 'CONADV' AND A.FS_RMS_DT IS NOT NULL THEN '검수확인'
				 WHEN A.DOC_NAME = 'CONRET' AND A.FS_RMS_DT IS NOT NULL THEN '반품확인'
			END AS CNFM_YN
			<!-- ,'DEV' FSRGMN_ENO /*최초등록자개인번호, 배송예정서 작성자 */ -->
		FROM TB_BY_BYNG_M A, TB_BY_BYNG_WRS B, TB_OD_TRTWRS C, TB_GD_WRS D, TB_BY_BYNG_FEE E, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			AND A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_TEAM_C = B.NA_TEAM_C
			AND A.SLP_DT = B.SLP_DT 
			AND A.NA_SLPNO = B.NA_SLPNO
			AND B.NA_BZPLC = C.NA_BZPLC
			AND B.NA_WRS_C = C.NA_WRS_C
			AND B.NA_WRS_C = D.NA_WRS_C
			AND B.NA_BZPLC = E.NA_BZPLC(+)
			AND B.NA_TEAM_C = E.NA_TEAM_C(+)
			AND B.SLP_DT = E.SLP_DT(+)
			AND B.NA_SLPNO = E.NA_SLPNO(+)
			AND B.SLP_SQNO = E.SLP_SQNO(+)
			AND (E.spy_am > 0 OR E.txt_vat > 0 OR E.na_bzplc IS NULL)	
			
			AND NVL(A.DEL_YN, 0) = '0'  /* 삭제여부 (1: 여, 0: 부) */
			
			AND A.BUYPL_NA_TRPL_C IN
		<foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
    		#{item}
		</foreach>
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
				AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
				AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
				<!-- 				AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE} -->
				AND B.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				AND A.SLP_DT <![CDATA[>]]> TO_CHAR( TO_DATE(#{FROM_DATE}, 'YYYYMMDD') - 91, 'YYYYMMDD')
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
				<!-- <![CDATA[AND A.na_tr_dsc <> 'ID01']]> -->
			</when>
			<when test="TRADE_TYPE == '1'.toString()">
				AND A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06')
				AND A.na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND A.na_tr_dsc IN ('OB01', 'OB03', 'OB04')
				AND A.na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.na_crc_can_dsc = '1') OR (A.na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND A.na_crc_can_dsc IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.na_crc_can_dsc IN ('2','3')) OR (A.na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND A.na_crc_can_dsc = '1'))
			</when>
		</choose>
		<choose>
			<when test="CNFM_YN == '1'.toString()">
				AND A.DOC_NAME IN ('CONADV')
				AND A.FS_RMS_DT IS NULL				
			</when>
			<when test="CNFM_YN == '2'.toString()">
				AND A.DOC_NAME IN ('CONRET')
				AND A.FS_RMS_DT IS NULL
			</when>
			<when test="CNFM_YN == '3'.toString()">
				AND A.DOC_NAME IN ('CONRET', 'CONADV')
				AND A.FS_RMS_DT IS NULL
			</when>
		</choose>
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>		
		GROUP BY
			<!-- NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) -->
			<!-- NVL(FN_TRPL_CIF_NM(A.DVYAA_NA_TRPL_C),FN_TRPL_CIF_NM(A.NA_BZPLC)) -->
			SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,A.CNR_DT
			,B.RPY_PLA_DT
			,A.NA_DVY_PLASH_SLPNO
			,A.BUYPL_NA_TRPL_C
			,A.NA_BZPLC
			,B.SPY_TPC
			,A.ROTS_CTR_DSC
			,B.SLP_SQNO
			,B.NA_WRS_C
			,C.PD_YY
			,C.WRSNM
			,D.WRS_STDNM
			,B.TXT_DSC
			,B.BYNG_WT
			,C.INPD_QT
			,B.BYNG_UPR
			,B.BYNG_QT
			,B.BYNG_VAT
			,B.BYAM
			,A.NA_TR_DSC
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,A.NA_CRC_CAN_DSC
			,DECODE(A.NA_CRC_CAN_DSC,'2','(2)정정','3','(3)취소','('||A.NA_CRC_CAN_DSC||')정상')
			, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
			, A.DOC_NAME
			, A.FS_RMS_DT
		) A
	, TB_TR_TRPL_CIF B
	, TB_OD_DLVPNSHT_M Y
	WHERE 1=1
	AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
	<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
		<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
			AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
		</if>
	</if>
	AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
	AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
	AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
	AND Y.DVY_PLA_DT(+) BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-180,'YYYYMMDD') AND #{TO_DATE}
	ORDER BY 3, 13, 1 , 2
	
	</select>
	
	<select id="downloadExcelRecadvSlpCommisionSum_20151114" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT			 
			 NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/			
			,NVL(FN_TRPL_CIF_NM(A.DVYAA_NA_TRPL_C),FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO /*매출일자-전표번호*/
			,A.CNR_DT /* 검수일자*/
			,A.RPY_PLA_DT /*지급예정일*/
			,A.NA_DVY_PLASH_SLPNO /*배송예정서번호*/
			,A.ACTL_BUYPL_NA_TRPL_C /*본/지사코드*/
			,FN_TRPL_CIF_NM(A.ACTL_BUYPL_NA_TRPL_C) CCLNTNM /*본/지사명*/
			,A.NA_BZPLC /*경제통합사업장코드*/
			,FN_TRPL_CIF_NM(A.NA_BZPLC) BZPL_NM /*사업장명*/
			,FN_CM_SIMP_CNM('SPY_TPC',B.SPY_TPC) SPY_TPC /*공급유형*/
			,FN_CM_SIMP_CNM('ROTS_CTR_DSC',A.ROTS_CTR_DSC) ROTS_CTR_DSC /*계통계약구분*/
			,B.SLP_SQNO/*전표일련번호*/
			,B.NA_WRS_C/*경제통합상품코드*/
			,C.PD_YY/*생산년도*/
			,C.WRSNM/*상품명*/
			,D.WRS_STDNM/*상품규격*/
			,DECODE(B.TXT_DSC,'1','과세','2','면세','3','영세',B.TXT_DSC) TXT_DSC /*과세구분코드명*/
						
			,NVL(B.BYNG_WT,0) BYNG_WT/*입고중량*/			
			,C.INPD_QT/*내품수량*/
			,B.BYNG_UPR/*매입단가*/
			,B.BYNG_QT/*매입수량*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (B.BYAM - B.BYNG_VAT) AS GAM_AM /*공급금액 A*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * B.BYNG_VAT AS BYNG_VAT /*매입 부가세*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (B.BYAM) BYAM /*매입금액*/
			,NVL(SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (E.SPY_AM - E.TXT_VAT)),0) SPY_AM_VAT/*수수료*/
			,NVL(SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * E.TXT_VAT),0) TXT_VAT /*수수료부가세*/
			
			, A.NA_TR_DSC
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC_NM
			, A.NA_CRC_CAN_DSC
			, '(' || A.NA_CRC_CAN_DSC || ') ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC_NM
			,'DEV' FSRGMN_ENO /*최초등록자개인번호, 배송예정서 작성자 */
		FROM TB_BY_BYNG_M A, TB_BY_BYNG_WRS B, TB_OD_TRTWRS C, TB_GD_WRS D, TB_BY_BYNG_FEE E 
		WHERE 1=1
			AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */
			AND A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_TEAM_C = B.NA_TEAM_C
			AND A.SLP_DT = B.SLP_DT 
			AND A.NA_SLPNO = B.NA_SLPNO
			AND B.NA_BZPLC = C.NA_BZPLC
			AND B.NA_WRS_C = C.NA_WRS_C
			AND B.NA_WRS_C = D.NA_WRS_C
			AND B.NA_BZPLC = E.NA_BZPLC(+)
			AND B.NA_TEAM_C = E.NA_TEAM_C(+)
			AND B.SLP_DT = E.SLP_DT(+)
			AND B.NA_SLPNO = E.NA_SLPNO(+)
			AND B.SLP_SQNO = E.SLP_SQNO(+)			
			AND A.BUYPL_NA_TRPL_C IN
		<foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
    		#{item}
		</foreach>
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
				AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
				AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
				AND A.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
				<![CDATA[AND A.na_tr_dsc <> 'ID01']]>
			</when>
			<when test="TRADE_TYPE == '1'.toString()">
				AND A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06')
				AND A.na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND A.na_tr_dsc IN ('OB01', 'OB03', 'OB04')
				AND A.na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.na_crc_can_dsc = '1') OR (A.na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND A.na_crc_can_dsc IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.na_crc_can_dsc IN ('2','3')) OR (A.na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND A.na_crc_can_dsc = '1'))
			</when>
		</choose>
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 배송지여야 함, DVYAA_NA_TRPL_C -->
				AND A.DVYAA_NA_TRPL_C = #{NA_BZPLC}
			</if>			
		GROUP BY
			NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC)
			,NVL(FN_TRPL_CIF_NM(A.DVYAA_NA_TRPL_C),FN_TRPL_CIF_NM(A.NA_BZPLC))
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,A.CNR_DT
			,A.RPY_PLA_DT
			,A.NA_DVY_PLASH_SLPNO
			,A.ACTL_BUYPL_NA_TRPL_C
			,A.NA_BZPLC
			,B.SPY_TPC
			,A.ROTS_CTR_DSC
			,B.SLP_SQNO
			,B.NA_WRS_C
			,C.PD_YY
			,C.WRSNM
			,D.WRS_STDNM
			,B.TXT_DSC
			,B.BYNG_WT
			,C.INPD_QT
			,B.BYNG_UPR
			,B.BYNG_QT
			,B.BYNG_VAT
			,B.BYAM
			,A.NA_TR_DSC
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,A.NA_CRC_CAN_DSC
			,DECODE(A.NA_CRC_CAN_DSC,'2','(2)정정','3','(3)취소','('||A.NA_CRC_CAN_DSC||')정상')
			--,FSRGMN_ENO
		ORDER BY 3, 13, 1 , 2
	</select>
	
	<!-- 검수실적-전표별 전표 상품 수수료 상세  엑셀 다운로드 -->
	<select id="downloadExcelRecadvSlpCommisionDetail" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		SELECT	/** 검수실적-전표별 전표 상품 수수료 상세  엑셀 다운로드 */
		  A.MNGT_NA_TRPL_C
		, B.CLNTNM BCLNTNM
		, A.TRSLPNO
		, A.CNR_DT
		, A.RPY_PLA_DT
		, A.NA_DVY_PLASH_SLPNO
		, A.ACTL_BUYPL_NA_TRPL_C
		, A.CCLNTNM
		, A.NA_BZPLC
		, A.BZPL_NM
		, A.SPY_TPC
		, A.ROTS_CTR_DSC
		, A.SLP_SQNO
		, A.NA_WRS_C
		, A.PD_YY
		, A.WRSNM
		, A.WRS_STDNM
		, A.TXT_DSC
		, A.BYNG_WT
		, A.INPD_QT
		, A.BYNG_UPR
		, A.BYNG_QT
		, A.GAM_AM
		, A.BYNG_VAT
		, A.BYAM
		, A.SPY_AM_VAT
		, A.TXT_VAT
		, A.NA_FEE_C
		, A.FEENM
		, A.NA_TR_DSC
		, A.NA_TR_DSC_NM
		, A.NA_CRC_CAN_DSC
		, A.NA_CRC_CAN_DSC_NM
		<!-- , FSRGMN_ENO -->
		, (Y.fsrgmn_eno) FSRGMN_ENO		
		, A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
		, DECODE(Y.PBDDLY_YN, '1', 'PB직송', '일반') PBDDLY_YN
		, DECODE(Y.DVY_PLASH_CRT_DSC, '002', '혁신', '일반') DVY_PLASH_CRT_DSC
		, A.CNFM_YN
		FROM
		(
		SELECT
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO,
			NVL((CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
						
			<!-- ,NVL(FN_TRPL_CIF_NM(A.DVYAA_NA_TRPL_C),FN_TRPL_CIF_NM(A.NA_BZPLC)) BCLNTNM /*실매입처명*/ -->
			
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO /*매출일자-전표번호*/
			,A.CNR_DT /* 검수일자*/
			,(B.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/
			,A.NA_DVY_PLASH_SLPNO /*배송예정서번호*/
			,A.ACTL_BUYPL_NA_TRPL_C /*본/지사코드*/
			,FN_TRPL_CIF_NM(A.ACTL_BUYPL_NA_TRPL_C) CCLNTNM /*본/지사명*/
			,A.NA_BZPLC /*경제통합사업장코드*/
			,FN_TRPL_CIF_NM(A.NA_BZPLC) BZPL_NM /*사업장명*/
			,FN_CM_SIMP_CNM('SPY_TPC',B.SPY_TPC) SPY_TPC /*공급유형*/
			,FN_CM_SIMP_CNM('ROTS_CTR_DSC',A.ROTS_CTR_DSC) ROTS_CTR_DSC /*계통계약구분*/
			,B.SLP_SQNO/*전표일련번호*/
			,B.NA_WRS_C/*경제통합상품코드*/
			,C.PD_YY/*생산년도*/
			,C.WRSNM/*상품명*/
			,D.WRS_STDNM/*상품규격*/
			,DECODE(B.TXT_DSC,'1','과세','2','면세','3','영세',B.TXT_DSC) TXT_DSC /*과세구분코드명*/			
			,NVL(B.BYNG_WT,0) BYNG_WT/*입고중량*/
			,C.INPD_QT/*내품수량*/
			,B.BYNG_UPR/*매입단가*/
			,B.BYNG_QT/*매입수량*/			
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (B.BYAM - B.BYNG_VAT) AS GAM_AM /*공급금액 A*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * B.BYNG_VAT AS BYNG_VAT /*매입 부가세*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (B.BYAM) BYAM /*매입금액*/
<!-- 			,E.FEE_ACG_ACCC /*수수료회계계정코드*/
			,E.BZPL_ACCNM AS FEE_ACG_ACCC_NM /*수수료회계계정명*/	 -->					
			,NVL((FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (E.SPY_AM - E.TXT_VAT)),0) SPY_AM_VAT/*수수료*/
			,NVL((FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * E.TXT_VAT),0) TXT_VAT /*수수료부가세*/
			,NA_FEE_C /* 수수료코드 */
			,NVL(FEENM,'기타') FEENM /* 수수료명 */
			,A.NA_TR_DSC
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC_NM
			,A.NA_CRC_CAN_DSC
			, '(' || A.NA_CRC_CAN_DSC || ') ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC_NM
			, CASE 
				 WHEN A.DOC_NAME = 'CONADV' AND A.FS_RMS_DT IS NULL THEN '검수미확인'
				 WHEN A.DOC_NAME = 'CONRET' AND A.FS_RMS_DT IS NULL THEN '반품미확인'
				 WHEN A.DOC_NAME = 'CONADV' AND A.FS_RMS_DT IS NOT NULL THEN '검수확인'
				 WHEN A.DOC_NAME = 'CONRET' AND A.FS_RMS_DT IS NOT NULL THEN '반품확인'
			END AS CNFM_YN
			<!-- ,'DEV' FSRGMN_ENO /*최초등록자개인번호, 배송예정서 작성자 */ -->
		FROM TB_BY_BYNG_M A, TB_BY_BYNG_WRS B, TB_OD_TRTWRS C, TB_GD_WRS D, TB_BY_BYNG_FEE E, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			AND A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_TEAM_C = B.NA_TEAM_C 
			AND A.SLP_DT = B.SLP_DT 
			AND A.NA_SLPNO = B.NA_SLPNO
			AND B.NA_BZPLC = C.NA_BZPLC
			AND B.NA_WRS_C = C.NA_WRS_C
			AND B.NA_WRS_C = D.NA_WRS_C
			AND B.NA_BZPLC = E.NA_BZPLC(+)
			AND B.NA_TEAM_C = E.NA_TEAM_C(+)
			AND B.SLP_DT = E.SLP_DT(+)
			AND B.NA_SLPNO = E.NA_SLPNO(+)
			AND B.SLP_SQNO = E.SLP_SQNO(+)
			AND (E.spy_am > 0 OR E.txt_vat > 0 OR E.na_bzplc IS NULL)			
			
			AND NVL(A.DEL_YN, 0) = '0'  /* 삭제여부 (1: 여, 0: 부) */
			
			AND A.BUYPL_NA_TRPL_C IN
		<foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
    		#{item}
		</foreach>
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
				AND A.slp_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
				AND A.cnr_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
				<!-- 				AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE} -->
				AND B.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				AND A.SLP_DT <![CDATA[>]]> TO_CHAR( TO_DATE(#{FROM_DATE}, 'YYYYMMDD') - 91, 'YYYYMMDD')
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
				<!-- <![CDATA[AND A.na_tr_dsc <> 'ID01']]> -->
			</when>
			<when test="TRADE_TYPE == '1'.toString()">
				AND A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06')
				AND A.na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND A.na_tr_dsc IN ('OB01', 'OB03', 'OB04')
				AND A.na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.na_crc_can_dsc = '1') OR (A.na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND A.na_crc_can_dsc IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.na_crc_can_dsc IN ('2','3')) OR (A.na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND A.na_crc_can_dsc = '1'))
			</when>
		</choose>
		<choose>
			<when test="CNFM_YN == '1'.toString()">
				AND A.DOC_NAME IN ('CONADV')
				AND A.FS_RMS_DT IS NULL
			</when>
			<when test="CNFM_YN == '2'.toString()">
				AND A.DOC_NAME IN ('CONRET')
				AND A.FS_RMS_DT IS NULL
			</when>
			<when test="CNFM_YN == '3'.toString()">
				AND A.DOC_NAME IN ('CONRET', 'CONADV')
				AND A.FS_RMS_DT IS NULL
			</when>
		</choose>		
		<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
			AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
		</if>		
			<!-- ORDERBY 3, 13, 1 , 2, NA_FEE_C -->
		) A
		, TB_TR_TRPL_CIF B
		, TB_OD_DLVPNSHT_M Y
	WHERE 1=1
		AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C		
		<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
			</if>
		</if>			
		AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
		AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
		AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
		AND Y.DVY_PLA_DT(+) BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-180,'YYYYMMDD') AND #{TO_DATE}
	ORDER BY A.ACTL_BUYPL_NA_TRPL_C, A.CCLNTNM, A.TRSLPNO, A.SLP_SQNO	
	<!-- ORDER BY 3, 13, 1 , 2, NA_FEE_C -->
	</select>	
	
	<!-- 검수실적 직송분 마스터 -->
	<sql id="sql_retrieveRecadvDdlyMasterList_backup">
	with temp_tab as (
		SELECT /*+ materialize */
				A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,C.CLNTNM CCLNTNM /*본지사명*/				
				,A.NA_DVY_PLASH_SLPNO
				
				<!-- ,B.CLNTNM BCLNTNM /*물류센터명*/
				,NVL(G.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) DDLY_CCLNTNM /*직송실매입처명*/ -->
				
				,A.CNR_DT
				,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
				,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/
				
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
				
				<!-- ,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/ -->
				
				,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
				+(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
				+((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
				((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
				))
				-
				((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
				)     
				+((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
				) CHRG_TOT /*총공제금액 D=P~Y*/
								
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/
				
				<!-- ,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.VCBT_AM),0) AS VCBT_AM /*공병금액 E*/
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(A.VCBX_AM),0) AS VCBX_AM /*공상자금액 F*/ -->				
				
				, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC 
				,DECODE(A.NA_CRC_CAN_DSC,'2','[2] 정정','3','[3] 취소', '[' || A.NA_CRC_CAN_DSC || '] 정상') NA_CRC_CAN_DSC								
				,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
								
				,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
				
				<!-- ,A.MNGT_NA_TRPL_C /* 물류센터*/				
				,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS DDLY_BUYPL_NA_TRPL_C /*직송실매입처*/ -->
				
				, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
				(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
				WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
				ELSE A.DVYAA_NA_TRPL_C END )
				WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
				A.NA_BZPLC
				ELSE
				(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
				WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
				ELSE A.DVYAA_NA_TRPL_C END )
				END),' ' ) AS MNGT_NA_TRPL_C /*물류센터*/
				, NVL(MIN(CASE WHEN ROTS_CTR_DSC IN ('1', '2', '3') AND BZPL_TPC = '504' AND BZPL_DTI_TPC <![CDATA[<>]]> '001' AND A.NA_BZPLC <![CDATA[<>]]> NVL(TRIM(A.DVYAA_NA_TRPL_C),A.ACTL_BUYPL_NA_TRPL_C) THEN A.DVYAA_NA_TRPL_C ELSE NULL END),' ' ) AS DDLY_BUYPL_NA_TRPL_C /*직송실매입처*/
				
				,(NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) COMP_FEE /* O 업체수수료      */
				
				,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */				
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */

				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
								
				,((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
				) 
				AS ETC_FEE  /* 기타수수료       */
		        
				,((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
				) AS ETC_FEE_VAT /* 기타수수료 부가세      */
				
				<!-- ,'DEV' FSRGMN_ENO -->
				,A.EDIRG_DTM /*배달일시*/
				,A.FS_RMS_DT /*수신일시*/
			FROM
				TB_BY_BYNG_M A
				,TB_BY_BYNG_WRS WRS
				<!-- , TB_TR_TRPL_CIF B
				, TB_TR_TRPL_CIF G -->
				, TB_TR_TRPL_CIF C				
				, TB_CM_BZPL F
				, TB_BY_BYNG_FEE D
				, TB_CM_SIMPC TC
			WHERE 1=1
				AND TC.SIMP_TPC='ROTS_CTR_DSC'
				AND TC.SIMP_C = A.ROTS_CTR_DSC
				
				AND A.NA_BZPLC = WRS.NA_BZPLC 
	            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
	            AND A.SLP_DT = WRS.SLP_DT 
	            AND A.NA_SLPNO = WRS.NA_SLPNO
            
				AND WRS.NA_BZPLC = D.NA_BZPLC(+)
				AND WRS.NA_TEAM_C = D.NA_TEAM_C(+)
				AND WRS.SLP_DT = D.SLP_DT(+)
				AND WRS.NA_SLPNO = D.NA_SLPNO(+)
				AND WRS.SLP_SQNO = D.SLP_SQNO(+)

				<!-- AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C 
				AND A.DVYAA_NA_TRPL_C = G.NA_TRPL_C(+) -->
				
				AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C /*본지사코드*/
				
				<!-- AND A.DDLY_BUYPL_NA_TRPL_C IS NOT NULL -->
				AND A.DDLY_YN = '1' /* 직송여부 1: 여 , 0: 부 */
				<!-- AND A.BUYPL_NA_TRPL_C = F.NA_TRPL_C(+) -->		
				AND A.NA_BZPLC            = F.NA_BZPLC
				AND A.BUYPL_NA_TRPL_C IN
		     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
			</foreach>		
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
			    AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
			    AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">			    
			    AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
				AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == '1'.toString()">
				AND A.NA_TR_DSC = 'IB01'
				AND A.NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND A.NA_TR_DSC = 'OB01'
				AND A.NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC = '1'))
			</when>
		</choose>		
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}				
			</if>			
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
				AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
			</if>
			GROUP BY         
				 A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,C.CLNTNM /*본지사명*/				
				,A.NA_DVY_PLASH_SLPNO
				
				<!-- ,B.CLNTNM /*물류센터명*/
        		,NVL(G.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처별*/ -->
        		
				,A.CNR_DT
				,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
				,WRS.RPY_PLA_DT
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)	      			
		        ,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')		
		        ,A.NA_CRC_CAN_DSC
		        ,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
		        ,A.BUYPL_NA_TRPL_C /*본지사코드*/
		         
		        <!-- ,A.MNGT_NA_TRPL_C /* 물류센터*/ 
		        ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*직송실매입처*/ -->
		        
		        ,A.EDIRG_DTM /*배달일시*/
				,A.FS_RMS_DT /*수신일시*/
				,A.NA_BZPLC 
				,A.NA_TEAM_C 
				,A.SLP_DT                      
	            ,A.NA_SLPNO
	            ,WRS.SLP_SQNO
	)
	SELECT 
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.NA_CRC_CAN_DSC,
		A.CCLNTNM,
		A.NA_DVY_PLASH_SLPNO,
		<!-- A.BCLNTNM, -->
		B.CLNTNM BCLNTNM, /*물류센터명*/
		<!-- A.DDLY_CCLNTNM, --> 
		C.CLNTNM DDLY_CCLNTNM, /*직송실매입처명*/
		A.CNR_DT,
		A.TRSLPNO,
		A.RPY_PLA_DT,
		SUM(A.BYAM-A.BYNG_VAT) GAM_AM,
		SUM(A.BYNG_VAT) BYNG_VAT,
		SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM,
		SUM(A.CHRG_TOT) CHRG_TOT,
		SUM(A.VCBT_AM) VCBT_AM,
		SUM(A.VCBX_AM) VCBX_AM,
		SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM)-(A.CHRG_TOT)) CBAM,
		A.NA_TR_DSC,
		A.ROTS_CTR_DSC,
		A.ACTL_BUYPL_NA_TRPL_C,
		A.MNGT_NA_TRPL_C,
		A.DDLY_BUYPL_NA_TRPL_C,
		SUM(A.COMP_FEE) COMP_FEE,
		SUM(A.BYNG_SSDY) BYNG_SSDY,
		SUM(A.ETR_AMN_FEE) ETR_AMN_FEE,
		SUM(A.ETR_AMN_VAT) ETR_AMN_VAT,
		SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE,
		SUM(A.PHD_FEE) PHD_FEE,
		SUM(A.PHD_FEE_VAT) PHD_FEE_VAT,
		SUM(A.TRP_SVC_CST) TRP_SVC_CST,
		SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT,
		SUM(A.ETC_FEE) ETC_FEE,
		SUM(A.ETC_FEE_VAT) ETC_FEE_VAT,
		<!-- FSRGMN_ENO, -->
		MIN(Y.fsrgmn_eno) FSRGMN_ENO,
		A.EDIRG_DTM,
		A.FS_RMS_DT
	FROM
		temp_tab A
		, TB_TR_TRPL_CIF B
		, TB_TR_TRPL_CIF C
		, TB_OD_DLVPNSHT_M Y       
	WHERE 1=1
	AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
	AND A.DDLY_BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
	AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
	AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
	AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
		GROUP BY
			A.NA_BZPLC,
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO,
			A.NA_CRC_CAN_DSC,
			A.CCLNTNM,
			A.NA_DVY_PLASH_SLPNO,
			
			B.CLNTNM,
			C.CLNTNM,
			
			A.CNR_DT,
			A.TRSLPNO,
			A.RPY_PLA_DT,
			A.NA_TR_DSC,
			A.ROTS_CTR_DSC,
			A.ACTL_BUYPL_NA_TRPL_C,
			A.MNGT_NA_TRPL_C,
			A.DDLY_BUYPL_NA_TRPL_C,
			<!-- A.FSRGMN_ENO, -->
			A.EDIRG_DTM,
			A.FS_RMS_DT
	</sql>
	
	<!-- 검수실적 직송분 마스터 -->
	<sql id="sql_retrieveRecadvDdlyMasterList">
	SELECT        
	       A.* , 
           B.FSRGMN_ENO, 
           B.EDIRG_DTM, 
           B.FS_RMS_DT
      FROM 
           (SELECT MIN(A.NA_BZPLC) NA_BZPLC, 
                  MIN(A.NA_TEAM_C) NA_TEAM_C, 
                  A.TR_DT SLP_DT, 
                  A.NA_SLPNO NA_SLPNO,  
				  '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC,
                  FN_TRPL_CIF_NM(MIN(A.NA_TRPL_C)) CCLNTNM, 
                  A.NA_DVY_PLASH_SLPNO,
                  FN_TRPL_CIF_NM(A.ACTL_BUYPL_NA_TRPL_C) BCLNTNM, 
                  FN_TRPL_CIF_NM(MIN(A.DDLY_BUYPL_NA_TRPL_C)) DDLY_CCLNTNM,
                  MIN(A.CNR_DT) CNR_DT, 
                  SUBSTR(A.TR_DT,1,4)||'-'||SUBSTR(A.TR_DT,5,2)||'-'|| SUBSTR(A.TR_DT,7,2)||'-'|| A.NA_SLPNO TRSLPNO, 
                  A.PY_PLA_DT RPY_PLA_DT, 
                  SUM(A.byam-A.byng_vat) GAM_AM, 
                  SUM(A.byng_vat) BYNG_VAT, 
                  SUM(A.byam) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM) TOT_GAM, 
                  SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) + SUM(A.TRP_SVC_CST) + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) CHRG_TOT, 
                  SUM(A.VCBT_AM) VCBT_AM, 
                  SUM(A.VCBX_AM) VCBX_AM, 
                  SUM(A.byam) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM) - ( SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) + SUM(A.TRP_SVC_CST) + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) ) CBAM, 
                  DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC, 
                  '['||MIN(A.ROTS_CTR_DSC)||'] '||FN_CM_SIMP_CNM('ROTS_CTR_DSC',MIN(A.ROTS_CTR_DSC)) ROTS_CTR_DSC, 
                  MIN(A.NA_TRPL_C) ACTL_BUYPL_NA_TRPL_C, 
                  MIN(A.ACTL_BUYPL_NA_TRPL_C) MNGT_NA_TRPL_C,
                  MIN(A.DDLY_BUYPL_NA_TRPL_C) DDLY_BUYPL_NA_TRPL_C, 
                  SUM(A.COMP_FEE) COMP_FEE, 
                  SUM(A.BYNG_SSDY) BYNG_SSDY, 
                  SUM(A.ETR_AMN_FEE) ETR_AMN_FEE, 
                  SUM(A.ETR_AMN_VAT) ETR_AMN_VAT, 
                  SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE, 
                  SUM(A.PHD_FEE) PHD_FEE, 
                  SUM(A.PHD_FEE_VAT) PHD_FEE_VAT, 
                  SUM(A.TRP_SVC_CST) TRP_SVC_CST, 
                  SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT, 
                  SUM(A.ETC_FEE) ETC_FEE, 
                  SUM(A.ETC_FEE_VAT) ETC_FEE_VAT, 
                  MIN(A.ADJ_NA_BZPLC) ADJ_NA_BZPLC, 
                  MIN(A.NA_ADJPL_C) ADJ_NA_TRPL_C,
                  MIN(A.DDLY_YN) DDLY_YN,
                  A.DVYAA_NA_TRPL_C DVYAA_NA_TRPL_C,
                  A.APPLICATION_ID
             FROM TB_DP_CM_SLP_CNR_RZS A
            WHERE A.NA_TRPL_C IN 
                  <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   			#{item}
				  </foreach>		
					<choose>
						<when test="SEARCH_DATE_TYPE == '1'.toString()">
						    AND A.TR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
						<when test="SEARCH_DATE_TYPE == '2'.toString()">
						    AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
						<when test="SEARCH_DATE_TYPE == '3'.toString()">			    
							AND A.PY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
					</choose>
					<choose>
						<when test="TRADE_TYPE == '1'.toString()">
							AND A.NA_TR_DSC = 'IB01'
							AND A.NA_CRC_CAN_DSC = '1'
						</when>
						<when test="TRADE_TYPE == '2'.toString()">
							AND A.NA_TR_DSC = 'OB01'
							AND A.NA_CRC_CAN_DSC = '1'
						</when>
						<when test="TRADE_TYPE == '3'.toString()">
							AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC IN ('2','3')))
						</when>
						<when test="TRADE_TYPE == '4'.toString()">
							AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC = '1'))
						</when>
					</choose>		
					<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
						AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
					</if>
					<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
						AND A.ACTL_BUYPL_NA_TRPL_C = #{NA_BZPLC}				
					</if>			
					<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
						AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
					</if>
                    AND A.NA_TR_DSC <![CDATA[<>]]> 'ID01' 
                    AND A.DDLY_YN = '1'
            GROUP BY A.NA_CRC_CAN_DSC, 
                  A.ACTL_BUYPL_NA_TRPL_C, 
                  A.TR_DT, 
                  A.NA_SLPNO, 
                  A.NA_DVY_PLASH_SLPNO, 
                  A.DVYAA_NA_TRPL_C, 
                  A.PY_PLA_DT, 
                  A.NA_TR_DSC ,
                  A.APPLICATION_ID
           ) A, 
           TB_OD_DLVPNSHT_M B 
     WHERE A.NA_DVY_PLASH_SLPNO = B.NA_DVY_PLASH_SLPNO(+) 
           AND A.ACTL_BUYPL_NA_TRPL_C = B.SPYPL_NA_TRPL_C(+) 
           AND A.MNGT_NA_TRPL_C = B.DVYAA_NA_TRPL_C(+) 
     ORDER BY A.DVYAA_NA_TRPL_C, 
              A.NA_DVY_PLASH_SLPNO 
	</sql>
	
	<sql id="sql_retrieveRecadvDdlyMasterList_20151122">
	SELECT 
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.NA_CRC_CAN_DSC,
		A.CCLNTNM,
		A.NA_DVY_PLASH_SLPNO,
		<!-- A.BCLNTNM, -->
		B.CLNTNM BCLNTNM, /*물류센터명*/
		<!-- A.DDLY_CCLNTNM, --> 
		C.CLNTNM DDLY_CCLNTNM, /*직송실매입처명*/
		A.CNR_DT,
		A.TRSLPNO,
		A.RPY_PLA_DT,
		SUM(A.BYAM-A.BYNG_VAT) GAM_AM,
		SUM(A.BYNG_VAT) BYNG_VAT,
		SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM,
		SUM(A.CHRG_TOT) CHRG_TOT,
		SUM(A.VCBT_AM) VCBT_AM,
		SUM(A.VCBX_AM) VCBX_AM,
		SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM)-(A.CHRG_TOT)) CBAM,
		A.NA_TR_DSC,
		A.ROTS_CTR_DSC,
		A.ACTL_BUYPL_NA_TRPL_C,
		A.MNGT_NA_TRPL_C,
		A.DDLY_BUYPL_NA_TRPL_C,
		SUM(A.COMP_FEE) COMP_FEE,
		SUM(A.BYNG_SSDY) BYNG_SSDY,
		SUM(A.ETR_AMN_FEE) ETR_AMN_FEE,
		SUM(A.ETR_AMN_VAT) ETR_AMN_VAT,
		SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE,
		SUM(A.PHD_FEE) PHD_FEE,
		SUM(A.PHD_FEE_VAT) PHD_FEE_VAT,
		SUM(A.TRP_SVC_CST) TRP_SVC_CST,
		SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT,
		SUM(A.ETC_FEE) ETC_FEE,
		SUM(A.ETC_FEE_VAT) ETC_FEE_VAT,
		<!-- FSRGMN_ENO, -->
		MIN(Y.fsrgmn_eno) FSRGMN_ENO,
		A.EDIRG_DTM,
		A.FS_RMS_DT
	FROM (
		SELECT
				A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,C.CLNTNM CCLNTNM /*본지사명*/				
				,A.NA_DVY_PLASH_SLPNO
				
				<!-- ,B.CLNTNM BCLNTNM /*물류센터명*/
				,NVL(G.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) DDLY_CCLNTNM /*직송실매입처명*/ -->
				
				,A.CNR_DT
				,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
				,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/
				
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
				
				<!-- ,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/ -->
				
				,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
				+(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
				+NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
				+((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
				((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
				))
				-
				((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
				)     
				+((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
				) CHRG_TOT /*총공제금액 D=P~Y*/
								
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/
				
				<!-- ,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.VCBT_AM),0) AS VCBT_AM /*공병금액 E*/
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(A.VCBX_AM),0) AS VCBX_AM /*공상자금액 F*/ -->				
				
				, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC 
				,DECODE(A.NA_CRC_CAN_DSC,'2','[2] 정정','3','[3] 취소', '[' || A.NA_CRC_CAN_DSC || '] 정상') NA_CRC_CAN_DSC								
				,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
								
				,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
				
				<!-- ,A.MNGT_NA_TRPL_C /* 물류센터*/				
				,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS DDLY_BUYPL_NA_TRPL_C /*직송실매입처*/ -->
				
				, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
				(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
				WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
				ELSE A.DVYAA_NA_TRPL_C END )
				WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
				A.NA_BZPLC
				ELSE
				(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
				WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
				ELSE A.DVYAA_NA_TRPL_C END )
				END),' ' ) AS MNGT_NA_TRPL_C /*물류센터*/
				, NVL(MIN(CASE WHEN ROTS_CTR_DSC IN ('1', '2', '3') AND BZPL_TPC = '504' AND BZPL_DTI_TPC <![CDATA[<>]]> '001' AND A.NA_BZPLC <![CDATA[<>]]> NVL(TRIM(A.DVYAA_NA_TRPL_C),A.ACTL_BUYPL_NA_TRPL_C) THEN A.DVYAA_NA_TRPL_C ELSE NULL END),' ' ) AS DDLY_BUYPL_NA_TRPL_C /*직송실매입처*/
				
				,(NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) COMP_FEE /* O 업체수수료      */
				
				,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */				
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */

				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
								
				,((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
				) 
				AS ETC_FEE  /* 기타수수료       */
		        
				,((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
				NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
				) AS ETC_FEE_VAT /* 기타수수료 부가세      */
				
				<!-- ,'DEV' FSRGMN_ENO -->
				,A.EDIRG_DTM /*배달일시*/
				,A.FS_RMS_DT /*수신일시*/
			FROM
				TB_BY_BYNG_M A
				,TB_BY_BYNG_WRS WRS
				<!-- , TB_TR_TRPL_CIF B
				, TB_TR_TRPL_CIF G -->
				, TB_TR_TRPL_CIF C				
				, TB_CM_BZPL F
				, TB_BY_BYNG_FEE D
				, TB_CM_SIMPC TC
			WHERE 1=1
				AND TC.SIMP_TPC='ROTS_CTR_DSC'
				AND TC.SIMP_C = A.ROTS_CTR_DSC
				
				AND A.NA_BZPLC = WRS.NA_BZPLC 
	            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
	            AND A.SLP_DT = WRS.SLP_DT 
	            AND A.NA_SLPNO = WRS.NA_SLPNO
            
				AND WRS.NA_BZPLC = D.NA_BZPLC(+)
				AND WRS.NA_TEAM_C = D.NA_TEAM_C(+)
				AND WRS.SLP_DT = D.SLP_DT(+)
				AND WRS.NA_SLPNO = D.NA_SLPNO(+)
				AND WRS.SLP_SQNO = D.SLP_SQNO(+)

				<!-- AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C 
				AND A.DVYAA_NA_TRPL_C = G.NA_TRPL_C(+) -->
				
				AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C /*본지사코드*/
				
				<!-- AND A.DDLY_BUYPL_NA_TRPL_C IS NOT NULL -->
				AND A.DDLY_YN = '1' /* 직송여부 1: 여 , 0: 부 */
				<!-- AND A.BUYPL_NA_TRPL_C = F.NA_TRPL_C(+) -->		
				AND A.NA_BZPLC            = F.NA_BZPLC
				AND A.BUYPL_NA_TRPL_C IN
		     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
			</foreach>		
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
			    AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
			    AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
			    AND A.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == '1'.toString()">
				AND A.NA_TR_DSC = 'IB01'
				AND A.NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND A.NA_TR_DSC = 'OB01'
				AND A.NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC = '1'))
			</when>
		</choose>		
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}				
			</if>			
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
				AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
			</if>
			GROUP BY         
				 A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,C.CLNTNM /*본지사명*/				
				,A.NA_DVY_PLASH_SLPNO
				
				<!-- ,B.CLNTNM /*물류센터명*/
        		,NVL(G.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처별*/ -->
        		
				,A.CNR_DT
				,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
				,WRS.RPY_PLA_DT
				,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)	      			
		        ,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')		
		        ,A.NA_CRC_CAN_DSC
		        ,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
		        ,A.BUYPL_NA_TRPL_C /*본지사코드*/
		         
		        <!-- ,A.MNGT_NA_TRPL_C /* 물류센터*/ 
		        ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*직송실매입처*/ -->
		        
		        ,A.EDIRG_DTM /*배달일시*/
				,A.FS_RMS_DT /*수신일시*/
				,A.NA_BZPLC 
				,A.NA_TEAM_C 
				,A.SLP_DT                      
	            ,A.NA_SLPNO
	            ,WRS.SLP_SQNO
		) A
	, TB_TR_TRPL_CIF B
	, TB_TR_TRPL_CIF C
	, TB_OD_DLVPNSHT_M Y              
WHERE 1=1
AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
AND A.DDLY_BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
	GROUP BY
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.NA_CRC_CAN_DSC,
		A.CCLNTNM,
		A.NA_DVY_PLASH_SLPNO,
		
		B.CLNTNM,
		C.CLNTNM,
		
		A.CNR_DT,
		A.TRSLPNO,
		A.RPY_PLA_DT,
		A.NA_TR_DSC,
		A.ROTS_CTR_DSC,
		A.ACTL_BUYPL_NA_TRPL_C,
		A.MNGT_NA_TRPL_C,
		A.DDLY_BUYPL_NA_TRPL_C,
		<!-- A.FSRGMN_ENO, -->
		A.EDIRG_DTM,
		A.FS_RMS_DT	
    <!-- ORDER BY 
    		A.MNGT_NA_TRPL_C , 
            B.CLNTNM , 
            A.ACTL_BUYPL_NA_TRPL_C , 
            A.TRSLPNO , 
            A.CNR_DT ,
            A.RPY_PLA_DT -->
	</sql>	
		
	<sql id="sql_retrieveRecadvDdlyMasterList_20151114">
		SELECT
				A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,C.CLNTNM CCLNTNM /*본지사명*/				
				,A.NA_DVY_PLASH_SLPNO
				,B.CLNTNM BCLNTNM /*물류센터명*/
				,NVL(G.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) DDLY_CCLNTNM /*실매입처별*/
				,A.CNR_DT
				,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
				,A.RPY_PLA_DT
				
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM - BYNG_VAT) AS GAM_AM /*공급금액 A*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * BYNG_VAT AS BYNG_VAT /*부가세 B*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM + VCBT_AM + VCBX_AM) TOT_GAM /*총공급금액 C=A+B+E+F*/
				
				,(NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				0+0 CHRG_TOT /*총공제금액 D=P~Y*/
								
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBT_AM AS VCBT_AM /*공병금액 E*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBX_AM AS VCBX_AM /*공상자금액 F*/
				
				,(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM + VCBT_AM + VCBX_AM)) -
				((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				0+0) CBAM /*순공급금액 G=C-D*/
				
				,DECODE(NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC 
				,DECODE(NA_CRC_CAN_DSC,'2','[2] 정정','3','[3] 취소', '[' || NA_CRC_CAN_DSC || '] 정상') NA_CRC_CAN_DSC				
				,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
								
				,ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
				,MNGT_NA_TRPL_C /* 물류센터*/				
				,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS DDLY_BUYPL_NA_TRPL_C /*직송실매입처*/
				
				,(NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) COMP_FEE /* O 업체수수료      */
				
				,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */				
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */

				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
								
				,0 ETC_FEE
				,0 ETC_FEE_VAT
				,'DEV' FSRGMN_ENO
				,EDIRG_DTM /*배달일시*/
				,FS_RMS_DT /*수신일시*/
			FROM TB_BY_BYNG_M A, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_TR_TRPL_CIF G, TB_TR_TRPL_CIF F, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC
			WHERE 1=1
				AND TC.SIMP_TPC='ROTS_CTR_DSC'
				AND TC.SIMP_C = A.ROTS_CTR_DSC
				
				AND A.NA_BZPLC = D.NA_BZPLC(+)
				AND A.NA_TEAM_C = D.NA_TEAM_C(+)
				AND A.SLP_DT = D.SLP_DT(+)
				AND A.NA_SLPNO = D.NA_SLPNO(+)

				AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C 
				AND A.ACTL_BUYPL_NA_TRPL_C = C.NA_TRPL_C
				AND A.DVYAA_NA_TRPL_C = G.NA_TRPL_C(+)
				<!-- AND A.DDLY_BUYPL_NA_TRPL_C IS NOT NULL -->
				AND A.DDLY_YN = '1' /* 직송여부 1: 여 , 0: 부 */
				AND A.BUYPL_NA_TRPL_C = F.NA_TRPL_C(+)		
				AND A.BUYPL_NA_TRPL_C IN
		     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
			</foreach>		
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
			    AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
			    AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
			    AND A.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == '1'.toString()">
				AND A.NA_TR_DSC = 'IB01'
				AND A.NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND A.NA_TR_DSC = 'OB01'
				AND A.NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC = '1'))
			</when>
		</choose>		
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}				
			</if>			
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
				AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
			</if>
			GROUP BY         
				 A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,C.CLNTNM /*본지사명*/				
				,A.NA_DVY_PLASH_SLPNO
				,B.CLNTNM /*물류센터명*/
        		,NVL(G.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처별*/
				,A.CNR_DT
				,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
				,A.RPY_PLA_DT
      			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM - BYNG_VAT) /*공급금액 A*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * BYNG_VAT /*부가세 B*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM + VCBT_AM + VCBX_AM) /*총공급금액 C=A+B+E+F*/		
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBT_AM /*공병금액 E*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBX_AM /*공상자금액 F*/
		        ,DECODE(NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')		
		        ,A.NA_CRC_CAN_DSC
		        ,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
		        ,A.ACTL_BUYPL_NA_TRPL_C /*본지사코드*/ 
		        ,A.MNGT_NA_TRPL_C /* 물류센터*/ 
		        ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*직송실매입처*/
		        ,A.EDIRG_DTM /*배달일시*/
				,A.FS_RMS_DT /*수신일시*/
			ORDER BY A.MNGT_NA_TRPL_C, B.CLNTNM, C.CLNTNM, A.CNR_DT	
	</sql>	
	
    <!-- 
        매입정상 : 일반 매입정상 + 중앙회매입정상 + 자회사매입정상
        IB01    : 매입(일반)      OB01    : 환출(일반)
        IB03    : 매입(중앙회)    OB03    : 환출(중앙회)
        IB04    : 매입(자회사)    OB04    : 환출(자회사)
        IB06    : 수관매입
        매출정상 : 매입(정상)
        반품정상 : 환출(정상)
        매출정상 + 반품정정 + 반품취소 : 매입(정상), 환출(정정,취소)
        반품정상 + 매출정정 + 매출취소 : 매입(정정,취소), 환출(정상)

        직송은 일반만 해당함.
     -->
	
	<!-- 검수실적-직송분 마스터 페이지 추가 쿼리 -->	
	<select id="retrieveRecadvDdlyMasterList" parameterType="java.util.Map" resultMap="RecadvDirectMasterMap">
		<bind name="sortName" value="'ACTL_BUYPL_NA_TRPL_C ,MNGT_NA_TRPL_C,TRSLPNO'" />
		<bind name="sortType" value="'asc'" />
		
		<include refid="common.paging_start" />
		<include refid="sql_retrieveRecadvDdlyMasterList" />
		<include refid="common.paging_end" />
	</select>
	
	<!-- 검수실적-직송분 마스터 총 카운트 -->
	<select id="getRecadvDdlyCount" parameterType="java.util.Map" resultType="int">
		<include refid="common.count_start" />
		<include refid="sql_retrieveRecadvDdlyMasterList" />
		<include refid="common.count_end" />
	</select>
	
	<!--검수실적-직송분 마스터 총 합계 수량/금액 -->
	<select id="getRecadvDdlyTotal" parameterType="java.util.Map" resultMap="RecadvDirectMasterMap">
		SELECT
			NVL(SUM(LIST.GAM_AM), 0) AS TOTAL_GAM_AM,
			NVL(SUM(LIST.BYNG_VAT), 0) AS TOTAL_BYNG_VAT,
			NVL(SUM(LIST.TOT_GAM), 0) AS TOTAL_TOT_GAM,
			NVL(SUM(LIST.CHRG_TOT), 0) AS TOTAL_CHRG_TOT,
			NVL(SUM(LIST.VCBT_AM), 0) AS TOTAL_VCBT_AM,
			NVL(SUM(LIST.VCBX_AM), 0) AS TOTAL_VCBX_AM,
			NVL(SUM(LIST.CBAM), 0) AS TOTAL_CBAM,
			NVL(SUM(LIST.COMP_FEE), 0) AS TOTAL_COMP_FEE,
			NVL(SUM(LIST.BYNG_SSDY), 0) AS TOTAL_BYNG_SSDY,
			NVL(SUM(LIST.ETR_AMN_FEE), 0) AS TOTAL_ETR_AMN_FEE,
			NVL(SUM(LIST.ETR_AMN_VAT), 0) AS TOTAL_ETR_AMN_VAT,
			NVL(SUM(LIST.SLGT_AMN_FEE), 0) AS TOTAL_SLGT_AMN_FEE,
			NVL(SUM(LIST.PHD_FEE), 0) AS TOTAL_PHD_FEE,
			NVL(SUM(LIST.PHD_FEE_VAT), 0) AS TOTAL_PHD_FEE_VAT,
			NVL(SUM(LIST.TRP_SVC_CST), 0) AS TOTAL_TRP_SVC_CST,
			NVL(SUM(LIST.TRP_SVCOS_VAT), 0) AS TOTAL_TRP_SVCOS_VAT,
			NVL(SUM(LIST.ETC_FEE), 0) AS TOTAL_ETC_FEE,
			NVL(SUM(LIST.ETC_FEE_VAT), 0) AS TOTAL_ETC_FEE_VAT
		FROM
		(
		<include refid="sql_retrieveRecadvDdlyMasterList" />
		) LIST
	</select>
	
	<sql id="sql_retrieveRecadvDdlyDetailList">
			SELECT
				A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,A.SLP_SQNO
				,A.NA_WRS_C
				,B.PD_YY
				,B.WRSNM
				,'['||A.TXT_DSC||'] '||FN_CM_SIMP_CNM('TXT_DSC',A.TXT_DSC) TXT_DSC /* 과세구분*/				
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYAM AS BYAM /*총공급금액*/
				,A.BYNG_WT
				,B.INPD_QT
				,A.BYNG_UPR
				,A.BYNG_QT				
				,(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYAM)-(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYNG_VAT) AS GAM_AM /*공급금액*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYNG_VAT AS BYNG_VAT /*매입부가세*/				
				,C.WRS_STDNM
				<!-- ,NVL(A.BYNG_UPR*A.BYNG_QT,0) AS BYNG_AM -->
				,TRUNC(NVL(A.BYNG_UPR*A.BYNG_QT,0)) AS BYNG_AM
				,DECODE(C.WHT,'0','없음',C.WHT||FN_CM_SIMP_CNM('NA_WRS_UNT_C',LPAD(C.NA_WRS_UNT_C,3,'0'))) AS NA_WRS_UNT_C
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) AS CNR_DS_AM /*검수구분금액 매출정상:+ 매출 정정,취소:- 반품정상:- 반품 정정,취소:+ */
			FROM TB_BY_BYNG_WRS A, TB_OD_TRTWRS B, TB_GD_WRS C
			WHERE A.NA_BZPLC = B.NA_BZPLC
				AND A.NA_WRS_C = B.NA_WRS_C
				AND A.NA_WRS_C = C.NA_WRS_C
			<if test="NA_BZPLC != null and NA_BZPLC.length() > 0">
				AND A.NA_BZPLC = #{NA_BZPLC}
			</if>
			<if test="NA_TEAM_C != null and NA_TEAM_C.length() >  0">
				AND A.NA_TEAM_C = #{NA_TEAM_C}
			</if>
			<if test="SLP_DT != null and SLP_DT.length() > 0">
				AND A.SLP_DT = #{SLP_DT}
			</if>
			<if test="NA_SLPNO != null and NA_SLPNO.length() > 0">
				AND A.NA_SLPNO = #{NA_SLPNO}
			</if>			
			<if test="RPY_PLA_DT != null and RPY_PLA_DT.length() > 0">
				AND A.RPY_PLA_DT = #{RPY_PLA_DT}
			</if>	
			ORDER BY A.NA_BZPLC, A.NA_WRS_C, A.SLP_DT
	</sql>
	
	<!-- 검수실적-직송분 디테일 페이지 추가 쿼리 -->
	<select id="retrieveRecadvDdlyDetailList" parameterType="java.util.Map" resultMap="RecadvDirectDetailMap">	
		<bind name="sortName" value="'SLP_SQNO'" />
		<bind name="sortType" value="'asc'" />
		
		<include refid="common.paging_start" />
		<include refid="sql_retrieveRecadvDdlyDetailList" />
		<include refid="common.paging_end" />
	</select>
	
	<!-- 검수실적-직송분 디테일 총 카운트 -->
	<select id="getRecadvDdlyDetailCount" parameterType="java.util.Map" resultType="int">
		<include refid="common.count_start" />
		<include refid="sql_retrieveRecadvDdlyDetailList" />
		<include refid="common.count_end" />
	</select>
	
	<!-- 검수실적-직송분 마스터  엑셀 다운로드 -->	
	<select id="downloadExcelRecadvDdlyMaster_backup" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			X.SEQ
			, DECODE(X.SEQ, 1,   NULL, A.NA_BZPLC     ) NA_BZPLC
			, DECODE(X.SEQ, 1,   NULL, MIN(A.NA_TEAM_C             )) NA_TEAM_C
			, DECODE(X.SEQ, 1,   NULL, MIN(A.SLP_DT             )) SLP_DT
			, DECODE(X.SEQ, 1,   NULL, MIN(A.NA_SLPNO              )) NA_SLPNO
			, DECODE(X.SEQ, 1,   NULL, A.ACTL_BUYPL_NA_TRPL_C     ) ACTL_BUYPL_NA_TRPL_C
			, DECODE(X.SEQ, 1,   NULL, MIN(A.CCLNTNM             )) CCLNTNM
			, DECODE(X.SEQ, 1,   NULL, MIN(A.TRSLPNO             )) TRSLPNO
			, DECODE(X.SEQ, 1,   NULL, MIN(A.CNR_DT              )) CNR_DT
			, DECODE(X.SEQ, 1,   NULL, MIN(A.RPY_PLA_DT           )) RPY_PLA_DT
			, DECODE(X.SEQ, 1,   NULL, MIN(A.MNGT_NA_TRPL_C)) MNGT_NA_TRPL_C
			, DECODE(X.SEQ, 1,   NULL, MIN(B.CLNTNM             )) BCLNTNM
			, DECODE(X.SEQ, 1,   NULL, MIN(A.NA_DVY_PLASH_SLPNO  )) NA_DVY_PLASH_SLPNO
			, DECODE(X.SEQ, 1,   NULL, MIN(A.NA_TR_DSC           )) NA_TR_DSC
			, DECODE(X.SEQ, 1,  '합계', MIN(A.NA_CRC_CAN_DSC      )) NA_CRC_CAN_DSC
			, DECODE(X.SEQ, 1,   NULL, MIN(A.ROTS_CTR_DSC        )) ROTS_CTR_DSC
			, SUM(A.BYAM-A.BYNG_VAT) GAM_AM
			, SUM(A.BYNG_VAT      ) BYNG_VAT
			, SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM       ) TOT_GAM
			, SUM(A.CHRG_TOT      ) CHRG_TOT
			, SUM(A.VCBT_AM       ) VCBT_AM
			, SUM(A.VCBX_AM       ) VCBX_AM
			, SUM((A.BYAM+A.VCBT_AM+A.VCBX_AM) - A.CHRG_TOT) CBAM
			, SUM(A.COMP_FEE      ) COMP_FEE
			, SUM(A.ETR_AMN_FEE   ) ETR_AMN_FEE
			, SUM(A.ETR_AMN_VAT   ) ETR_AMN_VAT
			, SUM(A.SLGT_AMN_FEE  ) SLGT_AMN_FEE
			, SUM(A.PHD_FEE       ) PHD_FEE
			, SUM(A.PHD_FEE_VAT   ) PHD_FEE_VAT
			, SUM(A.TRP_SVC_CST   ) TRP_SVC_CST
			, SUM(A.TRP_SVCOS_VAT ) TRP_SVCOS_VAT
			, SUM(A.ETC_FEE       ) ETC_FEE
			, SUM(A.ETC_FEE_VAT   ) ETC_FEE_VAT
			, SUM(A.BYNG_SSDY     ) BYNG_SSDY
			, SUM(A.ACRV          ) ACRV
			, SUM(A.PPYAM         ) PPYAM
			, SUM(A.PPYAM_INT     ) PPYAM_INT
			, SUM(A.AST_SAM       ) AST_SAM
			, SUM(A.CSH_AM        ) CSH_AM
			, SUM(A.TFR_AM        ) TFR_AM
			, SUM(A.AC_FTR_AM     ) AC_FTR_AM
			, SUM(A.FC_AM         ) FC_AM
			, MIN(A.CNR_DS_AM     ) CNR_DS_AM	
			, DECODE(X.SEQ, 1,   NULL, MIN(Y.FSRGMN_ENO           )) FSRGMN_ENO
			, DECODE(X.SEQ, 1,   NULL, MIN(A.DDLY_BUYPL_NA_TRPL_C      )) DDLY_BUYPL_NA_TRPL_C
			<!-- , DECODE(X.SEQ, 1,   NULL, MIN(A.DDLY_CCLNTNM        )) DDLY_CCLNTNM -->
			, DECODE(X.SEQ, 1,   NULL, MIN(C.CLNTNM        )) DDLY_CCLNTNM
		FROM
			( SELECT /*+ ordered index(a IDX_BY_BYNG_M_01)  */
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			,C.CLNTNM CCLNTNM /*본지사명*/
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,A.CNR_DT /*검수일자*/
			,WRS.RPY_PLA_DT /*지급예정일*/
			
			<!-- ,MNGT_NA_TRPL_C /* 물류센터*/
			,B.CLNTNM BCLNTNM /*물류센터명*/ -->
			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*물류센터*/
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC IN ('1', '2', '3') AND BZPL_TPC = '504' AND BZPL_DTI_TPC <![CDATA[<>]]> '001' AND A.NA_BZPLC <![CDATA[<>]]> NVL(TRIM(A.DVYAA_NA_TRPL_C),A.ACTL_BUYPL_NA_TRPL_C) THEN A.DVYAA_NA_TRPL_C ELSE NULL END),' ' ) AS DDLY_BUYPL_NA_TRPL_C /*직송실매입처*/
			
			,A.NA_DVY_PLASH_SLPNO
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC
            ,DECODE(A.NA_CRC_CAN_DSC,'2','[2] 정정','3','[3] 취소', '[' || A.NA_CRC_CAN_DSC || '] 정상') NA_CRC_CAN_DSC
			,TC.SIMP_CNM AS ROTS_CTR_DSC /*계통구분*/
			
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/		 
			
			
			<!-- ,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(min( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(min( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/ -->

			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.VCBT_AM),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(A.VCBX_AM),0) AS VCBX_AM /*공상자금액 F*/
			
			
			<!-- ,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/ -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
			
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
			
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
			
			, 0                ACRV                /* 30 미수금 */
			, 0                PPYAM               /* 31 선급금 */
			, 0                PPYAM_INT           /* 32 선급금이자 */
			, 0                AST_SAM             /* 33 보조금 */
			, 0                CSH_AM              /* 34 현금금액 */
			, 0                TFR_AM              /* 35 대체금액 */
			, 0                AC_FTR_AM           /* 36 계좌이체금액 */
			, 0                FC_AM               /* 37 외화금액 */
			, FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) CNR_DS_AM                           /* 38 검수구분금액 */
			
			<!-- ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS DDLY_BUYPL_NA_TRPL_C /*직송실매입처*/
			,NVL(G.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) DDLY_CCLNTNM /*실매입처별*/ -->
			
			
			<!-- ,'DEV' FSRGMN_ENO -->
			FROM 
				TB_BY_BYNG_M A
				,TB_BY_BYNG_WRS WRS
				,TB_CM_SIMPC TC
				,TB_TR_TRPL_CIF C
				,TB_CM_BZPL F
				,TB_BY_BYNG_FEE D
				,TB_TR_TRPL_CIF E
				<!-- ,TB_TR_TRPL_CIF B
				,TB_TR_TRPL_CIF G -->
			WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
			AND TC.SIMP_TPC='ROTS_CTR_DSC'
			AND TC.SIMP_C = A.ROTS_CTR_DSC
			
            AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)
			
			<!-- AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
			AND A.DVYAA_NA_TRPL_C = G.NA_TRPL_C(+) -->
			
			AND A.ACTL_BUYPL_NA_TRPL_C = C.NA_TRPL_C
			AND A.DDLY_YN = '1' /* 직송여부 1: 여 , 0: 부 */
			AND A.BUYPL_NA_TRPL_C = E.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C IN
		     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
			</foreach>		
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
			    AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
			    AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
				AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
			    AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == '1'.toString()">
				AND A.NA_TR_DSC = 'IB01'
				AND A.NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND A.NA_TR_DSC = 'OB01'
				AND A.NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC = '1'))
			</when>
		</choose>		
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}				
			</if>			
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
				AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
			</if>			
			GROUP BY			
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,C.CLNTNM /*본지사명*/
			,A.NA_DVY_PLASH_SLPNO
			
<!-- 			,B.CLNTNM /*물류센터명*/
			,NVL(G.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처별*/ -->
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,WRS.RPY_PLA_DT
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,A.NA_CRC_CAN_DSC
			,TC.SIMP_CNM
			,A.ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			
			
<!-- 			,A.MNGT_NA_TRPL_C /* 물류센터*/
			,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*직송실매입처*/ -->
			
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)
			,A.NA_BZPLC 
			,A.NA_TEAM_C 
			,A.SLP_DT                      
            ,A.NA_SLPNO
            ,WRS.SLP_SQNO
			)A			
			, (SELECT LEVEL SEQ FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> 2) X
			, TB_TR_TRPL_CIF B
			, TB_TR_TRPL_CIF C
			, TB_OD_DLVPNSHT_M Y
		WHERE 1=1
			AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
			AND A.DDLY_BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
			AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
			AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
		GROUP BY X.SEQ
			, DECODE(X.SEQ, 1,   NULL, A.NA_BZPLC)
			, DECODE(X.SEQ, 1,   NULL, A.NA_TEAM_C)
			, DECODE(X.SEQ, 1,   NULL, A.SLP_DT)
			, DECODE(X.SEQ, 1,   NULL, A.NA_SLPNO)
			, DECODE(X.SEQ, 1, NULL, A.MNGT_NA_TRPL_C)
			, DECODE(X.SEQ, 1, NULL, A.TRSLPNO)
			, DECODE(X.SEQ, 1, NULL, A.RPY_PLA_DT)
			, DECODE(X.SEQ, 1, NULL, A.ACTL_BUYPL_NA_TRPL_C)		
		ORDER BY SEQ, MNGT_NA_TRPL_C , BCLNTNM , ACTL_BUYPL_NA_TRPL_C , TRSLPNO , CNR_DT , RPY_PLA_DT
	</select>
	
	<sql id="sql_recadvDdlyMaster">
	SELECT        
          X.SEQ,
          DECODE(X.SEQ, 1, NULL, A.NA_BZPLC ) NA_BZPLC,
          DECODE(X.SEQ, 1, NULL, MIN(A.NA_TEAM_C )) NA_TEAM_C,
          DECODE(X.SEQ, 1, NULL, MIN(A.SLP_DT )) SLP_DT,
          DECODE(X.SEQ, 1, NULL, MIN(A.NA_SLPNO )) NA_SLPNO,
          DECODE(X.SEQ, 1, NULL, A.ACTL_BUYPL_NA_TRPL_C ) ACTL_BUYPL_NA_TRPL_C,
          DECODE(X.SEQ, 1, NULL, MIN(A.CCLNTNM )) CCLNTNM , 
          DECODE(X.SEQ, 1, NULL, MIN(A.TRSLPNO )) TRSLPNO , 
          DECODE(X.SEQ, 1, NULL, MIN(A.CNR_DT )) CNR_DT , 
          DECODE(X.SEQ, 1, NULL, MIN(A.RPY_PLA_DT )) RPY_PLA_DT , 
          DECODE(X.SEQ, 1, NULL, MIN(A.MNGT_NA_TRPL_C)) MNGT_NA_TRPL_C , 
          DECODE(X.SEQ, 1, NULL, MIN(A.BCLNTNM )) BCLNTNM , 
          DECODE(X.SEQ, 1, NULL, MIN(A.NA_DVY_PLASH_SLPNO )) NA_DVY_PLASH_SLPNO , 
          DECODE(X.SEQ, 1, NULL, MIN(A.NA_TR_DSC )) NA_TR_DSC,
          DECODE(X.SEQ, 1, '합계', MIN(A.NA_CRC_CAN_DSC )) NA_CRC_CAN_DSC , 
          DECODE(X.SEQ, 1, NULL, MIN(A.ROTS_CTR_DSC )) ROTS_CTR_DSC,
          SUM(A.GAM_AM) GAM_AM , 
          SUM(A.BYNG_VAT ) BYNG_VAT , 
          SUM(A.TOT_GAM ) TOT_GAM , 
          SUM(A.CHRG_TOT ) CHRG_TOT , 
          SUM(A.VCBT_AM ) VCBT_AM , 
          SUM(A.VCBX_AM ) VCBX_AM , 
          SUM(A.CBAM) CBAM , 
          SUM(A.COMP_FEE ) COMP_FEE , 
          SUM(A.ETR_AMN_FEE ) ETR_AMN_FEE , 
          SUM(A.ETR_AMN_VAT ) ETR_AMN_VAT , 
          SUM(A.SLGT_AMN_FEE ) SLGT_AMN_FEE , 
          SUM(A.PHD_FEE ) PHD_FEE , 
          SUM(A.PHD_FEE_VAT ) PHD_FEE_VAT , 
          SUM(A.TRP_SVC_CST ) TRP_SVC_CST , 
          SUM(A.TRP_SVCOS_VAT ) TRP_SVCOS_VAT , 
          SUM(A.ETC_FEE ) ETC_FEE , 
          SUM(A.ETC_FEE_VAT ) ETC_FEE_VAT , 
          SUM(A.BYNG_SSDY ) BYNG_SSDY, 
          SUM(A.ACRV ) ACRV, 
          SUM(A.PPYAM ) PPYAM , 
          SUM(A.PPYAM_INT ) PPYAM_INT , 
          SUM(A.AST_SAM ) AST_SAM , 
          SUM(A.CSH_AM ) CSH_AM , 
          SUM(A.TFR_AM ) TFR_AM , 
          SUM(A.AC_FTR_AM ) AC_FTR_AM,  
          SUM(A.FC_AM ) FC_AM, 
          MIN(A.CNR_DS_AM ) CNR_DS_AM,
          DECODE(X.SEQ, 1, NULL, MIN(B.FSRGMN_ENO )) FSRGMN_ENO , 
          DECODE(X.SEQ, 1, NULL, MIN(A.DDLY_BUYPL_NA_TRPL_C )) DDLY_BUYPL_NA_TRPL_C,
          FN_TRPL_CIF_NM(MIN(A.DDLY_BUYPL_NA_TRPL_C)) DDLY_CCLNTNM,
          DECODE(X.SEQ, 1, NULL, A.APPLICATION_ID) APPLICATION_ID
        FROM 
              (SELECT MIN(A.NA_BZPLC) NA_BZPLC, 
                     MIN(A.NA_TEAM_C) NA_TEAM_C, 
                     A.TR_DT SLP_DT, 
                     A.NA_SLPNO NA_SLPNO, 
                     '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC, 
                     FN_TRPL_CIF_NM(MIN(A.NA_TRPL_C)) CCLNTNM, 
                     A.NA_DVY_PLASH_SLPNO,
                     FN_TRPL_CIF_NM(A.ACTL_BUYPL_NA_TRPL_C) BCLNTNM, 
                     MIN(A.CNR_DT) CNR_DT, 
                     SUBSTR(A.TR_DT,1,4)||'-'||SUBSTR(A.TR_DT,5,2)||'-'|| SUBSTR(A.TR_DT,7,2)||'-'|| A.NA_SLPNO TRSLPNO, 
                     A.PY_PLA_DT RPY_PLA_DT, 
                     SUM(A.byam-A.byng_vat) GAM_AM, 
                     SUM(A.byng_vat) BYNG_VAT, 
                     SUM(A.byam) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM) TOT_GAM, 
                     SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) + SUM(A.TRP_SVC_CST) + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) CHRG_TOT, 
                     SUM(A.VCBT_AM) VCBT_AM, 
                     SUM(A.VCBX_AM) VCBX_AM, 
                     SUM(A.byam) + SUM(A.VCBT_AM) + SUM(A.VCBX_AM) - ( SUM(A.BYNG_SSDY) + SUM(A.ETR_AMN_FEE) + SUM(A.ETR_AMN_VAT) + SUM(A.SLGT_AMN_FEE) + SUM(A.PHD_FEE) + SUM(A.PHD_FEE_VAT) + SUM(A.TRP_SVC_CST) + SUM(A.TRP_SVCOS_VAT) + SUM(A.ETC_FEE) + SUM(A.ETC_FEE_VAT) ) CBAM, 
                     DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC, 
                     FN_CM_SIMP_CNM('ROTS_CTR_DSC',MIN(A.ROTS_CTR_DSC)) ROTS_CTR_DSC, 
                     MIN(A.NA_TRPL_C) ACTL_BUYPL_NA_TRPL_C, 
                     MIN(A.ACTL_BUYPL_NA_TRPL_C) MNGT_NA_TRPL_C, 
                     MIN(A.DDLY_BUYPL_NA_TRPL_C) DDLY_BUYPL_NA_TRPL_C,
                     SUM(A.COMP_FEE) COMP_FEE, 
                     SUM(A.BYNG_SSDY) BYNG_SSDY, 
                     SUM(A.ETR_AMN_FEE) ETR_AMN_FEE, 
                     SUM(A.ETR_AMN_VAT) ETR_AMN_VAT, 
                     SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE, 
                     SUM(A.PHD_FEE) PHD_FEE, 
                     SUM(A.PHD_FEE_VAT) PHD_FEE_VAT, 
                     SUM(A.TRP_SVC_CST) TRP_SVC_CST, 
                     SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT, 
                     SUM(A.ETC_FEE) ETC_FEE, 
                     SUM(A.ETC_FEE_VAT) ETC_FEE_VAT,
                     0 ACRV, 
                     0 PPYAM, 
                     0 PPYAM_INT, 
                     0 AST_SAM, 
                     0 CSH_AM, 
                     0 TFR_AM, 
                     0 AC_FTR_AM, 
                     0 FC_AM,
                     FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) CNR_DS_AM,
                     MIN(A.ADJ_NA_BZPLC) ADJ_NA_BZPLC, 
                     MIN(A.NA_ADJPL_C) NA_TRPL_C,
                     MIN(A.DDLY_YN) DDLY_YN,
                     A.DVYAA_NA_TRPL_C DVYAA_NA_TRPL_C,
                     A.APPLICATION_ID
                FROM TB_DP_CM_SLP_CNR_RZS A
               WHERE A.NA_TRPL_C IN 
               		<foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
					   	#{item}
					</foreach>		
					<choose>
						<when test="SEARCH_DATE_TYPE == '1'.toString()">
						    AND A.TR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
						<when test="SEARCH_DATE_TYPE == '2'.toString()">
						    AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
						<when test="SEARCH_DATE_TYPE == '3'.toString()">
						    AND A.PY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
					</choose>
					<choose>
						<when test="TRADE_TYPE == '1'.toString()">
							AND A.NA_TR_DSC = 'IB01'
							AND A.NA_CRC_CAN_DSC = '1'
						</when>
						<when test="TRADE_TYPE == '2'.toString()">
							AND A.NA_TR_DSC = 'OB01'
							AND A.NA_CRC_CAN_DSC = '1'
						</when>
						<when test="TRADE_TYPE == '3'.toString()">
							AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC IN ('2','3')))
						</when>
						<when test="TRADE_TYPE == '4'.toString()">
							AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC = '1'))
						</when>
					</choose>		
					<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
						AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
					</if>
					<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
						AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
					</if>	 
                     AND A.NA_TR_DSC <![CDATA[<>]]> 'ID01' 
                     AND A.DDLY_YN = '1'
               GROUP BY A.NA_CRC_CAN_DSC, 
                     A.ACTL_BUYPL_NA_TRPL_C, 
                     A.TR_DT, 
                     A.NA_SLPNO, 
                     A.NA_DVY_PLASH_SLPNO, 
                     A.DVYAA_NA_TRPL_C, 
                     A.PY_PLA_DT, 
                     A.NA_TR_DSC,
                     A.APPLICATION_ID
              ) A, 
              TB_OD_DLVPNSHT_M B,
              (SELECT LEVEL SEQ 
                FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> 2
              ) X
        WHERE A.NA_DVY_PLASH_SLPNO = B.NA_DVY_PLASH_SLPNO(+) 
              AND A.ACTL_BUYPL_NA_TRPL_C = B.SPYPL_NA_TRPL_C(+) 
              AND A.MNGT_NA_TRPL_C = B.DVYAA_NA_TRPL_C(+) 
			  <if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
				  AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}				
			  </if>			
       GROUP BY X.SEQ , 
            DECODE(X.SEQ, 1, NULL, A.NA_BZPLC) , 
            DECODE(X.SEQ, 1, NULL, A.NA_TEAM_C) , 
            DECODE(X.SEQ, 1, NULL, A.SLP_DT) , 
            DECODE(X.SEQ, 1, NULL, A.NA_SLPNO) , 
            DECODE(X.SEQ, 1, NULL, A.MNGT_NA_TRPL_C) , 
            DECODE(X.SEQ, 1, NULL, A.TRSLPNO) , 
            DECODE(X.SEQ, 1, NULL, A.RPY_PLA_DT) , 
            DECODE(X.SEQ, 1, NULL, A.ACTL_BUYPL_NA_TRPL_C),
            DECODE(X.SEQ, 1, NULL, A.APPLICATION_ID) 
      ORDER BY 
            X.SEQ ,
            MIN(A.MNGT_NA_TRPL_C) , 
            MIN(A.BCLNTNM) , 
            MIN(A.ACTL_BUYPL_NA_TRPL_C) , 
            MIN(A.TRSLPNO) , 
            MIN(A.CNR_DT) , 
            MIN(A.RPY_PLA_DT) 
	</sql>
	
	<!-- 검수실적-직송분 마스터  엑셀 다운로드 -->	
	<select id="downloadExcelRecadvDdlyMaster" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
    	<include refid="sql_recadvDdlyMaster" />
	</select>
	
	<select id="downloadExcelRecadvDdlyMaster_Join_back" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT GRDM.*, GRDD.*, GRDS.*
		FROM
			(SELECT
				A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,C.CLNTNM CCLNTNM /*본지사명*/				
				,A.NA_DVY_PLASH_SLPNO
				,B.CLNTNM BCLNTNM /*물류센터명*/
				,NVL(G.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) DDLY_CCLNTNM /*실매입처별*/
				,A.CNR_DT
				,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
				,A.RPY_PLA_DT
				
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM - BYNG_VAT) AS GAM_AM /*공급금액 A*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * BYNG_VAT AS BYNG_VAT /*부가세 B*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM + VCBT_AM + VCBX_AM) TOT_GAM /*총공급금액 C=A+B+E+F*/
				
				,(NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				0+0 CHRG_TOT /*총공제금액 D=P~Y*/
								
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBT_AM AS VCBT_AM /*공병금액 E*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBX_AM AS VCBX_AM /*공상자금액 F*/
				
				,(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM + VCBT_AM + VCBX_AM)) -
				((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				0+0) CBAM /*순공급금액 G=C-D*/
				
				,DECODE(NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC 
				,DECODE(NA_CRC_CAN_DSC,'2','[2] 정정','3','[3] 취소', '[' || NA_CRC_CAN_DSC || '] 정상') NA_CRC_CAN_DSC				
				,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM AS ROTS_CTR_DSC
								
				,ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
				,MNGT_NA_TRPL_C /* 물류센터*/				
				,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS DDLY_BUYPL_NA_TRPL_C /*직송실매입처*/
				
				,(NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) +
				(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)) COMP_FEE /* O 업체수수료      */
				
				,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */				
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('393') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */

				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
				
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
				,NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
								
				,0 ETC_FEE
				,0 ETC_FEE_VAT
				,'DEV' FSRGMN_ENO
				,EDIRG_DTM /*배달일시*/
				,FS_RMS_DT /*수신일시*/
			FROM TB_BY_BYNG_M A, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_TR_TRPL_CIF G, TB_TR_TRPL_CIF F, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC
			WHERE 1=1
				AND TC.SIMP_TPC='ROTS_CTR_DSC'
				AND TC.SIMP_C = A.ROTS_CTR_DSC
				
				AND A.NA_BZPLC = D.NA_BZPLC(+)
				AND A.NA_TEAM_C = D.NA_TEAM_C(+)
				AND A.SLP_DT = D.SLP_DT(+)
				AND A.NA_SLPNO = D.NA_SLPNO(+)

				AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C 
				AND A.ACTL_BUYPL_NA_TRPL_C = C.NA_TRPL_C
				AND A.DVYAA_NA_TRPL_C = G.NA_TRPL_C(+)
				<!-- AND A.DDLY_BUYPL_NA_TRPL_C IS NOT NULL -->
				AND A.DDLY_YN = '1' /* 직송여부 1: 여 , 0: 부 */
				AND A.BUYPL_NA_TRPL_C = F.NA_TRPL_C(+)		
				AND A.BUYPL_NA_TRPL_C IN
		     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
			</foreach>		
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
			    AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
			    AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
				AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
			    AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == '1'.toString()">
				AND A.NA_TR_DSC = 'IB01'
				AND A.NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND A.NA_TR_DSC = 'OB01'
				AND A.NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC = '1'))
			</when>
		</choose>		
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}				
			</if>			
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
				AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
			</if>
			GROUP BY         
				 A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,C.CLNTNM /*본지사명*/				
				,A.NA_DVY_PLASH_SLPNO
				,B.CLNTNM /*물류센터명*/
        		,NVL(G.CLNTNM,FN_TRPL_CIF_NM(A.NA_BZPLC)) /*실매입처별*/
				,A.CNR_DT
				,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
				,A.RPY_PLA_DT
      			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM - BYNG_VAT) /*공급금액 A*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * BYNG_VAT /*부가세 B*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (BYAM + VCBT_AM + VCBX_AM) /*총공급금액 C=A+B+E+F*/		
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBT_AM /*공병금액 E*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * VCBX_AM /*공상자금액 F*/
		        ,DECODE(NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')		
		        ,A.NA_CRC_CAN_DSC
		        ,'['||A.ROTS_CTR_DSC||'] '||TC.SIMP_CNM
		        ,A.ACTL_BUYPL_NA_TRPL_C /*본지사코드*/ 
		        ,A.MNGT_NA_TRPL_C /* 물류센터*/ 
		        ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) /*직송실매입처*/
		        ,A.EDIRG_DTM /*배달일시*/
				,A.FS_RMS_DT /*수신일시*/
			) GRDM,
			(SELECT
				A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,A.SLP_SQNO
				,A.NA_WRS_C
				,B.PD_YY
				,B.WRSNM
				,'['||A.TXT_DSC||'] '||FN_CM_SIMP_CNM('TXT_DSC',A.TXT_DSC) TXT_DSC /* 과세구분*/				
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYAM AS BYAM /*총공급금액*/
				,A.BYNG_WT
				,B.INPD_QT
				,A.BYNG_UPR
				,A.BYNG_QT				
				,(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYAM)-(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYNG_VAT) AS GAM_AM /*공급금액*/
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * A.BYNG_VAT AS BYNG_VAT /*매입부가세*/				
				,C.WRS_STDNM
				,NVL(A.BYNG_UPR*A.BYNG_QT,0) AS BYNG_AM
				,DECODE(C.WHT,'0','없음',C.WHT||FN_CM_SIMP_CNM('NA_WRS_UNT_C',LPAD(C.NA_WRS_UNT_C,3,'0'))) AS NA_WRS_UNT_C
				,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) AS CNR_DS_AM /*검수구분금액 매출정상:+ 매출 정정,취소:- 반품정상:- 반품 정정,취소:+ */
			FROM TB_BY_BYNG_WRS A, TB_OD_TRTWRS B, TB_GD_WRS C
			WHERE A.NA_BZPLC = B.NA_BZPLC
				AND A.NA_WRS_C = B.NA_WRS_C
				AND A.NA_WRS_C = C.NA_WRS_C
			) GRDD,
			(SELECT /*+ no_push_pred(b) */
				A.SLP_SQNO,
				A.NA_FEE_C,				
				NVL(A.FEENM,'기타') FEENM, /* 수수료명 */
				(NVL(FN_CNR_DS_AM(B.NA_TR_DSC,B.NA_CRC_CAN_DSC),0)*(SPY_AM - TXT_VAT)) SPY_AM_VAT,
				A.SPY_AM,
				(NVL(FN_CNR_DS_AM(B.NA_TR_DSC,B.NA_CRC_CAN_DSC),0)*TXT_VAT) AS TXT_VAT,			
				A.NA_SLPNO,
				A.SLP_DT,
				A.NA_TEAM_C,
				A.NA_BZPLC
			FROM TB_BY_BYNG_FEE A, TB_BY_BYNG_WRS B
			WHERE 1=1
				AND B.NA_BZPLC = A.NA_BZPLC(+) 
				AND B.NA_TEAM_C = A.NA_TEAM_C(+) 
				AND B.SLP_DT = A.SLP_DT(+) 
				AND B.NA_SLPNO = A.NA_SLPNO(+) 
				AND B.SLP_SQNO = A.SLP_SQNO(+) 
				AND (SPY_AM > 0 OR TXT_VAT > 0)
			) GRDS			 
		 WHERE 1=1
			AND GRDM.NA_BZPLC = GRDD.NA_BZPLC
			AND GRDM.NA_TEAM_C = GRDD.NA_TEAM_C	
			AND GRDM.SLP_DT = GRDD.SLP_DT
			AND GRDM.NA_SLPNO = GRDD.NA_SLPNO
			AND GRDD.NA_BZPLC = GRDS.NA_BZPLC(+)
			AND GRDD.NA_TEAM_C = GRDS.NA_TEAM_C(+)		
			AND GRDD.SLP_DT = GRDS.SLP_DT(+)
			AND GRDD.NA_SLPNO = GRDS.NA_SLPNO(+)
			AND GRDD.SLP_SQNO = GRDS.SLP_SQNO(+)
		ORDER BY GRDM.MNGT_NA_TRPL_C, GRDM.BCLNTNM, GRDM.CCLNTNM, GRDM.CNR_DT, GRDM.NA_BZPLC,GRDM.SLP_DT,GRDM.NA_SLPNO, GRDD.SLP_SQNO		
	</select>
	
	<select id="downloadExcelRecadvDdlyMaster_back" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT GRDM.*, GRDD.*, GRDS.*
			FROM
			(SELECT
				NA_BZPLC
				,NA_TEAM_C
				,SLP_DT
				,NA_SLPNO
				,B.CLNTNM BCLNTNM
				,NA_DVY_PLASH_SLPNO
				,C.CLNTNM CCLNTNM
				,D.CLNTNM DDLY_CCLNTNM
				,CNR_DT
				,SUBSTR(SLP_DT,1,4)||'-'||SUBSTR(SLP_DT,5,2)||'-'|| SUBSTR(SLP_DT,7,2)||'-'||NA_SLPNO  TRSLPNO
				,RPY_PLA_DT
				,(BYAM - BYNG_VAT) GAM_AM
				,BYNG_VAT
				,(BYAM + VCBT_AM + VCBX_AM) TOT_GAM
				,0 CHRG_TOT
				,VCBT_AM
				,VCBX_AM
				,(BYAM + VCBT_AM + VCBX_AM)-0 CBAM
				<!-- ,NA_TR_DSC -->
				,DECODE(SUBSTR(NA_TR_DSC,0,2),'IB','매출','반품') AS NA_TR_DSC
				<!-- ,NA_CRC_CAN_DSC -->
				, (SELECT '('||TC.SIMP_C||') '||TC.SIMP_CNM FROM TB_CM_SIMPC TC WHERE TC.SIMP_TPC='NA_CRC_CAN_DSC' AND TC.SIMP_C = A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC
				<!-- ,ROTS_CTR_DSC -->
				,(SELECT TC.SIMP_CNM FROM TB_CM_SIMPC TC WHERE TC.SIMP_TPC='ROTS_CTR_DSC' AND TC.SIMP_C = A.ROTS_CTR_DSC ) AS ROTS_CTR_DSC
				,MNGT_NA_TRPL_C
				,ACTL_BUYPL_NA_TRPL_C
				,DDLY_BUYPL_NA_TRPL_C
				,0 COMP_FEE
				,BYNG_SSDY
				,0 ETR_AMN_FEE
				,0 ETR_AMN_VAT
				,0 SLGT_AMN_FEE
				,0 PHD_FEE
				,0 PHD_FEE_VAT
				,0 TRP_SVC_CST
				,0 TRP_SVCOS_VAT
				,0 ETC_FEE
				,0 ETC_FEE_VAT
				,'DEV' FSRGMN_ENO
				,EDIRG_DTM /*배달일시*/
				,FS_RMS_DT /*수신일시*/
			FROM TB_BY_BYNG_M A, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_TR_TRPL_CIF D, TB_TR_TRPL_CIF F
			WHERE 1=1			
				AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C 
				AND A.ACTL_BUYPL_NA_TRPL_C = C.NA_TRPL_C
				AND A.DDLY_BUYPL_NA_TRPL_C = D.NA_TRPL_C
				<!-- AND A.DDLY_BUYPL_NA_TRPL_C IS NOT NULL -->
				AND A.DDLY_YN = '1' /* 직송여부 1: 여 , 0: 부 */
				AND A.BUYPL_NA_TRPL_C = F.NA_TRPL_C(+)		
				AND A.BUYPL_NA_TRPL_C IN
		     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
			</foreach>		
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
			    AND slp_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
			    AND cnr_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
			    AND rpy_pla_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == '1'.toString()">
				AND na_tr_dsc = 'IB01'
				AND na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND na_tr_dsc = 'OB01'
				AND na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((na_tr_dsc = 'IB01' AND na_crc_can_dsc = '1') OR (na_tr_dsc = 'OB01' AND na_crc_can_dsc IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((na_tr_dsc = 'IB01' AND na_crc_can_dsc IN ('2','3')) OR (na_tr_dsc = 'OB01' AND na_crc_can_dsc = '1'))
			</when>
		</choose>		
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
				AND ACTL_BUYPL_NA_TRPL_C = #{NA_BZPLC}				
			</if>			
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
				AND DDLY_BUYPL_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
			</if>) GRDM
			, (SELECT
				A.NA_BZPLC
				,A.NA_TEAM_C
				,A.SLP_DT
				,A.NA_SLPNO
				,A.SLP_SQNO
				,A.NA_WRS_C
				,B.PD_YY
				,B.WRSNM
				,A.TXT_DSC
				,A.BYAM
				,A.BYNG_WT
				,B.INPD_QT
				,A.BYNG_UPR
				,A.BYNG_QT
				,A.BYAM - A.BYNG_VAT AS GAM_AM
				,A.BYNG_VAT
				,C.WRS_STDNM
			FROM TB_BY_BYNG_WRS A, TB_OD_TRTWRS B, TB_GD_WRS C 
			WHERE A.NA_BZPLC = B.NA_BZPLC
				AND A.NA_WRS_C = B.NA_WRS_C
				AND A.NA_WRS_C = C.NA_WRS_C
			) GRDD
			, (SELECT 
			SLP_SQNO,
			NA_FEE_C,
			FEENM,
			(SPY_AM - TXT_VAT) SPY_AM_VAT,
			TXT_VAT,
			NA_SLPNO,
			SLP_DT,
			NA_TEAM_C,
			NA_BZPLC
		FROM TB_BY_BYNG_FEE
		WHERE 1=1
		AND (SPY_AM > 0 OR TXT_VAT > 0)) GRDS
			WHERE 1=1
			AND GRDM.NA_BZPLC = GRDD.NA_BZPLC(+)
			AND GRDM.NA_TEAM_C = GRDD.NA_TEAM_C(+)		
			AND GRDM.SLP_DT = GRDD.SLP_DT(+)
			AND GRDM.NA_SLPNO = GRDD.NA_SLPNO(+)
			AND GRDD.NA_BZPLC = GRDS.NA_BZPLC(+)
			AND GRDD.NA_TEAM_C = GRDS.NA_TEAM_C(+)		
			AND GRDD.SLP_DT = GRDS.SLP_DT(+)
			AND GRDD.NA_SLPNO = GRDS.NA_SLPNO(+)
			AND GRDD.SLP_SQNO = GRDS.SLP_SQNO(+)
		ORDER BY GRDM.MNGT_NA_TRPL_C, GRDM.BCLNTNM, GRDM.CCLNTNM, GRDM.CNR_DT
	</select>
	
	<!-- 검수실적-직송별 전표 상품 수수료 합계 엑셀 다운로드 -->
	<select id="downloadExcelRecadvDdlyCommisionSum" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
	SELECT
		A.MNGT_NA_TRPL_C
		, B.CLNTNM BCLNTNM
		, A.TRSLPNO
		, A.CNR_DT
		, A.RPY_PLA_DT
		, A.NA_DVY_PLASH_SLPNO
		, A.ACTL_BUYPL_NA_TRPL_C
		, A.CCLNTNM
		, A.NA_BZPLC
		, A.BZPL_NM
		, A.SPY_TPC
		, A.ROTS_CTR_DSC
		, A.SLP_SQNO
		, A.NA_WRS_C
		, A.PD_YY
		, A.WRSNM
		, A.WRS_STDNM
		, A.TXT_DSC
		, A.BYNG_WT
		, A.INPD_QT
		, A.BYNG_UPR
		, A.BYNG_QT
		, A.GAM_AM
		, A.BYNG_VAT
		, A.BYAM
		, A.SPY_AM_VAT
		, A.TXT_VAT
		, A.NA_TR_DSC
		, A.NA_TR_DSC_NM
		, A.NA_CRC_CAN_DSC
		, A.NA_CRC_CAN_DSC_NM
		<!-- , FSRGMN_ENO -->
		, (Y.fsrgmn_eno) FSRGMN_ENO
		, A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
		, A.DDLY_BUYPL_NA_TRPL_C
		, FN_TRPL_CIF_NM(A.DDLY_BUYPL_NA_TRPL_C) DDLY_CCLNTNM
		FROM				
		(SELECT
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO,
			 NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			<!-- ,FN_TRPL_CIF_NM(A.MNGT_NA_TRPL_C) BCLNTNM /*실매입처명*/ -->
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC IN ('1', '2', '3') AND BZPL_TPC = '504' AND BZPL_DTI_TPC  <![CDATA[<>]]> '001' AND A.NA_BZPLC <![CDATA[<>]]> NVL(TRIM(A.DVYAA_NA_TRPL_C),A.ACTL_BUYPL_NA_TRPL_C) THEN
			A.DVYAA_NA_TRPL_C ELSE NULL END),' ' ) AS DDLY_BUYPL_NA_TRPL_C
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO /*매출일자-전표번호*/
			,A.CNR_DT /* 검수일자*/
			,B.RPY_PLA_DT /*지급예정일*/
			,A.NA_DVY_PLASH_SLPNO /*배송예정서번호*/
			
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			,FN_TRPL_CIF_NM(A.BUYPL_NA_TRPL_C) CCLNTNM /*본지사명*/ 
			
			,A.NA_BZPLC /*경제통합사업장코드*/
			,FN_TRPL_CIF_NM(A.NA_BZPLC) BZPL_NM /*사업장명*/
			,FN_CM_SIMP_CNM('SPY_TPC',B.SPY_TPC) SPY_TPC /*공급유형*/
			,FN_CM_SIMP_CNM('ROTS_CTR_DSC',A.ROTS_CTR_DSC) ROTS_CTR_DSC /*계통계약구분*/
			,B.SLP_SQNO/*전표일련번호*/
			,B.NA_WRS_C/*경제통합상품코드*/
			,C.PD_YY/*생산년도*/
			,C.WRSNM/*상품명*/
			,D.WRS_STDNM/*상품규격*/
			,DECODE(B.TXT_DSC,'1','과세','2','면세','3','영세',B.TXT_DSC) TXT_DSC /*과세구분코드명*/
			
			,NVL(B.BYNG_WT,0) BYNG_WT/*입고중량*/
			
			,C.INPD_QT/*내품수량*/
			,B.BYNG_UPR/*매입단가*/
			,B.BYNG_QT/*매입수량*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (B.BYAM - B.BYNG_VAT) AS GAM_AM /*공급금액 A*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * B.BYNG_VAT AS BYNG_VAT /*매입 부가세*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (B.BYAM) BYAM /*매입금액*/
			,NVL(SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (E.SPY_AM - E.TXT_VAT)),0) SPY_AM_VAT/*수수료*/
			,NVL(SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * E.TXT_VAT),0) TXT_VAT /*수수료부가세*/			
			,A.NA_TR_DSC
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC_NM
			,A.NA_CRC_CAN_DSC
			, '(' || A.NA_CRC_CAN_DSC || ') ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC_NM
			,'DEV' FSRGMN_ENO /*최초등록자개인번호, 배송예정서 작성자 */
		FROM TB_BY_BYNG_M A, TB_BY_BYNG_WRS B, TB_OD_TRTWRS C, TB_GD_WRS D, TB_BY_BYNG_FEE E, TB_CM_BZPL F
		WHERE 1=1
			<!-- AND TRIM(A.DDLY_BUYPL_NA_TRPL_C) IS NOT NULL -->
			AND A.NA_BZPLC            = F.NA_BZPLC
			AND A.DDLY_YN = '1' /* 직송여부 1: 여 , 0: 부 */
			AND A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_TEAM_C = B.NA_TEAM_C 
			AND A.SLP_DT = B.SLP_DT
			AND A.NA_SLPNO = B.NA_SLPNO			
			AND B.NA_BZPLC = C.NA_BZPLC
			AND B.NA_WRS_C = C.NA_WRS_C
			AND B.NA_WRS_C = D.NA_WRS_C			
			AND B.NA_BZPLC = E.NA_BZPLC(+)
			AND B.NA_TEAM_C = E.NA_TEAM_C(+)
			AND B.SLP_DT = E.SLP_DT(+)
			AND B.NA_SLPNO = E.NA_SLPNO(+)
			AND B.SLP_SQNO = E.SLP_SQNO(+)
			AND (E.spy_am > 0 OR E.txt_vat > 0 OR E.na_bzplc IS NULL)
			<!-- <![CDATA[ AND ROWNUM <10]]> -->
			AND A.BUYPL_NA_TRPL_C IN
		     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
			</foreach>		
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
			    AND A.slp_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
			    AND A.cnr_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">			    
			    AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
				AND B.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>			
			<when test="TRADE_TYPE == '1'.toString()">
				AND NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
				AND NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
				AND NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND NA_CRC_CAN_DSC = '1') OR (NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND NA_CRC_CAN_DSC IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND NA_CRC_CAN_DSC IN ('2','3')) OR (NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND NA_CRC_CAN_DSC = '1'))
			</when>
		</choose>
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}				
			</if>			
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
				AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
			</if>			
		GROUP BY
			A.MNGT_NA_TRPL_C
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			,A.CNR_DT
			,B.RPY_PLA_DT
			,A.NA_DVY_PLASH_SLPNO
			,A.BUYPL_NA_TRPL_C
			,A.NA_BZPLC
			,B.SPY_TPC
			,A.ROTS_CTR_DSC
			,B.SLP_SQNO
			,B.NA_WRS_C
			,C.PD_YY
			,C.WRSNM
			,D.WRS_STDNM
			,B.TXT_DSC
			,B.BYNG_WT
			,C.INPD_QT
			,B.BYNG_UPR
			,B.BYNG_QT
			,B.BYNG_VAT
			,B.BYAM
			,A.NA_TR_DSC
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품')
			,A.NA_CRC_CAN_DSC
			,DECODE(A.NA_CRC_CAN_DSC,'2','(2)정정','3','(3)취소','('||A.NA_CRC_CAN_DSC||')정상')
			, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
			) A
	, TB_TR_TRPL_CIF B
	<!-- , TB_TR_TRPL_CIF C -->
	, TB_OD_DLVPNSHT_M Y
	WHERE 1=1
	AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
	<!-- AND A.DDLY_BUYPL_NA_TRPL_C = C.NA_TRPL_C(+) -->
	AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
	AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
	AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)			
	ORDER BY 1 , 2, 3, 13
	</select>
	
	<!-- 검수실적-직송별 전표 상품 수수료 상세 엑셀 다운로드 -->
	<select id="downloadExcelRecadvDdlyCommisionDetail" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
	SELECT
		A.MNGT_NA_TRPL_C
		, B.CLNTNM BCLNTNM
		, A.TRSLPNO
		, A.CNR_DT
		, A.RPY_PLA_DT
		, A.NA_DVY_PLASH_SLPNO
		, A.ACTL_BUYPL_NA_TRPL_C
		, A.CCLNTNM
		, A.NA_BZPLC
		, A.BZPL_NM
		, A.SPY_TPC
		, A.ROTS_CTR_DSC
		, A.SLP_SQNO
		, A.NA_WRS_C
		, A.PD_YY
		, A.WRSNM
		, A.WRS_STDNM
		, A.TXT_DSC
		, A.BYNG_WT
		, A.INPD_QT
		, A.BYNG_UPR
		, A.BYNG_QT
		, A.GAM_AM
		, A.BYNG_VAT
		, A.BYAM
		, A.SPY_AM_VAT
		, A.TXT_VAT
		, A.NA_FEE_C
		, A.FEENM
		, A.NA_TR_DSC
		, A.NA_TR_DSC_NM
		, A.NA_CRC_CAN_DSC
		, A.NA_CRC_CAN_DSC_NM
		<!-- , FSRGMN_ENO -->
		, (Y.fsrgmn_eno) FSRGMN_ENO
		, A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
		, A.DDLY_BUYPL_NA_TRPL_C
		, FN_TRPL_CIF_NM(A.DDLY_BUYPL_NA_TRPL_C) DDLY_CCLNTNM
		FROM
		(	
		SELECT
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO,
			 NVL((CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			<!-- ,FN_TRPL_CIF_NM(A.MNGT_NA_TRPL_C) BCLNTNM /*실매입처명*/ -->
			, NVL(CASE WHEN ROTS_CTR_DSC IN ('1', '2', '3') AND BZPL_TPC = '504' AND BZPL_DTI_TPC <![CDATA[<>]]> '001' AND A.NA_BZPLC <![CDATA[<>]]> NVL(TRIM(A.DVYAA_NA_TRPL_C),A.ACTL_BUYPL_NA_TRPL_C) THEN
			A.DVYAA_NA_TRPL_C ELSE NULL END,' ' ) AS DDLY_BUYPL_NA_TRPL_C
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO /*매출일자-전표번호*/
			,A.CNR_DT /* 검수일자*/
			,B.RPY_PLA_DT /*지급예정일*/
			,A.NA_DVY_PLASH_SLPNO /*배송예정서번호*/
			
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			,FN_TRPL_CIF_NM(A.BUYPL_NA_TRPL_C) CCLNTNM /*본지사명*/ 
			
			,A.NA_BZPLC /*경제통합사업장코드*/
			,FN_TRPL_CIF_NM(A.NA_BZPLC) BZPL_NM /*사업장명*/
			,FN_CM_SIMP_CNM('SPY_TPC',B.SPY_TPC) SPY_TPC /*공급유형*/
			,FN_CM_SIMP_CNM('ROTS_CTR_DSC',A.ROTS_CTR_DSC) ROTS_CTR_DSC /*계통계약구분*/
			,B.SLP_SQNO/*전표일련번호*/
			,B.NA_WRS_C/*경제통합상품코드*/
			,C.PD_YY/*생산년도*/
			,C.WRSNM/*상품명*/
			,D.WRS_STDNM/*상품규격*/
			,DECODE(B.TXT_DSC,'1','과세','2','면세','3','영세',B.TXT_DSC) TXT_DSC /*과세구분코드명*/
			,NVL(B.BYNG_WT,0) BYNG_WT/*입고중량*/
			,C.INPD_QT/*내품수량*/
			,B.BYNG_UPR/*매입단가*/
			,B.BYNG_QT/*매입수량*/
			
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (B.BYAM - B.BYNG_VAT) AS GAM_AM /*공급금액 A*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * B.BYNG_VAT AS BYNG_VAT /*매입 부가세*/
			,FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (B.BYAM) BYAM /*매입금액*/
			
<!-- 			,E.FEE_ACG_ACCC /*수수료회계계정코드*/
			,E.BZPL_ACCNM AS FEE_ACG_ACCC_NM /*수수료회계계정명*/ -->
			
			,NVL((FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * (E.SPY_AM - E.TXT_VAT)),0) SPY_AM_VAT/*수수료*/
			,NVL((FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * E.TXT_VAT),0) TXT_VAT /*수수료부가세*/			

			,NA_FEE_C /* 수수료코드 */
			,NVL(FEENM,'기타') FEENM /* 수수료명 */
						
			,A.NA_TR_DSC
			,DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC_NM
			,A.NA_CRC_CAN_DSC
			, '(' || A.NA_CRC_CAN_DSC || ') ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC_NM
			,'DEV' FSRGMN_ENO /*최초등록자개인번호, 배송예정서 작성자 */
		FROM TB_BY_BYNG_M A, TB_BY_BYNG_WRS B, TB_OD_TRTWRS C, TB_GD_WRS D, TB_BY_BYNG_FEE E, TB_CM_BZPL F
		WHERE 1=1
			<!-- AND TRIM(A.DDLY_BUYPL_NA_TRPL_C) IS NOT NULL -->
			AND A.NA_BZPLC            = F.NA_BZPLC
			AND A.DDLY_YN = '1' /* 직송여부 1: 여 , 0: 부 */
			AND A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_TEAM_C = B.NA_TEAM_C 
			AND A.SLP_DT = B.SLP_DT
			AND A.NA_SLPNO = B.NA_SLPNO			
			AND B.NA_BZPLC = C.NA_BZPLC
			AND B.NA_WRS_C = C.NA_WRS_C
			AND B.NA_WRS_C = D.NA_WRS_C			
			AND B.NA_BZPLC = E.NA_BZPLC(+)
			AND B.NA_TEAM_C = E.NA_TEAM_C(+)
			AND B.SLP_DT = E.SLP_DT(+)
			AND B.NA_SLPNO = E.NA_SLPNO(+)
			AND B.SLP_SQNO = E.SLP_SQNO(+)
			AND (E.spy_am > 0 OR E.txt_vat > 0 OR E.na_bzplc IS NULL)
			<!-- <![CDATA[ AND ROWNUM <10]]> -->
			AND A.BUYPL_NA_TRPL_C IN
		     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
			</foreach>		
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
			    AND A.slp_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
			    AND A.cnr_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">			    
			    AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
				AND B.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>			
			<when test="TRADE_TYPE == '1'.toString()">
				AND NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
				AND NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
				AND NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND NA_CRC_CAN_DSC = '1') OR (NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND NA_CRC_CAN_DSC IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND NA_CRC_CAN_DSC IN ('2','3')) OR (NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND NA_CRC_CAN_DSC = '1'))
			</when>
		</choose>
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}				
			</if>			
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
				AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
			</if>
	) A
	, TB_TR_TRPL_CIF B
	, TB_OD_DLVPNSHT_M Y
	WHERE 1=1
		AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
		AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
		AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
		AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)				
	ORDER BY 1 , 2, 3, 13, NA_FEE_C
	</select>
	
	<select id="downloadExcelRecadvDdlyCommisionDetail_back" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT /*+ DPON2222R3.PC */
			 A.MNGT_NA_TRPL_C /*본/지사코드*/
			 ,FN_TRPL_CIF_NM(A.MNGT_NA_TRPL_C) BCLNTNM /*본/지사명*/
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO /*매출일자-전표번호*/
			,A.CNR_DT /* 검수일자*/
			,A.RPY_PLA_DT /*지급예정일*/
			,A.NA_DVY_PLASH_SLPNO /*배송예정서번호*/
			,A.ACTL_BUYPL_NA_TRPL_C /*실매입처(농협)*/
			,FN_TRPL_CIF_NM(A.ACTL_BUYPL_NA_TRPL_C) CCLNTNM /*실매입처명*/
			,A.NA_BZPLC /*경제통합사업장코드*/
			,FN_TRPL_CIF_NM(A.NA_BZPLC) BZPL_NM /*사업장명*/
			,FN_CM_SIMP_CNM('SPY_TPC',B.SPY_TPC) SPY_TPC /*공급유형*/
			,FN_CM_SIMP_CNM('ROTS_CTR_DSC',A.ROTS_CTR_DSC) ROTS_CTR_DSC /*계통계약구분*/
			,B.SLP_SQNO/*전표일련번호*/
			,B.NA_WRS_C/*경제통합상품코드*/
			,C.PD_YY/*생산년도*/
			,C.WRSNM/*상품명*/
			,D.WRS_STDNM/*상품규격*/
			,DECODE(B.TXT_DSC,'1','과세','2','면세','3','영세',B.TXT_DSC) TXT_DSC /*과세구분코드명*/
			,B.BYNG_WT/*입고중량*/
			,C.INPD_QT/*내품수량*/
			,B.BYNG_UPR/*매입단가*/
			,B.BYNG_QT/*매입수량*/
			,B.BYAM - B.BYNG_VAT AS GAM_AM/*공급금액*/
			,B.BYNG_VAT/*매입부가세*/
			,B.BYAM /*매입금액*/
			/*수수료회계계정코드*/
			/*수수료회계계정명*/
			,(E.SPY_AM - E.TXT_VAT) SPY_AM_VAT/*수수료*/
			,(E.TXT_VAT) TXT_VAT /*수수료부가세*/
			, NA_FEE_C /* 수수료코드 */
			, FEENM /* 수수료명 */
			, A.NA_TR_DSC
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC_NM
			, A.NA_CRC_CAN_DSC
			, '(' || A.NA_CRC_CAN_DSC || ') ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC_NM
			,'DEV' FSRGMN_ENO /*최초등록자개인번호, 배송예정서 작성자 */
		FROM TB_BY_BYNG_M A, TB_BY_BYNG_WRS B, TB_OD_TRTWRS C, TB_GD_WRS D, TB_BY_BYNG_FEE E 
		WHERE 1=1
			AND TRIM(A.DDLY_BUYPL_NA_TRPL_C) IS NOT NULL
			AND A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_TEAM_C = B.NA_TEAM_C 
			AND A.SLP_DT = B.SLP_DT 
			AND A.NA_SLPNO = B.NA_SLPNO
			AND B.NA_BZPLC = C.NA_BZPLC
			AND B.NA_WRS_C = C.NA_WRS_C
			AND B.NA_WRS_C = D.NA_WRS_C
			AND B.NA_BZPLC = E.NA_BZPLC(+)
			AND B.NA_TEAM_C = E.NA_TEAM_C(+)
			AND B.SLP_DT = E.SLP_DT(+)
			AND B.NA_SLPNO = E.NA_SLPNO(+)
			AND B.SLP_SQNO = E.SLP_SQNO(+)
			<!-- <![CDATA[ AND ROWNUM <10]]> -->
			AND A.BUYPL_NA_TRPL_C IN
		     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
			</foreach>		
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
			    AND A.slp_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
			    AND A.cnr_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
			    AND A.rpy_pla_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == '1'.toString()">
				AND na_tr_dsc = 'IB01'
				AND na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND na_tr_dsc = 'OB01'
				AND na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((na_tr_dsc = 'IB01' AND na_crc_can_dsc = '1') OR (na_tr_dsc = 'OB01' AND na_crc_can_dsc IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((na_tr_dsc = 'IB01' AND na_crc_can_dsc IN ('2','3')) OR (na_tr_dsc = 'OB01' AND na_crc_can_dsc = '1'))
			</when>
		</choose>		
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
				AND A.ACTL_BUYPL_NA_TRPL_C = #{NA_BZPLC}				
			</if>			
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
				AND A.DDLY_BUYPL_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
			</if>
			ORDER BY 1, 2, 3, 13
	</select>
	
	<select id="getDdlyNABizPlace" parameterType="java.util.Map" resultMap="TbCmBzplMap">
		SELECT 
			A.NA_BZPLC, D.CLNTNM AS SHRT_BZPLNM, A.BZPL_TPC, A.BZPL_DTI_TPC, B.BZPL_TPNM, B.BZPL_DTI_TPNM
		FROM TB_CM_BZPL A, TB_TR_BZPL_TP B, TB_TR_TRNREL C , TB_TR_TRPL_CIF D
		WHERE A.BZPL_TPC = B.BZPL_TPC
			AND A.BZPL_DTI_TPC = B.BZPL_DTI_TPC
			AND A.NA_BZPLC = D.NA_TRPL_C
			AND A.BZPL_TPC IN ( '504' , '505')
			AND A.NA_BZPLC = C.CSER_NA_TRPL_C
			AND C.SPLR_NA_TRPL_C = #{SPLR_NA_TRPL_C}
			AND C.CSER_CTR_TPC   = '1' /* 물류센터가 아니면 중앙본부계통계약만 '1' 직송가능  */
	</select>
	
	<!-- 수수료 출력 -->
	<select id="printCommissionList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT TXT.*, TOTAL.*
		FROM
				(SELECT 
					SLP_SQNO,
					NA_FEE_C,
					FEENM,					
					(NVL(#{CNR_DS_AM},0)*(SPY_AM - TXT_VAT)) SPY_AM_VAT,
					SPY_AM,
					(NVL(#{CNR_DS_AM},0)*TXT_VAT) AS TXT_VAT				
				FROM TB_BY_BYNG_FEE
				WHERE NA_BZPLC = #{NA_BZPLC}
				AND NA_TEAM_C = #{NA_TEAM_C}
				AND SLP_DT = #{SLP_DT}
				AND NA_SLPNO = #{NA_SLPNO}
				AND SLP_SQNO = #{SLP_SQNO}
				AND (SPY_AM > 0 OR TXT_VAT > 0)) TXT,
		    (SELECT			
					SUM(SPY_AM) AS TOT_SPY_AM,
					SUM(TXT_VAT) AS TOT_TXT_VAT 
				FROM TB_BY_BYNG_FEE
				WHERE NA_BZPLC = #{NA_BZPLC}
				AND NA_TEAM_C = #{NA_TEAM_C}
				AND SLP_DT = #{SLP_DT}
				AND NA_SLPNO = #{NA_SLPNO}
				AND SLP_SQNO = #{SLP_SQNO}
				AND (SPY_AM > 0 OR TXT_VAT > 0)
		    GROUP BY NA_BZPLC) TOTAL
	</select>
	
	<!-- 검수실적-상품별 마스터 그리드 조회 -->
	<select id="retrieveRecadvSlpMasterList_WRS_backup" parameterType="java.util.Map" resultMap="RecadvMasterVO_WRS_Map">
	with temp_tab as (
		SELECT /*+ leading(a wrs d b c tc f) use_nl(a wrs d d b c tc f) */
		
			NVL(MIN(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<]]> TRIM(NVL((NVL(A.ACTL_BUYPL_NA_TRPL_C,A.NA_BZPLC)),' ')) AND TRIM(NVL((NVL(A.ACTL_BUYPL_NA_TRPL_C,A.NA_BZPLC)),' ')) IS NOT NULL THEN NVL((NVL(A.ACTL_BUYPL_NA_TRPL_C,A.NA_BZPLC)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END ),' ') AS   ACTL_BUYPL_NA_TRPL_C
			
      		, A.NA_BZPLC
            , A.SLP_DT 
            , A.NA_TR_DSC
            , A.NA_SLPNO
            , WRS.SLP_SQNO
            , WRS.NA_WRS_C  
			, DECODE(MIN(WRS.TXT_DSC),'1','과세','2','면세','3','영세',MIN(WRS.TXT_DSC)) TXT_DSC_NM
            , MIN(WRS.TXT_DSC) TXT_DSC            
            <!-- , DECODE(SUM(WRS.BYNG_QT),0,0,ROUND(SUM(WRS.BYAM)/SUM(WRS.BYNG_QT),2))  DANGA -->            
            , FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.BYNG_QT),0) BYNG_QT

			<!-- ,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C <![CDATA[<>]]> '912' ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C <![CDATA[<>]]> '912' ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/ -->
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
	                   
		FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">					
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">					
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="WRS_CODE != null and WRS_CODE.length() >  0 and WRS_CODE != 'all'.toString()">
					AND WRS.NA_WRS_C = #{WRS_CODE}
				</if>
		GROUP BY 
		WRS.NA_WRS_C
        , FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)
		, A.NA_BZPLC
		, A.SLP_DT 
		, A.NA_TR_DSC
		, A.NA_SLPNO
		, WRS.SLP_SQNO
	)
	SELECT		
		A.NA_WRS_C       NA_WRS_C /*상품코드*/
		, MIN(B.WRSNM)     WRSNM /*상품명*/
		, MIN(B.WRS_STDNM) WRS_STDNM /*규격*/
		, '['||MIN(A.TXT_DSC)||'] '||MIN(A.TXT_DSC_NM)   TXT_DSC /*면과세구분*/
		
		<!-- , MIN(A.DANGA)     DANGA -->
		, DECODE(SUM(A.BYNG_QT),0,0,ROUND(SUM(A.BYAM)/SUM(A.BYNG_QT),2)) DANGA
		             
		, SUM(A.BYNG_QT) BYNG_QT /*매입수량*/		              
		, SUM(A.BYAM-A.BYNG_VAT) GAM_AM /*공급금액*/
		, SUM(A.BYNG_VAT) BYNG_VAT /*부가세*/		
		<!-- , SUM(A.BYAM) TOT_GAM /*총공급금액*/ -->
		, SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM /*총공급금액*/
		, SUM(A.CHRG_TOT) CHRG_TOT /*총공제금액*/
		, SUM(A.COMP_FEE) COMP_FEE /*업체별수수료*/
		, SUM(A.BYNG_SSDY) BYNG_SSDY /*매입장려금*/
		, SUM(A.ETR_AMN_FEE) ETR_AMN_FEE /*수탁관리수수료*/
		, SUM(A.ETR_AMN_VAT) ETR_AMN_VAT /*수탁관리부가세*/
		, SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE /*매취관리수수료*/
		, SUM(A.PHD_FEE) PHD_FEE /*물류수수료*/
		, SUM(A.PHD_FEE_VAT) PHD_FEE_VAT /*물류부가세*/
		, SUM(A.TRP_SVC_CST) TRP_SVC_CST /*운송용역비*/
		, SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT /*운송부가세*/
		, SUM(A.ETC_FEE) ETC_FEE /*기타수수료*/
		, SUM(A.ETC_FEE_VAT) ETC_FEE_VAT /*기타수수료부가세*/
	FROM
		temp_tab A
		, TB_GD_WRS B		
	WHERE 1=1
		AND A.NA_WRS_C = B.NA_WRS_C
		<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
				AND A.ACTL_BUYPL_NA_TRPL_C = #{NA_BZPLC}
			</if>
		</if>	
	GROUP BY A.NA_WRS_C
    ORDER BY A.NA_WRS_C
	</select>

	<!-- 검수실적-상품별 마스터 그리드 조회 -->
	<select id="retrieveRecadvSlpMasterList_WRS" parameterType="java.util.Map" resultMap="RecadvMasterVO_WRS_Map">
	SELECT
          A.NA_WRS_C NA_WRS_C,
          B.WRSNM WRSNM, 
          B.WRS_STDNM WRS_STDNM,
          MIN(A.TXT_DSC) TXT_DSC,
          DECODE(SUM(A.BYNG_QT),0,0,ROUND(SUM(A.BYAM)/SUM(A.BYNG_QT),2)) DANGA,
          SUM(A.BYNG_QT) BYNG_QT,
          SUM(A.GAM_AM) GAM_AM,
          SUM(A.BYNG_VAT) BYNG_VAT,
          SUM(A.TOT_GAM) TOT_GAM,
          SUM(A.CHRG_TOT) CHRG_TOT,
          SUM(A.COMP_FEE) COMP_FEE,
          SUM(A.BYNG_SSDY) BYNG_SSDY,
          SUM(A.ETR_AMN_FEE) ETR_AMN_FEE,
          SUM(A.ETR_AMN_VAT) ETR_AMN_VAT,
          SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE,
          SUM(A.PHD_FEE) PHD_FEE,
          SUM(A.PHD_FEE_VAT) PHD_FEE_VAT, 
          SUM(A.TRP_SVC_CST) TRP_SVC_CST,
          SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT,       
          SUM(A.ETC_FEE) ETC_FEE, 
          SUM(A.ETC_FEE_VAT)  ETC_FEE_VAT
	FROM
	(
	SELECT 
           <choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					/*+ index(a XPK_DP_CM_WRS_CNR_RZS) */
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					/*+ index(a IDX_DP_CM_WRS_CNR_RZS_01) */
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					/*+ index(a IDX_DP_CM_WRS_CNR_RZS_03) */
				</when>
			</choose>	

	             A.NA_WRS_C NA_WRS_C, 
	             '['||MIN(A.TXT_DSC)||'] '|| MIN(DECODE(A.TXT_DSC,'1','과세','2','면세','3','영세',A.TXT_DSC)) TXT_DSC, 
	             SUM(BYNG_QT) BYNG_QT,
	             SUM(A.BYAM-A.BYNG_VAT) GAM_AM,
	             SUM(A.BYNG_VAT) BYNG_VAT,
	             SUM(A.BYAM) BYAM,
	             --SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM,
	             SUM(NVL(A.BYAM, 0)+NVL(A.VCBT_AM, 0)+NVL(A.VCBX_AM, 0)) TOT_GAM,
	             SUM(BYNG_SSDY+ETR_AMN_FEE+ETR_AMN_VAT+SLGT_AMN_FEE+PHD_FEE+PHD_FEE_VAT+ TRP_SVC_CST+TRP_SVCOS_VAT+ETC_FEE+ETC_FEE_VAT) CHRG_TOT,
	             SUM(COMP_FEE) COMP_FEE,
	             SUM(BYNG_SSDY) BYNG_SSDY,
	             SUM(ETR_AMN_FEE) ETR_AMN_FEE,
	             SUM(ETR_AMN_VAT) ETR_AMN_VAT,
	             SUM(SLGT_AMN_FEE) SLGT_AMN_FEE,
	             SUM(PHD_FEE) PHD_FEE,
	             SUM(PHD_FEE_VAT) PHD_FEE_VAT, 
	             SUM(TRP_SVC_CST) TRP_SVC_CST,
	             SUM(TRP_SVCOS_VAT) TRP_SVCOS_VAT,       
	             SUM(ETC_FEE) ETC_FEE, 
	             SUM(ETC_FEE_VAT)  ETC_FEE_VAT
	  FROM TB_DP_CM_WRS_CNR_RZS A
	  WHERE A.NA_TRPL_C IN 
	       <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
    		#{item}
		   </foreach>
	       <choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.TR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.PY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="WRS_CODE != null and WRS_CODE.length() >  0 and WRS_CODE != 'all'.toString()">
				AND A.NA_WRS_C = #{WRS_CODE}
			</if>
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
				<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
					AND A.ACTL_BUYPL_NA_TRPL_C = #{NA_BZPLC}
				</if>
			</if>     
	 GROUP BY A.NA_WRS_C,
	       A.NA_BZPLC,  
	       A.TXT_DSC 
	) A, TB_GD_WRS B 
	WHERE A.NA_WRS_C = B.NA_WRS_C 
	GROUP BY A.NA_WRS_C, B.WRSNM, B.WRS_STDNM
	ORDER BY A.NA_WRS_C 
	</select>
	
	<!-- 검수실적-상품별 마스터 엑셀 -->
	<select id="downloadExcelRecadvSlpMasterList_WRS_backup" parameterType="java.util.Map" resultType="java.util.Map">
	with temp_tab as (
		SELECT /*+ leading(a wrs d b c tc f) use_nl(a wrs d d b c tc f) */
			A.NA_TEAM_C,
		
			NVL(MIN(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<]]> TRIM(NVL((NVL(A.ACTL_BUYPL_NA_TRPL_C,A.NA_BZPLC)),' ')) AND TRIM(NVL((NVL(A.ACTL_BUYPL_NA_TRPL_C,A.NA_BZPLC)),' ')) IS NOT NULL THEN NVL((NVL(A.ACTL_BUYPL_NA_TRPL_C,A.NA_BZPLC)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END ),' ') AS   ACTL_BUYPL_NA_TRPL_C
			
      		, A.NA_BZPLC
            , A.SLP_DT 
            , A.NA_TR_DSC
            , A.NA_SLPNO
            , WRS.SLP_SQNO
            , WRS.NA_WRS_C  
			, DECODE(MIN(WRS.TXT_DSC),'1','과세','2','면세','3','영세',MIN(WRS.TXT_DSC)) TXT_DSC_NM
            , MIN(WRS.TXT_DSC) TXT_DSC
            <!-- , DECODE(SUM(WRS.BYNG_QT),0,0,ROUND(SUM(WRS.BYAM)/SUM(WRS.BYNG_QT),2))  DANGA -->
            , FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.BYNG_QT),0) BYNG_QT

			<!-- ,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C <![CDATA[<>]]> '912' ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C <![CDATA[<>]]> '912' ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/ -->
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
	                   
		FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">					
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="WRS_CODE != null and WRS_CODE.length() >  0 and WRS_CODE != 'all'.toString()">
					AND WRS.NA_WRS_C = #{WRS_CODE}
				</if>
		GROUP BY 
		WRS.NA_WRS_C
        , FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)
		, A.NA_BZPLC
		, A.SLP_DT 
		, A.NA_TR_DSC
		, A.NA_SLPNO
		, WRS.SLP_SQNO
		, A.NA_TEAM_C
	)
	SELECT		
		DECODE(X.SEQ, '1', NULL  , A.NA_WRS_C)       NA_WRS_C /*상품코드*/
		, DECODE(X.SEQ, '1', '합계', MIN(B.WRSNM))     WRSNM /*상품명*/
		, DECODE(X.SEQ, '1', NULL  , MIN(B.WRS_STDNM)) WRS_STDNM /*규격*/
		, DECODE(X.SEQ, '1', NULL  , MIN(A.TXT_DSC_NM))   TXT_DSC /*면과세구분*/
		, DECODE(X.SEQ, '1', NULL  , DECODE(SUM(A.BYNG_QT),0,0,ROUND(SUM(A.BYAM)/SUM(A.BYNG_QT),2)))     DANGA
		             
		, SUM(A.BYNG_QT) BYNG_QT /*매입수량*/
		              
		, SUM(A.BYAM-A.BYNG_VAT) GAM_AM /*공급금액*/
		, SUM(A.BYNG_VAT) BYNG_VAT /*부가세*/		
		<!-- , SUM(A.BYAM) TOT_GAM /*총공급금액*/ -->
		, SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM /*총공급금액*/
		, SUM(A.CHRG_TOT) CHRG_TOT /*총공제금액*/
		, SUM(A.COMP_FEE) COMP_FEE /*업체별수수료*/
		, SUM(A.BYNG_SSDY) BYNG_SSDY /*매입장려금*/
		, SUM(A.ETR_AMN_FEE) ETR_AMN_FEE /*수탁관리수수료*/
		, SUM(A.ETR_AMN_VAT) ETR_AMN_VAT /*수탁관리부가세*/
		, SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE /*매취관리수수료*/
		, SUM(A.PHD_FEE) PHD_FEE /*물류수수료*/
		, SUM(A.PHD_FEE_VAT) PHD_FEE_VAT /*물류부가세*/
		, SUM(A.TRP_SVC_CST) TRP_SVC_CST /*운송용역비*/
		, SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT /*운송부가세*/
		, SUM(A.ETC_FEE) ETC_FEE /*기타수수료*/
		, SUM(A.ETC_FEE_VAT) ETC_FEE_VAT /*기타수수료부가세*/
		
		, MIN(A.NA_BZPLC) NA_BZPLC
		, MIN(A.NA_TEAM_C) NA_TEAM_C
		, MIN(A.SLP_DT) SLP_DT
		, MIN(A.NA_SLPNO) NA_SLPNO
	FROM
		temp_tab A
		, TB_GD_WRS B
		, (SELECT LEVEL SEQ FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]>  2) X
	WHERE 1=1
		AND A.NA_WRS_C = B.NA_WRS_C
		<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
				AND A.ACTL_BUYPL_NA_TRPL_C = #{NA_BZPLC}
			</if>
		</if>	
	GROUP BY X.SEQ, DECODE(X.SEQ, '1', NULL, A.NA_WRS_C)
    ORDER BY X.SEQ, NA_WRS_C
	</select>
	
	<sql id="sql_recadvSlpMasterList_WRS">
	SELECT DECODE(X.SEQ, '1', NULL , A.NA_WRS_C) NA_WRS_C, 
	       DECODE(X.SEQ, '1', '합계', MIN(A.WRSNM)) WRSNM, 
	       DECODE(X.SEQ, '1', NULL , MIN(A.WRS_STDNM)) WRS_STDNM, 
	       DECODE(X.SEQ, '1', NULL , MIN(A.TXT_DSC)) TXT_DSC, 
	       DECODE(X.SEQ, '1', NULL , MIN(A.DANGA)) DANGA , 
	       SUM(A.BYNG_QT) BYNG_QT, 
	       SUM(A.GAM_AM) GAM_AM, 
	       SUM(A.BYNG_VAT) BYNG_VAT, 
	       SUM(A.TOT_GAM) TOT_GAM, 
	       SUM(A.CHRG_TOT) CHRG_TOT, 
	       SUM(A.COMP_FEE) COMP_FEE, 
	       SUM(A.BYNG_SSDY) BYNG_SSDY, 
	       SUM(A.ETR_AMN_FEE) ETR_AMN_FEE, 
	       SUM(A.ETR_AMN_VAT) ETR_AMN_VAT, 
	       SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE, 
	       SUM(A.PHD_FEE) PHD_FEE, 
	       SUM(A.PHD_FEE_VAT) PHD_FEE_VAT, 
	       SUM(A.TRP_SVC_CST) TRP_SVC_CST, 
	       SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT, 
	       SUM(A.ETC_FEE) ETC_FEE, 
	       SUM(A.ETC_FEE_VAT) ETC_FEE_VAT, 
	       MIN(A.NA_BZPLC) NA_BZPLC 
	  FROM 
	       (SELECT A.NA_WRS_C NA_WRS_C, 
	              B.WRSNM WRSNM, 
	              B.WRS_STDNM WRS_STDNM, 
	              MIN(A.TXT_DSC) TXT_DSC, 
	              DECODE(SUM(A.BYNG_QT),0,0,ROUND(SUM(A.BYAM)/SUM(A.BYNG_QT),2)) DANGA, 
	              SUM(A.BYNG_QT) BYNG_QT, 
	              SUM(A.GAM_AM) GAM_AM, 
	              SUM(A.BYNG_VAT) BYNG_VAT, 
	              SUM(A.TOT_GAM) TOT_GAM, 
	              SUM(A.CHRG_TOT) CHRG_TOT, 
	              SUM(A.COMP_FEE) COMP_FEE, 
	              SUM(A.BYNG_SSDY) BYNG_SSDY, 
	              SUM(A.ETR_AMN_FEE) ETR_AMN_FEE, 
	              SUM(A.ETR_AMN_VAT) ETR_AMN_VAT, 
	              SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE, 
	              SUM(A.PHD_FEE) PHD_FEE, 
	              SUM(A.PHD_FEE_VAT) PHD_FEE_VAT, 
	              SUM(A.TRP_SVC_CST) TRP_SVC_CST, 
	              SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT, 
	              SUM(A.ETC_FEE) ETC_FEE, 
	              SUM(A.ETC_FEE_VAT) ETC_FEE_VAT, 
	              MIN(A.NA_BZPLC) NA_BZPLC 
	         FROM 
	              (SELECT /*+ index(a IDX_DP_CM_WRS_CNR_RZS_02) */ 
	                     A.NA_WRS_C NA_WRS_C, 
	                     MIN(DECODE(A.TXT_DSC,'1','과세','2','면세','3','영세',A.TXT_DSC)) TXT_DSC, 
	                     SUM(BYNG_QT) BYNG_QT, 
	                     SUM(A.BYAM-A.BYNG_VAT) GAM_AM, 
	                     SUM(A.BYNG_VAT) BYNG_VAT, 
	                     SUM(A.BYAM) BYAM, 
	                     --SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM,
	                     SUM(NVL(A.BYAM, 0)+NVL(A.VCBT_AM, 0)+NVL(A.VCBX_AM, 0)) TOT_GAM,  
	                     SUM(BYNG_SSDY+ETR_AMN_FEE+ETR_AMN_VAT+SLGT_AMN_FEE+PHD_FEE+PHD_FEE_VAT+ TRP_SVC_CST+TRP_SVCOS_VAT+ETC_FEE+ETC_FEE_VAT) CHRG_TOT, 
	                     SUM(COMP_FEE) COMP_FEE, 
	                     SUM(BYNG_SSDY) BYNG_SSDY, 
	                     SUM(ETR_AMN_FEE) ETR_AMN_FEE, 
	                     SUM(ETR_AMN_VAT) ETR_AMN_VAT, 
	                     SUM(SLGT_AMN_FEE) SLGT_AMN_FEE, 
	                     SUM(PHD_FEE) PHD_FEE, 
	                     SUM(PHD_FEE_VAT) PHD_FEE_VAT, 
	                     SUM(TRP_SVC_CST) TRP_SVC_CST, 
	                     SUM(TRP_SVCOS_VAT) TRP_SVCOS_VAT, 
	                     SUM(ETC_FEE) ETC_FEE, 
	                     SUM(ETC_FEE_VAT) ETC_FEE_VAT, 
	                     A.NA_BZPLC NA_BZPLC 
	                FROM TB_DP_CM_WRS_CNR_RZS A 
	               WHERE A.NA_TRPL_C IN 
	                     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
			    		  #{item}
						 </foreach> 
						 <choose>
							<when test="SEARCH_DATE_TYPE == '1'.toString()">
								AND A.TR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
							</when>
							<when test="SEARCH_DATE_TYPE == '2'.toString()">
								AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
							</when>
							<when test="SEARCH_DATE_TYPE == '3'.toString()">					
								AND A.PY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
							</when>
						</choose> 
				       <choose>
							<when test="TRADE_TYPE == null or TRADE_TYPE == ''">					
							</when>
							<when test="TRADE_TYPE == '1'.toString()">
								AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
								AND A.NA_CRC_CAN_DSC = '1'
							</when>
							<when test="TRADE_TYPE == '2'.toString()">
								AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
								AND A.NA_CRC_CAN_DSC = '1'
							</when>
							<when test="TRADE_TYPE == '3'.toString()">
								AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
							</when>
							<when test="TRADE_TYPE == '4'.toString()">
								AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
							</when>
						</choose>
						<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
							AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
						</if>
						<if test="WRS_CODE != null and WRS_CODE.length() >  0 and WRS_CODE != 'all'.toString()">
							AND A.NA_WRS_C = #{WRS_CODE}
						</if>
						<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
							<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
								AND A.ACTL_BUYPL_NA_TRPL_C = #{NA_BZPLC}
							</if>
						</if>
	               GROUP BY A.NA_WRS_C, 
	                     A.NA_BZPLC, 
	                     A.TXT_DSC 
	              ) A, 
	              TB_GD_WRS B 
	        WHERE A.NA_WRS_C = B.NA_WRS_C 
	        GROUP BY A.NA_WRS_C, 
	              B.WRSNM, 
	              B.WRS_STDNM 
	       ) A , 
	       (SELECT LEVEL SEQ 
	         FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> 2 
	       ) X 
	 WHERE 1=1 
	 GROUP BY X.SEQ, 
	       DECODE(X.SEQ, '1', NULL, A.NA_WRS_C) 
	ORDER BY X.SEQ, 
	       NA_WRS_C 
	</sql>
	
	<!-- 검수실적-상품별 마스터 엑셀 -->
	<select id="downloadExcelRecadvSlpMasterList_WRS" parameterType="java.util.Map" resultType="java.util.Map">
		<include refid="sql_recadvSlpMasterList_WRS" />
	</select>
	
	<!-- 검수실적 상품별 전표 상품 수수료 엑셀 빌링 -->
	<select id="downloadExcelRecadvSlpMasterList_WRS_billing" parameterType="java.util.Map" resultType="java.util.Map">
	with temp_tab as (
		SELECT /*+ leading(a wrs d b c tc f) use_nl(a wrs d d b c tc f) */
			A.NA_TEAM_C,
		
			NVL(MIN(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<]]> TRIM(NVL((NVL(A.ACTL_BUYPL_NA_TRPL_C,A.NA_BZPLC)),' ')) AND TRIM(NVL((NVL(A.ACTL_BUYPL_NA_TRPL_C,A.NA_BZPLC)),' ')) IS NOT NULL THEN NVL((NVL(A.ACTL_BUYPL_NA_TRPL_C,A.NA_BZPLC)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END ),' ') AS   ACTL_BUYPL_NA_TRPL_C
			
      		, A.NA_BZPLC
            , A.SLP_DT 
            , A.NA_TR_DSC
            , A.NA_SLPNO
            , WRS.SLP_SQNO
            , WRS.NA_WRS_C  
			, DECODE(MIN(WRS.TXT_DSC),'1','과세','2','면세','3','영세',MIN(WRS.TXT_DSC)) TXT_DSC_NM
            , MIN(WRS.TXT_DSC) TXT_DSC
            <!-- , DECODE(SUM(WRS.BYNG_QT),0,0,ROUND(SUM(WRS.BYAM)/SUM(WRS.BYNG_QT),2))  DANGA -->
            , FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.BYNG_QT),0) BYNG_QT

			<!-- ,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C <![CDATA[<>]]> '912' ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C <![CDATA[<>]]> '912' ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/ -->
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
	                   
		FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">					
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="WRS_CODE != null and WRS_CODE.length() >  0 and WRS_CODE != 'all'.toString()">
					AND WRS.NA_WRS_C = #{WRS_CODE}
				</if>
		GROUP BY 
		WRS.NA_WRS_C
        , FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)
		, A.NA_BZPLC
		, A.SLP_DT 
		, A.NA_TR_DSC
		, A.NA_SLPNO
		, WRS.SLP_SQNO
		, A.NA_TEAM_C
	)
	SELECT             
		(A.BYNG_QT) BYNG_QT /*매입수량*/
		              
		, (A.BYAM-A.BYNG_VAT) GAM_AM /*공급금액*/
		, (A.BYNG_VAT) BYNG_VAT /*부가세*/		
		<!-- , SUM(A.BYAM) TOT_GAM /*총공급금액*/ -->
		, (A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM /*총공급금액*/
		, (A.CHRG_TOT) CHRG_TOT /*총공제금액*/
		, (A.COMP_FEE) COMP_FEE /*업체별수수료*/
		, (A.BYNG_SSDY) BYNG_SSDY /*매입장려금*/
		, (A.ETR_AMN_FEE) ETR_AMN_FEE /*수탁관리수수료*/
		, (A.ETR_AMN_VAT) ETR_AMN_VAT /*수탁관리부가세*/
		, (A.SLGT_AMN_FEE) SLGT_AMN_FEE /*매취관리수수료*/
		, (A.PHD_FEE) PHD_FEE /*물류수수료*/
		, (A.PHD_FEE_VAT) PHD_FEE_VAT /*물류부가세*/
		, (A.TRP_SVC_CST) TRP_SVC_CST /*운송용역비*/
		, (A.TRP_SVCOS_VAT) TRP_SVCOS_VAT /*운송부가세*/
		, (A.ETC_FEE) ETC_FEE /*기타수수료*/
		, (A.ETC_FEE_VAT) ETC_FEE_VAT /*기타수수료부가세*/
		
		, (A.NA_BZPLC) NA_BZPLC
		, (A.NA_TEAM_C) NA_TEAM_C
		, (A.SLP_DT) SLP_DT
		, (A.NA_SLPNO) NA_SLPNO
	FROM
		temp_tab A
		, TB_GD_WRS B	
	WHERE 1=1
		AND A.NA_WRS_C = B.NA_WRS_C
		<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
				AND A.ACTL_BUYPL_NA_TRPL_C = #{NA_BZPLC}
			</if>
		</if>	
    ORDER BY A.NA_WRS_C
	</select>
	
	<sql id="sql_recadvSlpDetailList_WRS">
	with temp_tab as (
		SELECT /*+ leading(a wrs d b c tc f) use_nl(a wrs d d b c tc f) */
			NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS   ACTL_BUYPL_NA_TRPL_C
            
            <!-- , DECODE(SUM(WRS.BYNG_QT),0,0,ROUND(SUM(WRS.BYAM)/SUM(WRS.BYNG_QT),2))  DANGA -->
            , FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.BYNG_QT),0) BYNG_QT

			<!-- ,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C <![CDATA[<>]]> '912' ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C <![CDATA[<>]]> '912' ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/ -->
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYAM ELSE 0 END ),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN (WRS.SLP_SQNO <![CDATA[<]]> 1000 AND WRS.NA_LLED_C NOT IN ( '912','913') ) THEN WRS.BYNG_VAT ELSE 0 END ),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
	     , WRS.NA_WRS_C
	     , A.NA_BZPLC		  
		 , A.SLP_DT		 
		 , A.NA_TR_DSC 
		 , A.NA_SLPNO 
		 , WRS.SLP_SQNO
		 , A.NA_TEAM_C
		FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            AND NVL(WRS.DEL_YN, 0) = '0'  /* 삭제여부 (1: 여, 0: 부) */
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">					
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">					
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="WRS_CODE != null and WRS_CODE.length() >  0 and WRS_CODE != 'all'.toString()">
					AND WRS.NA_WRS_C = #{WRS_CODE}
				</if>
		GROUP BY 
		FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)
		, WRS.NA_WRS_C
		, A.NA_BZPLC
		, A.SLP_DT		
		, A.NA_TR_DSC 
		, A.NA_SLPNO 
		, WRS.SLP_SQNO
		, A.NA_TEAM_C
	)
	SELECT		
		A.ACTL_BUYPL_NA_TRPL_C
		, B.CLNTNM CLNTNM
		, SUM(A.BYNG_QT) BYNG_QT /*매입수량*/		              
		, SUM(A.BYAM-A.BYNG_VAT) GAM_AM /*공급금액*/
		, SUM(A.BYNG_VAT) BYNG_VAT /*부가세*/
		<!-- , SUM(A.BYAM) TOT_GAM /*총공급금액*/ -->
		<!-- , SUM(A.BYAM+A.VCBT_AM+A.VCBX_AM) TOT_GAM /*총공급금액*/-->
		, SUM(NVL(A.BYAM, 0)+NVL(A.VCBT_AM, 0)+NVL(A.VCBX_AM, 0)) TOT_GAM /*총공급금액*/  
		, SUM(A.CHRG_TOT) CHRG_TOT /*총공제금액*/
		, SUM(A.COMP_FEE) COMP_FEE /*업체별수수료*/		
		, SUM(A.ETR_AMN_FEE) ETR_AMN_FEE /*수탁관리수수료*/
		, SUM(A.ETR_AMN_VAT) ETR_AMN_VAT /*수탁관리부가세*/
		, SUM(A.SLGT_AMN_FEE) SLGT_AMN_FEE /*매취관리수수료*/
		, SUM(A.PHD_FEE) PHD_FEE /*물류수수료*/
		, SUM(A.PHD_FEE_VAT) PHD_FEE_VAT /*물류부가세*/
		, SUM(A.TRP_SVC_CST) TRP_SVC_CST /*운송용역비*/
		, SUM(A.TRP_SVCOS_VAT) TRP_SVCOS_VAT /*운송부가세*/
		, SUM(A.ETC_FEE) ETC_FEE /*기타수수료*/
		, SUM(A.ETC_FEE_VAT) ETC_FEE_VAT /*기타수수료부가세*/
		, SUM(A.BYNG_SSDY) BYNG_SSDY /*매입장려금*/
		<!-- , MIN(A.DANGA)     DANGA -->
		, DECODE(SUM(A.BYNG_QT),0,0,ROUND(SUM(A.BYAM)/SUM(A.BYNG_QT),2)) DANGA
		, A.NA_WRS_C
		
		, MIN(A.NA_BZPLC) NA_BZPLC
		, MIN(A.NA_TEAM_C) NA_TEAM_C
		, MIN(A.SLP_DT) SLP_DT
		, MIN(A.NA_SLPNO) NA_SLPNO
	FROM
		temp_tab A
		, TB_TR_TRPL_CIF B		
	WHERE 1=1
		AND A.ACTL_BUYPL_NA_TRPL_C = B.NA_TRPL_C
		<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
				AND A.ACTL_BUYPL_NA_TRPL_C = #{NA_BZPLC}
			</if>
		</if>	
	GROUP BY
		A.ACTL_BUYPL_NA_TRPL_C
		, B.CLNTNM
		, A.NA_WRS_C
    ORDER BY A.ACTL_BUYPL_NA_TRPL_C
	</sql>
	
	<!-- 검수실적-상품별 두번째 그리드 조회 -->
	<select id="retrieveRecadvSlpDetailList_WRS" parameterType="java.util.Map" resultType="java.util.Map">
		<include refid="sql_recadvSlpDetailList_WRS" />
	</select>
	
	<sql id="sql_recadvSlpDetail2List_WRS">
	with temp_tab as (
		SELECT /*+  USE_NL (A WRS) USE_NL (WRS D)  index(A IDX_BY_BYNG_M_03 ) */
             A.NA_BZPLC ,
             A.NA_TEAM_C ,
             A.SLP_DT ,
             A.NA_SLPNO ,
			 '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC_NM ,
             A.NA_CRC_CAN_DSC NA_CRC_CAN_DSC,                     
             C.CLNTNM CCLNTNM, /*본지사명*/ 
             FN_CM_SIMP_CNM('SPY_TPC',WRS.SPY_TPC) SPY_TPC,
             WRS.SLP_SQNO,
             WRS.NA_WRS_C,                                          
             TRT.PD_YY,
             TRT.INPD_QT,
             WRS.TXT_DSC,
             WRS.BYNG_UPR,
             FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * WRS.BYNG_QT BYNG_QT,
             WRS.BYNG_WT,                     
             A.NA_DVY_PLASH_SLPNO
             			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/

			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.BYAM),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.BYNG_VAT),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/

			
			, A.NA_TR_DSC NA_TR_DSC
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC_NM                     
						
			, TC.SIMP_CNM AS ROTS_CTR_DSC
			, A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			
			<!-- ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/  배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C			
			,NVL(MIN(A.DVYAA_NA_TRPL_C     ),A.NA_BZPLC)    DVYAA_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			, SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * D.SPY_AM) SPY_AM
			, SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * D.TXT_VAT) TXT_VAT
		FROM 
			TB_BY_BYNG_M A
			, TB_BY_BYNG_WRS WRS
			, TB_CM_SIMPC TC
			, TB_TR_TRPL_CIF B
			, TB_TR_TRPL_CIF C
			, TB_CM_BZPL F						
			, TB_OD_TRTWRS TRT
			, TB_BY_BYNG_FEE D
		WHERE 1=1
			AND WRS.NA_BZPLC = TRT.NA_BZPLC
			AND WRS.NA_WRS_C = TRT.NA_WRS_C
			AND NVL(WRS.DEL_YN, 0) = '0'  /* 삭제여부 (1: 여, 0: 부) */
			
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)
			AND (D.SPY_AM <![CDATA[>]]> 0 OR D.TXT_VAT <![CDATA[>]]> 0 OR D.NA_BZPLC IS NULL)
						
			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">					
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">					
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="WRS_CODE != null and WRS_CODE.length() >  0 and WRS_CODE != 'all'.toString()">
					AND WRS.NA_WRS_C = #{WRS_CODE}
				</if>
		GROUP BY
			A.NA_BZPLC
			, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
			, C.CLNTNM
			, A.NA_DVY_PLASH_SLPNO
			, A.CNR_DT
			, SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			, WRS.RPY_PLA_DT
			, FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)
			, A.NA_TR_DSC
			, A.BUYPL_NA_TRPL_C
			, NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC)
			, A.ADJ_NA_BZPLC
			, A.ADJ_NA_TRPL_C
			, A.EDIRG_DTM
			, A.FS_RMS_DT
			, A.NA_BZPLC
			, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
			, WRS.SLP_SQNO
			, WRS.SPY_TPC
			, TC.SIMP_CNM
			, WRS.NA_WRS_C
			, A.NA_CRC_CAN_DSC
			, TRT.PD_YY
			, TRT.INPD_QT
			, WRS.TXT_DSC
			, WRS.BYNG_UPR
			, WRS.BYNG_QT
			, WRS.BYNG_WT
	)
	SELECT  /*+  ordered  index(Y XPK_TB_OD_DLVPNSHT_M  ) */
		A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
		, A.ACTL_BUYPL_NA_TRPL_C /*거래처코드*/
		, A.CCLNTNM /*거래처명*/
		, A.TRSLPNO /*매출일 전표변호*/
		, A.CNR_DT /*검수일자*/
		, A.RPY_PLA_DT /*지급예정일*/
		, A.NA_DVY_PLASH_SLPNO /*배송예정번호*/
		, DECODE(Y.PBDDLY_YN, '1', 'PB직송', '일반') AS PBDDLY_YN /* 배송예정서 PB직송구분 */
		, DECODE(Y.DVY_PLASH_CRT_DSC, '002', '혁신', '일반') AS DVY_PLASH_CRT_DSC /* 배송예정서 혁신구분 */
		, A.MNGT_NA_TRPL_C /*실매입처사업장코드*/
		, B.CLNTNM BCLNTNM /*실매입처명*/
		, A.NA_BZPLC /*경제통합사업장코드*/
		, FN_TRPL_CIF_NM(A.NA_BZPLC) NA_BZPLC_NM /*경제통합사업장명*/
		, A.SPY_TPC /*공급유형*/
		, A.ROTS_CTR_DSC /*계통계약구분*/
		, A.SLP_SQNO /*전표일련번호*/
		, A.NA_WRS_C /*경제통합상품코드*/
		, A.PD_YY /*생산년도*/
		, C.WRS_ABR_NM /*상품명*/
		, C.WRS_STDNM /*상품규격명*/
		, DECODE(A.TXT_DSC,'1','과세','2','면세','3','영세',A.TXT_DSC) TXT_DSC /*과세구분코드명*/
		, A.BYNG_WT /*입고중량*/
		, A.INPD_QT /*내품수량*/
		, A.BYNG_UPR /*매입단가*/
		, SUM(A.BYNG_QT) BYNG_QT /*매입수량*/
		, SUM(A.BYAM-A.BYNG_VAT) GAM_AM /*공급금액*/ 
		, SUM(A.BYNG_VAT) BYNG_VAT /*매입부가세*/
		, SUM(A.BYAM) BYAM /*매입금액*/
		, '' FEE_ACG_ACCC /*수수료회계계정코드*/
		, '' ACCNM /*수수료회계계정명*/
		, A.SPY_AM - A.TXT_VAT SPY_AM
		, A.TXT_VAT
		, '' NA_FEE_C /*수수료코드*/
		, '' FEENM /*수수료명*/		
		, A.NA_TR_DSC /*거래구분코드*/
		, A.NA_TR_DSC_NM /*거래구분명*/
		, A.NA_CRC_CAN_DSC /*정정취소구분*/
		, A.NA_CRC_CAN_DSC_NM /*정정취소구분명*/
		, MIN(Y.fsrgmn_eno) FSRGMN_ENO /*배송예정서작성자*/
	FROM
		temp_tab A 
		, TB_TR_TRPL_CIF B 
		, TB_OD_DLVPNSHT_M Y
		, TB_GD_WRS C
	WHERE 1=1
		AND A.NA_WRS_C = C.NA_WRS_C
		<if test="MNGT_NA_TRPL_C != null and MNGT_NA_TRPL_C.length() >  0 and MNGT_NA_TRPL_C != 'all'.toString()">
			AND A.MNGT_NA_TRPL_C = #{MNGT_NA_TRPL_C}
		</if>
<!-- 		<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> -->
<!-- 			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> -->
<!-- 				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC} -->
<!-- 			</if> -->
<!-- 		</if> -->
		AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C 
		AND A.ACTL_BUYPL_NA_TRPL_C = Y.SPYPL_NA_TRPL_C (+) 
		AND A.MNGT_NA_TRPL_C = Y.DVYAA_NA_TRPL_C (+) 
		AND A.NA_DVY_PLASH_SLPNO = Y.NA_DVY_PLASH_SLPNO (+)
		AND Y.DVY_PLA_DT(+) BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-180,'YYYYMMDD') AND #{TO_DATE}
		<!-- 
		AND NVL(Y.DVY_PLA_DT, '20191215') BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-94,'YYYYMMDD') AND #{TO_DATE}
		 -->
	GROUP BY
		A.NA_BZPLC
		, A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
		, A.CCLNTNM
		, A.NA_DVY_PLASH_SLPNO
		, Y.PBDDLY_YN
		, Y.DVY_PLASH_CRT_DSC
		, B.CLNTNM
		, A.CNR_DT
		, A.TRSLPNO
		, A.RPY_PLA_DT
		, A.NA_TR_DSC
		, A.ROTS_CTR_DSC
		, A.ACTL_BUYPL_NA_TRPL_C
		, A.MNGT_NA_TRPL_C
		, A.NA_CRC_CAN_DSC
		, A.SPY_TPC
		, A.SLP_SQNO
		, A.NA_WRS_C
		, A.NA_CRC_CAN_DSC
		, A.NA_CRC_CAN_DSC_NM
		, C.WRS_ABR_NM
		, C.WRS_STDNM
		, A.PD_YY
		, A.TXT_DSC
		, A.INPD_QT
		, A.BYNG_UPR
		, A.BYNG_WT
		, A.SPY_AM
		, A.TXT_VAT
		, A.NA_TR_DSC_NM
	ORDER BY A.ACTL_BUYPL_NA_TRPL_C
	</sql>
	
	<!-- 검수실적 상품별 3번째 그리드 -->
	<select id="retrieveRecadvSlpDetail2List_WRS" parameterType="java.util.Map" resultType="java.util.Map">
		<include refid="sql_recadvSlpDetail2List_WRS"></include>
	</select>
	
	<sql id="sql_recadvSlpDetail3List_WRS">
	with temp_tab as (
		SELECT /*+  USE_NL (A WRS) USE_NL (WRS D)  index(A IDX_BY_BYNG_M_03 ) */
             A.NA_BZPLC ,
             A.NA_TEAM_C ,
             A.SLP_DT ,
             A.NA_SLPNO ,
			 '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC_NM ,
             A.NA_CRC_CAN_DSC NA_CRC_CAN_DSC,                     
             C.CLNTNM CCLNTNM, /*본지사명*/ 
             FN_CM_SIMP_CNM('SPY_TPC',WRS.SPY_TPC) SPY_TPC,
             WRS.SLP_SQNO,
             WRS.NA_WRS_C,                                          
             TRT.PD_YY,
             TRT.INPD_QT,
             WRS.TXT_DSC,
             WRS.BYNG_UPR,
             FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * WRS.BYNG_QT BYNG_QT,
             WRS.BYNG_WT,                     
             A.NA_DVY_PLASH_SLPNO
             			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/

			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.BYAM),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.BYNG_VAT),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/

			
			, A.NA_TR_DSC NA_TR_DSC
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC_NM                     
						
			, TC.SIMP_CNM AS ROTS_CTR_DSC
			, A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			

			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C			
			,NVL(MIN(A.DVYAA_NA_TRPL_C     ),A.NA_BZPLC)    DVYAA_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			, SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * D.SPY_AM) SPY_AM
			, SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * D.TXT_VAT) TXT_VAT
		FROM 
			TB_BY_BYNG_M A
			, TB_BY_BYNG_WRS WRS
			, TB_CM_SIMPC TC
			, TB_TR_TRPL_CIF B
			, TB_TR_TRPL_CIF C
			, TB_CM_BZPL F						
			, TB_OD_TRTWRS TRT
			, TB_BY_BYNG_FEE D
		WHERE 1=1
			AND WRS.NA_BZPLC = TRT.NA_BZPLC
			AND WRS.NA_WRS_C = TRT.NA_WRS_C
			AND NVL(WRS.DEL_YN, 0) = '0'  /* 삭제여부 (1: 여, 0: 부) */
			
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)
			AND (D.SPY_AM <![CDATA[>]]> 0 OR D.TXT_VAT <![CDATA[>]]> 0 OR D.NA_BZPLC IS NULL)
						
			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">					
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">					
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="WRS_CODE != null and WRS_CODE.length() >  0 and WRS_CODE != 'all'.toString()">
					AND WRS.NA_WRS_C = #{WRS_CODE}
				</if>
		GROUP BY
			A.NA_BZPLC
			, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
			, C.CLNTNM
			, A.NA_DVY_PLASH_SLPNO
			, A.CNR_DT
			, SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			, WRS.RPY_PLA_DT
			, FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)
			, A.NA_TR_DSC
			, A.BUYPL_NA_TRPL_C
			, NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC)
			, A.ADJ_NA_BZPLC
			, A.ADJ_NA_TRPL_C
			, A.EDIRG_DTM
			, A.FS_RMS_DT
			, A.NA_BZPLC
			, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
			, WRS.SLP_SQNO
			, WRS.SPY_TPC
			, TC.SIMP_CNM
			, WRS.NA_WRS_C
			, A.NA_CRC_CAN_DSC
			, TRT.PD_YY
			, TRT.INPD_QT
			, WRS.TXT_DSC
			, WRS.BYNG_UPR
			, WRS.BYNG_QT
			, WRS.BYNG_WT
	)
	SELECT  /*+  ordered  index(Y XPK_TB_OD_DLVPNSHT_M  ) */
		A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
		, A.ACTL_BUYPL_NA_TRPL_C /*거래처코드*/
		, A.CCLNTNM /*거래처명*/
		, A.TRSLPNO /*매출일 전표변호*/
		, A.CNR_DT /*검수일자*/
		, A.RPY_PLA_DT /*지급예정일*/
		, A.NA_DVY_PLASH_SLPNO /*배송예정번호*/
		, '' AS PBDDLY_YN /* 배송예정서 PB직송구분 */
		, '' AS DVY_PLASH_CRT_DSC /* 배송예정서 혁신구분 */
		, A.MNGT_NA_TRPL_C /*실매입처사업장코드*/
		, B.CLNTNM BCLNTNM /*실매입처명*/
		, A.NA_BZPLC /*경제통합사업장코드*/
		, FN_TRPL_CIF_NM(A.NA_BZPLC) NA_BZPLC_NM /*경제통합사업장명*/
		, A.SPY_TPC /*공급유형*/
		, A.ROTS_CTR_DSC /*계통계약구분*/
		, A.SLP_SQNO /*전표일련번호*/
		, A.NA_WRS_C /*경제통합상품코드*/
		, A.PD_YY /*생산년도*/
		, C.WRS_ABR_NM /*상품명*/
		, C.WRS_STDNM /*상품규격명*/
		, DECODE(A.TXT_DSC,'1','과세','2','면세','3','영세',A.TXT_DSC) TXT_DSC /*과세구분코드명*/
		, A.BYNG_WT /*입고중량*/
		, A.INPD_QT /*내품수량*/
		, A.BYNG_UPR /*매입단가*/
		, SUM(A.BYNG_QT) BYNG_QT /*매입수량*/
		, SUM(A.BYAM-A.BYNG_VAT) GAM_AM /*공급금액*/ 
		, SUM(A.BYNG_VAT) BYNG_VAT /*매입부가세*/
		, SUM(A.BYAM) BYAM /*매입금액*/
		, '' FEE_ACG_ACCC /*수수료회계계정코드*/
		, '' ACCNM /*수수료회계계정명*/
		, A.SPY_AM - A.TXT_VAT SPY_AM
		, A.TXT_VAT
		, '' NA_FEE_C /*수수료코드*/
		, '' FEENM /*수수료명*/		
		, A.NA_TR_DSC /*거래구분코드*/
		, A.NA_TR_DSC_NM /*거래구분명*/
		, A.NA_CRC_CAN_DSC /*정정취소구분*/
		, A.NA_CRC_CAN_DSC_NM /*정정취소구분명*/
		, '' AS FSRGMN_ENO /*배송예정서작성자*/
	FROM
		temp_tab A 
		, TB_TR_TRPL_CIF B 
		, TB_GD_WRS C
	WHERE 1=1
		AND A.NA_WRS_C = C.NA_WRS_C
		<if test="MNGT_NA_TRPL_C != null and MNGT_NA_TRPL_C.length() >  0 and MNGT_NA_TRPL_C != 'all'.toString()">
			AND A.MNGT_NA_TRPL_C = #{MNGT_NA_TRPL_C}
		</if>

		AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C 

	GROUP BY
		A.NA_BZPLC
		, A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
		, A.CCLNTNM
		, A.NA_DVY_PLASH_SLPNO
		, B.CLNTNM
		, A.CNR_DT
		, A.TRSLPNO
		, A.RPY_PLA_DT
		, A.NA_TR_DSC
		, A.ROTS_CTR_DSC
		, A.ACTL_BUYPL_NA_TRPL_C
		, A.MNGT_NA_TRPL_C
		, A.NA_CRC_CAN_DSC
		, A.SPY_TPC
		, A.SLP_SQNO
		, A.NA_WRS_C
		, A.NA_CRC_CAN_DSC
		, A.NA_CRC_CAN_DSC_NM
		, C.WRS_ABR_NM
		, C.WRS_STDNM
		, A.PD_YY
		, A.TXT_DSC
		, A.INPD_QT
		, A.BYNG_UPR
		, A.BYNG_WT
		, A.SPY_AM
		, A.TXT_VAT
		, A.NA_TR_DSC_NM
	ORDER BY A.ACTL_BUYPL_NA_TRPL_C
	</sql>
	
	<!-- 검수실적 상품별 3번째 그리드 -->
	<select id="retrieveRecadvSlpDetail3List_WRS" parameterType="java.util.Map" resultType="java.util.Map">
		<include refid="sql_recadvSlpDetail3List_WRS"></include>
	</select>
	
	<select id="retrieveRecadvSlpDetail2List_WRS_SUM" parameterType="java.util.Map" resultType="java.util.Map">
	with temp_tab as (
		SELECT /*+ ordered */
             A.NA_BZPLC ,
             A.NA_TEAM_C ,
             A.SLP_DT ,
             A.NA_SLPNO ,
             '[' || A.NA_CRC_CAN_DSC || '] ' || FN_CM_SIMP_CNM('NA_CRC_CAN_DSC', A.NA_CRC_CAN_DSC) AS NA_CRC_CAN_DSC_NM,
             A.NA_CRC_CAN_DSC NA_CRC_CAN_DSC,                     
             C.CLNTNM CCLNTNM, /*본지사명*/ 
             FN_CM_SIMP_CNM('SPY_TPC',WRS.SPY_TPC) SPY_TPC,
             WRS.SLP_SQNO,
             WRS.NA_WRS_C,                                          
             TRT.PD_YY,
             TRT.INPD_QT,
             WRS.TXT_DSC,
             WRS.BYNG_UPR,
             FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * WRS.BYNG_QT BYNG_QT,
             WRS.BYNG_WT,                     
             A.NA_DVY_PLASH_SLPNO
             			
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			
			,A.CNR_DT
			,SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO  TRSLPNO
			,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/

			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.BYAM),0) AS BYAM /*공급금액 A*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN(WRS.BYNG_VAT),0) AS BYNG_VAT /*부가세 B*/
			
			,NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
		      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)      
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)
		      +((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        ))
		        -
		       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		        )     
		      +((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
		      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
		      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
		      ) CHRG_TOT /*총공제금액 D=P~Y*/
			
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C = '911' THEN WRS.BYAM END ),0) AS VCBT_AM /*공병금액 E*/
			,FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC) * NVL(MIN( CASE WHEN WRS.NA_LLED_C IN ( '912','913' ) THEN WRS.BYAM END ),0) AS VCBX_AM /*공상자금액 F*/

			
			, A.NA_TR_DSC NA_TR_DSC
			, DECODE(A.NA_TR_DSC,'IB01','매출','IB03','매출','IB04','매출','','',NULL,'','반품') NA_TR_DSC_NM                     
						
			, TC.SIMP_CNM AS ROTS_CTR_DSC
			, A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			
			<!-- ,NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC) AS MNGT_NA_TRPL_C /*실매입처(농협)*/  배송지거래처코드가 없을땐 경제통합사업장코드로 -->
			
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)
	      +(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0))
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)
	      +NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) COMP_FEE /* O 업체수수료      */
				
			, NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0) AS BYNG_SSDY        /* P 매입장려금       */
						
			, (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))-(NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)) ETR_AMN_FEE      /* Q 수탁관리수수료   관리수수료(R2)*/
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)  ETR_AMN_VAT      /* R 수탁관리부가세   */
						
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)  SLGT_AMN_FEE     /* S 매취관리수수료   관리수수료(R1) */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0) AS PHD_FEE /* 물류수수료       */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  PHD_FEE_VAT      /* 물류수수료부가세 */
			
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)-NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVC_CST      /* 운송용역비용     */
			, NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)  TRP_SVCOS_VAT    /* 운송용역비부가세 */
				   		 
			, ((NVL(SUM(D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        ((NVL(SUM( CASE WHEN D.NA_FEE_C IN ('105','398','384') OR SUBSTR(D.NA_FEE_C,1,2) IN ('46') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.spy_am*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  else 0 end ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('36') OR (D.na_fee_c = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC <![CDATA[<>]]> '001') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)  ELSE 0 END ),0))+
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.SPY_AM*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ))
	        -
	       ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	        (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	        NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	        ) 
	        AS ETC_FEE  /* 기타수수료       */
	        
	      , ((NVL(SUM(D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC)),0)) -
	      (NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C = '393' and F.BZPL_TPC = '504' AND F.BZPL_DTI_TPC = '001' then D.txt_vat*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) else 0 end ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND SUBSTR(D.NA_FEE_C,1,2) IN ('26') OR D.na_fee_c in ('101') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0)+
	      NVL(SUM( CASE WHEN D.SLP_SQNO != 0 AND D.NA_FEE_C IN ('111','321','396') THEN D.TXT_VAT*FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) ELSE 0 END ),0))
	      ) AS ETC_FEE_VAT /* 기타수수료 부가세      */
			
			,A.ADJ_NA_BZPLC
			,A.ADJ_NA_TRPL_C			
			,NVL(MIN(A.DVYAA_NA_TRPL_C     ),A.NA_BZPLC)    DVYAA_NA_TRPL_C
			,A.EDIRG_DTM /*배달일시*/
			,A.FS_RMS_DT /*수신일시*/
			, SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * D.SPY_AM) SPY_AM
			, SUM(FN_CNR_DS_AM(A.NA_TR_DSC,A.NA_CRC_CAN_DSC) * D.TXT_VAT) TXT_VAT
		FROM 
			TB_BY_BYNG_M A
			, TB_BY_BYNG_WRS WRS
			, TB_CM_SIMPC TC
			, TB_TR_TRPL_CIF B
			, TB_TR_TRPL_CIF C
			, TB_CM_BZPL F						
			, TB_OD_TRTWRS TRT
			, TB_BY_BYNG_FEE D
		WHERE 1=1
			AND WRS.NA_BZPLC = TRT.NA_BZPLC
			AND WRS.NA_WRS_C = TRT.NA_WRS_C
			AND NVL(WRS.DEL_YN, 0) = '0'  /* 삭제여부 (1: 여, 0: 부) */
			
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)
			AND (D.SPY_AM <![CDATA[>]]> 0 OR D.TXT_VAT <![CDATA[>]]> 0 OR D.NA_BZPLC IS NULL)
						
			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">					
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">					
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="WRS_CODE != null and WRS_CODE.length() >  0 and WRS_CODE != 'all'.toString()">
					AND WRS.NA_WRS_C = #{WRS_CODE}
				</if>
		GROUP BY
			A.NA_BZPLC
			, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
			, C.CLNTNM
			, A.NA_DVY_PLASH_SLPNO
			, A.CNR_DT
			, SUBSTR(A.SLP_DT,1,4)||'-'||SUBSTR(A.SLP_DT,5,2)||'-'|| SUBSTR(A.SLP_DT,7,2)||'-'||A.NA_SLPNO
			, WRS.RPY_PLA_DT
			, FN_CNR_DS_AM(WRS.NA_TR_DSC,WRS.NA_CRC_CAN_DSC)
			, A.NA_TR_DSC
			, A.BUYPL_NA_TRPL_C
			, NVL(A.DVYAA_NA_TRPL_C,A.NA_BZPLC)
			, A.ADJ_NA_BZPLC
			, A.ADJ_NA_TRPL_C
			, A.EDIRG_DTM
			, A.FS_RMS_DT
			, A.NA_BZPLC
			, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
			, WRS.SLP_SQNO
			, WRS.SPY_TPC
			, TC.SIMP_CNM
			, WRS.NA_WRS_C
			, A.NA_CRC_CAN_DSC
			, TRT.PD_YY
			, TRT.INPD_QT
			, WRS.TXT_DSC
			, WRS.BYNG_UPR
			, WRS.BYNG_QT
			, WRS.BYNG_WT
	)
	SELECT		
		SUM(A.BYNG_QT) BYNG_QT /*매입수량*/
		, SUM(A.BYAM-A.BYNG_VAT) GAM_AM /*공급금액*/ 
		, SUM(A.BYNG_VAT) BYNG_VAT /*매입부가세*/
		, SUM(A.BYAM) BYAM /*매입금액*/		
		, SUM(A.SPY_AM - A.TXT_VAT) SPY_AM
		, SUM(A.TXT_VAT) TXT_VAT
	FROM
		temp_tab A 
		, TB_TR_TRPL_CIF B 
		, TB_OD_DLVPNSHT_M Y
		, TB_GD_WRS C
	WHERE 1=1
		AND A.NA_WRS_C = C.NA_WRS_C
		<if test="MNGT_NA_TRPL_C != null and MNGT_NA_TRPL_C.length() >  0 and MNGT_NA_TRPL_C != 'all'.toString()">
			AND A.MNGT_NA_TRPL_C = #{MNGT_NA_TRPL_C}
		</if>
		AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C 
		AND A.ACTL_BUYPL_NA_TRPL_C = Y.SPYPL_NA_TRPL_C (+) 
		AND A.MNGT_NA_TRPL_C = Y.DVYAA_NA_TRPL_C (+) 
		AND A.NA_DVY_PLASH_SLPNO = Y.NA_DVY_PLASH_SLPNO (+)
		AND Y.DVY_PLA_DT(+) BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-180,'YYYYMMDD') AND #{TO_DATE}
	ORDER BY A.ACTL_BUYPL_NA_TRPL_C
	</select>
	
	<sql id="sql_recadvResult">
		SELECT
			A.NA_BZPLC                   /* 경제통합사업장코드           */
			, A.NA_TEAM_C                  /* 경제통합팀코드               */
			, A.SLP_DT                     /* 전표일자                     */
			, A.NA_SLPNO                   /* 경제통합전표번호             */
			, ' ' AS WHSE_C                     /* 창고코드                     */
			, A.NA_TR_DSC                  /* 경제통합거래구분코드         */
			, A.CNR_DT                     /* 검수일자                     */
			, A.LED_RFL_DT                 /* 원장반영일자                 */
			, A.ADJ_NA_BZPLC               /* 정산경제통합사업장코드       */
			, A.ADJ_BZPL_NA_TEAM_C         /* 정산사업장경제통합팀코드     */
			, A.BUYPL_NA_TRPL_C            /* 매입처경제통합거래처코드     */
			, A.BUYPL_NA_TEAM_C            /* 매입처경제통합팀코드         */
			, A.ADJ_NA_TRPL_C              /* 정산경제통합거래처코드       */
			, A.ADJ_NA_TEAM_C              /* 정산경제통합팀코드           */
			, A.ACTL_BUYPL_NA_TRPL_C       /* 실제매입처경제통합거래처코드 */
			, A.ACTL_BUYPL_NA_TEAM_C       /* 실제매입처경제통합팀코드     */
			, A.DDLY_BUYPL_NA_TRPL_C       /* 직송매입처경제통합거래처코드 */
			, A.DDLY_BUYPL_NA_TEAM_C       /* 직송매입처경제통합팀코드     */
			, ' ' AS SOGMN_NA_TRPL_C            /* 출하자경제통합거래처코드     */
			, ' ' AS SOGMN_NA_TEAM_C            /* 출하자경제통합팀코드         */
			, ' ' AS SOG_SLPL_NA_TRPL_C         /* 출하매출처경제통합거래처코드 */
			, ' ' AS SOG_SLPL_NA_TEAM_C         /* 출하매출처경제통합팀코드     */
			, A.NA_BLB_DFC_DSC             /* 경제통합흑자적자구분코드     */
			, A.BYAM                       /* 매입금액                     */
			, A.BYNG_VAT                   /* 매입부가세                   */
			, 0 SEL_PLA_AM                 /* 판매예정금액                 */
			, SUM(DECODE(B.TXT_DSC||B.LIQ_YN, '10',
			            DECODE(A.NA_BLB_DFC_DSC,'+',1,'-',-1)*(B.BYAM), 0))                     
			- SUM(DECODE(B.TXT_DSC||B.LIQ_YN, '10',
			            DECODE(A.NA_BLB_DFC_DSC,'+',1,'-',-1)*(B.BYNG_VAT), 0)) TXT_SPY_AM /* 과세공급금액                 */
			,SUM(DECODE(B.TXT_DSC||B.LIQ_YN, '10',
			            DECODE(A.NA_BLB_DFC_DSC,'+',1,'-',-1)*(B.BYNG_VAT), 0)) VAT_SPY_AM /* 부가세공급금액               */
			,SUM(DECODE(B.TXT_DSC, '2',
			            DECODE(A.NA_BLB_DFC_DSC,'+',1,'-',-1)*(B.BYAM), 0)) EXTX_SPY_AM /* 면세공급금액                 */
			,SUM(DECODE(B.TXT_DSC, '3',
			            DECODE(A.NA_BLB_DFC_DSC,'+',1,'-',-1)*(B.BYAM), 0)) SMA_SPY_AM /* 영세공급금액                 */
			,SUM(DECODE(B.LIQ_YN, ' ',
			            DECODE(A.NA_BLB_DFC_DSC,'+',1,'-',-1)*(B.BYAM), 0)) 
			- SUM(DECODE(B.LIQ_YN, ' ',
			            DECODE(A.NA_BLB_DFC_DSC,'+',1,'-',-1)*(B.BYNG_VAT), 0)) LIQ_TXT_SPY_AM /* 주류과세공급금액             */
			,SUM(DECODE(B.LIQ_YN, ' ',
			            DECODE(A.NA_BLB_DFC_DSC,'+',1,'-',-1)*(B.BYNG_VAT), 0)) LIQ_VAT_SPY_AM /* 주류부가세공급금액 */
			, ' ' AS VCBT_AM                    /* 공병금액                     */
			, A.VCBX_AM                    /* 공상자금액                   */
			, A.BYNG_SSDY                  /* 매입장려금                   */
			, A.NA_STL_TP_DSC              /* 경제통합결제유형구분코드     */
			, ' ' AS CBAM                       /* 외상매입금                   */
			, ' ' AS CSH_PY_AM                  /* 현금지급금액                 */
			, ' ' AS PPY_BYAM                   /* 선급매입금액                 */
			, A.RPY_PLA_DT                 /* 상환예정일자                 */
			, ' ' AS RPY_PLA_DT                 /* 상환예정일자                 */
			, ' ' AS DSTR_TR_LCLC               /* 유통거래대분류코드           */
			, ' ' AS BYNG_SLP_DSC               /* 매입전표구분코드             */
			, ' ' AS BYNG_REF_DSC               /* 매입참조구분코드             */
			, A.NA_DVY_PLASH_SLPNO         /* 경제통합배송예정서전표번호   */
			, ' ' AS TR_BASS_NO                 /* 거래근거번호                 */
			, A.OSLIP_DT                   /* 원전표일자                   */
			, A.OSLIP_NA_SLPNO             /* 원전표경제통합전표번호       */
			, ' ' AS PATN_SLPL_SLP_DT           /* 상대매출처전표일자           */
			, ' ' AS PATN_SLPL_NA_SLPNO         /* 상대매출처경제통합전표번호   */
			, ' ' AS RGD_PR_PRC_DSC             /* 반품가격처리구분코드         */
			, A.DDLY_YN                    /* 직송여부                     */
			, A.BZ_METH_DSC                /* 사업방식구분코드             */
			, ' ' AS NAAC_DSC                   /* 중앙회조합구분코드           */
			, ' ' AS INO_DSC                    /* 내외부구분코드               */
			, ' ' AS BYNG_INP_TRM_DSC           /* 매입입력단말기구분코드       */
			, A.ROTS_CTR_DSC               /* 계통계약구분코드             */
			, ' ' AS NA_TR_OCU_DSC              /* 경제통합거래발생구분코드     */
			, ' ' AS STVCS_OCU_YN               /* 하역비발생여부               */
			, ' ' AS PVRPD_YN                   /* 사입품여부                   */
			, ' ' AS LBDY_BFC_DSC               /* 생체지육구분코드             */
			, ' ' AS BFC_CSTT_DSC               /* 지육구성구분코드             */
			, ' ' AS BFC_HDCN                   /* 지육두수                     */
			, ' ' AS LBDY_WT                    /* 생체중량                     */
			, ' ' AS BFC_WT                     /* 지육중량                     */
			, ' ' AS BFC_DMT_TOT_WT             /* 지육해체총중량               */
			, ' ' AS ACTL_WT                    /* 실제중량                     */
			, ' ' AS BFC_AM                     /* 지육금액                     */
			, A.NA_CRC_CAN_DSC             /* 경제통합정정취소구분코드     */
			, ' ' AS RMK_CNTN                   /* 비고내용                     */
			, ' ' AS TRPRC_SQNO                 /* 거래처리일련번호             */
			, ' ' AS RTL_DSTR_CV_SYS_DSC        /* 소매유통전환시스템구분코드   */
			, A.DEL_YN                     /* 삭제여부                     */
			, A.FSRGMN_ENO                 /* 최초등록자개인번호           */
			, TO_CHAR(A.FSRG_DTM,'YYYY-MM-DD HH24:MI:SS') AS FSRG_DTM                      /* 최초등록일시                 */
			, A.LS_CMENO                                                       /* 최종변경자개인번호           */
			, TO_CHAR(A.LSCHG_DTM,'YYYY-MM-DD HH24:MI:SS') AS LSCHG_DTM                     /* 최종변경일시                 */
			, A.DLMN_ENO                                                       /* 삭제자개인번호               */
			, TO_CHAR(A.DEL_DTM,'YYYY-MM-DD HH24:MI:SS') AS DEL_DTM                       /* 삭제일시                     */
			, ( CASE WHEN A.NA_BLB_DFC_DSC = '+' THEN  1
			WHEN A.NA_BLB_DFC_DSC = '-' THEN -1 END ) CNR_DS_AM
			, ' ' AS TR_DS_ABR_NM                               /* 거래구분약어명         */
			, FN_CM_SIMP_CNM('NA_STL_TP_DSC',A.NA_STL_TP_DSC) NA_STL_TP_DSC_NM /* 경제통합결제유형구분코드     */
			, ' ' AS DSTR_TR_LCLC_NM /* 유통거래대분류코드             */
			, ' ' AS BYNG_SLP_DSC_NM /* 매입전표구분코드               */
			, ' ' AS BYNG_REF_DSC_NM /* 매입참조구분코드               */
			, ' ' AS RGD_PR_PRC_DSC_NM  /* 반품가격처리구분코드           */
			, FN_CM_SIMP_CNM('BZ_METH_DSC',A.BZ_METH_DSC) BZ_METH_DSC_NM /* 반품가격처리구분코드           */
			, ' ' AS NAAC_DSC_NM /* 중앙회조합구분코드             */
			, ' ' AS INO_DSC_NM /* 내외부구분코드                 */
			, ' ' AS BYNG_INP_TRM_DSC_NM /* 매입입력단말기구분코드         */
			, FN_CM_SIMP_CNM('ROTS_CTR_DSC',A.ROTS_CTR_DSC) ROTS_CTR_DSC_NM /* 계통계약구분코드               */
			, ' ' AS NA_TR_OCU_DSC_NM /* 경제통합거래발생구분코드       */
			, ' ' AS LBDY_BFC_DSC_NM /* 생체지육구분코드               */
			, ' ' AS BFC_CSTT_DSC_NM /* 지육구성구분코드               */
			, FN_CM_SIMP_CNM('NA_CRC_CAN_DSC',A.NA_CRC_CAN_DSC) NA_CRC_CAN_DSC_NM /* 경제통합정정취소구분코드       */
			, ' ' AS RTL_DSTR_CV_SYS_DSC_NM /* 소매유통전환시스템구분코드     */
			, ' ' AS DATA_TMS_YN	                                                     /* 95자료전송여부                     */
			, ' ' AS PATN_NA_TR_DSC	                                                 /* 95상대경제통합거래구분코드         */
			, ' ' AS CSER_TR_REL_AMNNO                                                /* 95수요자거래관계관리번호           */
			, ' ' AS MNGT_TR_REL_AMNNO                                                /* 95주관거래관계관리번호             */
			, A.DVYAA_NA_TRPL_C	                                                 /* 95배송지경제통합거래처코드         */
			, A.DVYAA_NA_TEAM_C	                                                 /* 95배송지경제통합팀코드             */
			, ' ' AS TRF_REF_DSC	                                                     /* 950.이관요청 1.이관확정 2.이관취소 */
			, FN_TRPL_CIF_NM(A.DVYAA_NA_TRPL_C) DVYAA_NA_TRPL_C_NM /* 배송지경제통합거래처코드  */
			, FN_CM_TEAM_NM(A.DVYAA_NA_TRPL_C, A.DVYAA_NA_TEAM_C) /* 배송지경제통합팀코드      */
			, SUM( CASE WHEN (B.SLP_SQNO > 1000) THEN B.BYAM ELSE 0 END ) AS BYAM_BOT   /* 공병금액(상세내역 합계)     */
			, SUM( D.SPY_AM ) AS SPY_AM_CST   /* 수수료금액(합계)     */
			, ' ' AS AMOUNT /*배송예정금액*/
			, ' ' AS AMOUNT2 /*매출금액*/
			FROM TB_BY_BYNG_M  A    
			,TB_BY_BYNG_WRS  B
			, TB_BY_BYNG_FEE D
		WHERE A.NA_BZPLC       = B.NA_BZPLC
			AND A.NA_TEAM_C      = B.NA_TEAM_C
			AND A.SLP_DT         = B.SLP_DT
			AND A.NA_SLPNO       = B.NA_SLPNO
			AND B.NA_BZPLC = D.NA_BZPLC(+) 
			AND B.NA_TEAM_C = D.NA_TEAM_C(+) 
			AND B.SLP_DT = D.SLP_DT(+)                      
			AND B.NA_SLPNO = D.NA_SLPNO(+) 
			AND B.SLP_SQNO = D.SLP_SQNO(+)
			AND B.SLP_SQNO	<![CDATA[<]]> 1000
			AND A.DEL_YN         = '0'
			AND A.DEL_DTM        IS NULL			
			AND A.ACTL_BUYPL_NA_TRPL_C IN
        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
    		#{item}
		</foreach>
		<if test="FROM_DATE != null and FROM_DATE.length() >  0 and TO_DATE != null and TO_DATE.length() >  0">
			AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
		</if>
		<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
			AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
		</if>
		<if test="NA_BZPLC != null and NA_BZPLC.length() >  0 and NA_BZPLC != 'all'.toString()">
			AND A.NA_BZPLC = #{NA_BZPLC}
		</if>
		<if test="NA_TEAM_C != null and NA_TEAM_C.length() >  0 and NA_TEAM_C != 'all'.toString()">
			AND A.NA_TEAM_C = #{NA_TEAM_C}
		</if>
		<if test="NA_SLPNO != null and NA_SLPNO.length() >  0">
			AND A.NA_SLPNO = #{NA_SLPNO}
		</if>
		<if test="BUYPL_NA_TRPL_C != null and BUYPL_NA_TRPL_C.length() >  0 and BUYPL_NA_TRPL_C != 'all'.toString()">
			AND A.BUYPL_NA_TRPL_C = #{BUYPL_NA_TRPL_C}
		</if>
		<if test="BUYPL_NA_TEAM_C != null and BUYPL_NA_TEAM_C.length() >  0 and BUYPL_NA_TEAM_C != 'all'.toString()">
			AND A.BUYPL_NA_TEAM_C = #{BUYPL_NA_TEAM_C}
		</if>
		GROUP BY
			A.NA_BZPLC                   /* 경제통합사업장코드           */
			, A.NA_TEAM_C                  /* 경제통합팀코드               */
			, A.SLP_DT                     /* 전표일자                     */
			, A.NA_SLPNO                   /* 경제통합전표번호             */
			, A.NA_TR_DSC                  /* 경제통합거래구분코드         */
			, A.CNR_DT                     /* 검수일자                     */
			, A.LED_RFL_DT                 /* 원장반영일자                 */
			, A.ADJ_NA_BZPLC               /* 정산경제통합사업장코드       */
			, A.ADJ_BZPL_NA_TEAM_C         /* 정산사업장경제통합팀코드     */
			, A.BUYPL_NA_TRPL_C            /* 매입처경제통합거래처코드     */
			, A.BUYPL_NA_TEAM_C            /* 매입처경제통합팀코드         */
			, A.ADJ_NA_TRPL_C              /* 정산경제통합거래처코드       */
			, A.ADJ_NA_TEAM_C              /* 정산경제통합팀코드           */
			, A.ACTL_BUYPL_NA_TRPL_C       /* 실제매입처경제통합거래처코드 */
			, A.ACTL_BUYPL_NA_TEAM_C       /* 실제매입처경제통합팀코드     */
			, A.DDLY_BUYPL_NA_TRPL_C       /* 직송매입처경제통합거래처코드 */
			, A.DDLY_BUYPL_NA_TEAM_C       /* 직송매입처경제통합팀코드     */
			, A.NA_BLB_DFC_DSC             /* 경제통합흑자적자구분코드     */
			, A.BYAM                       /* 매입금액                     */
			, A.BYNG_VAT                   /* 매입부가세                   */
			, A.VCBT_AM                    /* 공병금액                     */
			, A.VCBX_AM                    /* 공상자금액                   */
			, A.BYNG_SSDY                  /* 매입장려금                   */
			, A.NA_STL_TP_DSC              /* 경제통합결제유형구분코드     */
			, A.RPY_PLA_DT                 /* 상환예정일자                 */
			, A.NA_DVY_PLASH_SLPNO         /* 경제통합배송예정서전표번호   */
			, A.OSLIP_DT                   /* 원전표일자                   */
			, A.OSLIP_NA_SLPNO             /* 원전표경제통합전표번호       */
			, A.DDLY_YN                    /* 직송여부                     */
			, A.BZ_METH_DSC                /* 사업방식구분코드             */
			, A.ROTS_CTR_DSC               /* 계통계약구분코드             */
			, A.NA_CRC_CAN_DSC             /* 경제통합정정취소구분코드     */
			, A.DEL_YN                     /* 삭제여부                     */
			, A.FSRGMN_ENO                 /* 최초등록자개인번호           */
			, A.FSRG_DTM
			, A.LS_CMENO                                                       /* 최종변경자개인번호           */
			, A.LSCHG_DTM
			, A.DLMN_ENO                                                       /* 삭제자개인번호               */
			, A.DEL_DTM
			, A.NA_BLB_DFC_DSC
			, A.NA_STL_TP_DSC
			, A.BZ_METH_DSC
			, A.ROTS_CTR_DSC
			, A.NA_CRC_CAN_DSC
			, A.DVYAA_NA_TRPL_C	                                                 /* 95배송지경제통합거래처코드         */
			, A.DVYAA_NA_TEAM_C	                                                 /* 95배송지경제통합팀코드             */
			<!-- 
			, A.WHSE_C                     /* 창고코드                     */
			, A.SOGMN_NA_TRPL_C            /* 출하자경제통합거래처코드     */
			, A.SOGMN_NA_TEAM_C            /* 출하자경제통합팀코드         */
			, A.SOG_SLPL_NA_TRPL_C         /* 출하매출처경제통합거래처코드 */
			, A.SOG_SLPL_NA_TEAM_C         /* 출하매출처경제통합팀코드     */
			, A.TXT_SPY_AM                 /* 과세공급금액                 */
			, A.VAT_SPY_AM                 /* 부가세공급금액               */
			, A.EXTX_SPY_AM                /* 면세공급금액                 */
			, A.SMA_SPY_AM                 /* 영세공급금액                 */
			, A.LIQ_TXT_SPY_AM             /* 주류과세공급금액             */
			, A.LIQ_VAT_SPY_AM             /* 주류부가세공급금액           */
			, A.CBAM                       /* 외상매입금                   */
			, A.CSH_PY_AM                  /* 현금지급금액                 */
			, A.PPY_BYAM                   /* 선급매입금액                 */
			, A.DSTR_TR_LCLC               /* 유통거래대분류코드           */
			, A.BYNG_SLP_DSC               /* 매입전표구분코드             */
			, A.BYNG_REF_DSC               /* 매입참조구분코드             */
			, A.DVY_PLASH_REF_YN           /* 배송예정서참조여부           */
			, A.TR_BASS_NO                 /* 거래근거번호                 */
			, A.PATN_SLPL_SLP_DT           /* 상대매출처전표일자           */
			, A.PATN_SLPL_NA_SLPNO         /* 상대매출처경제통합전표번호   */
			, A.RGD_PR_PRC_DSC             /* 반품가격처리구분코드         */
			, A.NAAC_DSC                   /* 중앙회조합구분코드           */
			, A.INO_DSC                    /* 내외부구분코드               */
			, A.BYNG_INP_TRM_DSC           /* 매입입력단말기구분코드       */
			, A.NA_TR_OCU_DSC              /* 경제통합거래발생구분코드     */
			, A.STVCS_OCU_YN               /* 하역비발생여부               */
			, A.PVRPD_YN                   /* 사입품여부                   */
			, A.LBDY_BFC_DSC               /* 생체지육구분코드             */
			, A.BFC_CSTT_DSC               /* 지육구성구분코드             */
			, A.BFC_HDCN                   /* 지육두수                     */
			, A.LBDY_WT                    /* 생체중량                     */
			, A.BFC_WT                     /* 지육중량                     */
			, A.BFC_DMT_TOT_WT             /* 지육해체총중량               */
			, A.ACTL_WT                    /* 실제중량                     */
			, A.BFC_AM                     /* 지육금액                     */
			, A.RMK_CNTN                   /* 비고내용                     */
			, A.TRPRC_SQNO                 /* 거래처리일련번호             */
			, A.RTL_DSTR_CV_SYS_DSC        /* 소매유통전환시스템구분코드   */
			, B.TR_DS_ABR_NM                               /* 거래구분약어명         */
			, FN_CM_SIMP_CNM('DSTR_TR_LCLC',A.DSTR_TR_LCLC) DSTR_TR_LCLC_NM /* 유통거래대분류코드             */
			, FN_CM_SIMP_CNM('BYNG_SLP_DSC',A.BYNG_SLP_DSC) BYNG_SLP_DSC_NM /* 매입전표구분코드               */
			, FN_CM_SIMP_CNM('BYNG_REF_DSC',A.BYNG_REF_DSC) BYNG_REF_DSC_NM /* 매입참조구분코드               */
			, FN_CM_SIMP_CNM('RGD_PR_PRC_DSC',A.RGD_PR_PRC_DSC) RGD_PR_PRC_DSC_NM  /* 반품가격처리구분코드           */
			, FN_CM_SIMP_CNM('NAAC_DSC',A.NAAC_DSC) NAAC_DSC_NM /* 중앙회조합구분코드             */
			, FN_CM_SIMP_CNM('INO_DSC',A.INO_DSC) INO_DSC_NM /* 내외부구분코드                 */
			, FN_CM_SIMP_CNM('BYNG_INP_TRM_DSC',A.BYNG_INP_TRM_DSC) BYNG_INP_TRM_DSC_NM /* 매입입력단말기구분코드         */
			, FN_CM_SIMP_CNM('NA_TR_OCU_DSC',A.NA_TR_OCU_DSC) NA_TR_OCU_DSC_NM /* 경제통합거래발생구분코드       */
			, FN_CM_SIMP_CNM('LBDY_BFC_DSC',A.LBDY_BFC_DSC) LBDY_BFC_DSC_NM /* 생체지육구분코드               */
			, FN_CM_SIMP_CNM('BFC_CSTT_DSC',A.BFC_CSTT_DSC) BFC_CSTT_DSC_NM /* 지육구성구분코드               */
			, FN_CM_SIMP_CNM('RTL_DSTR_CV_SYS_DSC',A.RTL_DSTR_CV_SYS_DSC) RTL_DSTR_CV_SYS_DSC_NM /* 소매유통전환시스템구분코드     */
			, A.DATA_TMS_YN	                                                     /* 95자료전송여부                     */
			, A.PATN_NA_TR_DSC	                                                 /* 95상대경제통합거래구분코드         */
			, A.CSER_TR_REL_AMNNO                                                /* 95수요자거래관계관리번호           */
			, A.MNGT_TR_REL_AMNNO                                                /* 95주관거래관계관리번호             */
			, A.TRF_REF_DSC	                                                     /* 950.이관요청 1.이관확정 2.이관취소 */
			 -->
		ORDER BY 1,2,3,4
	</sql>
	
	<!-- 매입실적 첫번째 그리드 조회 -->
	<select id="retrieveRecadvResult" parameterType="java.util.Map" resultType="java.util.Map">
		<include refid="sql_recadvResult" />
	</select>
	
	<!-- 매입실적 두번째 그리드 조회 -->
	<select id="retrieveRecadvResultDetail" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			A.NA_BZPLC                /* 경제통합사업장코드       */
			, A.NA_TEAM_C               /* 경제통합팀코드           */
			, A.SLP_DT                  /* 전표일자                 */
			, A.NA_SLPNO                /* 경제통합전표번호         */
			, A.SLP_SQNO                /* 전표일련번호             */
			, A.NA_WRS_C                /* 경제통합상품코드         */
			, '1' AS PD_YY                   /* 생산년도                 */
			, '1' AS LOW_NA_TEAM_C           /* 하위경제통합팀코드       */
			, '1' AS NA_SOGMN_C              /* 경제통합출하자코드       */
			, A.BYNG_QT                 /* 매입수량                 */
			, A.ORR_QT                  /* 주문수량                 */
			, '1' AS MSTR_BYNG_UPR           /* 마스터매입단가           */
			, A.BYNG_UPR                /* 매입단가                 */
			, A.BYAM                    /* 매입금액                 */
			, A.BYNG_VAT                /* 매입부가세               */
			, 0 SEL_PLA_UPR             /* 판매예정단가             */
			, 0 SEL_PLA_AM              /* 판매예정금액             */
			, A.VCBT_AM                 /* 공병금액                 */
			, '1' AS CBAM                    /* 외상매입금               */
			, '1' AS CSH_PY_AM               /* 현금지급금액             */
			, '1' AS PPY_BYAM                /* 선급매입금액             */
			, A.RPY_PLA_DT              /* 상환예정일자             */
			, A.PFT_FEE                 /* 수익수수료               */
			, A.CST_FEE                 /* 비용수수료               */
			, A.ETC_FEE                 /* 기타수수료               */
			, '1' AS STPL_AMN_DSC            /* 재고관리구분코드         */
			, '1' AS STPL_AMN_NA_WRS_C       /* 재고관리경제통합상품코드 */
			, A.NA_WRS_UNT_C            /* 경제통합상품단위코드     */
			, '1' AS INPD_QT                 /* 내품수량                 */
			, A.RGD_RSNC                /* 반품사유코드             */
			, A.NA_LLED_C               /* 경제통합대원장코드       */
			, '1' AS BUYER_ENO               /* 바이어개인번호           */
			, A.LIQ_YN                  /* 주류여부                 */
			, A.TXT_DSC                 /* 과세구분코드             */
			, '1' AS TXADU_DSC               /* 세액공제구분코드         */
			, '1' AS LFIC_DSC                /* 의제구분코드             */
			, '1' AS STCAST_DSC              /* 재고자산구분코드         */
			, A.SPY_TPC                 /* 공급유형코드             */
			, A.WRS_TPC                 /* 상품유형코드             */
			, '1' AS STV_DSC                 /* 하역구분코드             */
			, '1' AS STV_UNTP_UPR            /* 하역단위당단가           */
			, '1' AS STVCS                   /* 하역비                   */
			, A.BYNG_SSDY               /* 매입장려금               */
			, A.BYNG_SSDYRT             /* 매입장려금률             */
			, '1' AS GAP_ATTC_NO             /* GAP인증번호              */
			, '1' AS FRPD_HST_NO             /* 농산물이력번호           */
			, '1' AS INDV_ID_NO              /* 개체식별번호             */
			, '1' AS BFC_BOX_QT              /* 지육박스수량             */
			, '1' AS BFC_WT                  /* 지육중량                 */
			, '1' AS BFC_UPR                 /* 지육단가                 */
			, '1' AS BFC_AM                  /* 지육금액                 */
			, '1' AS BYPD_AM                 /* 부산물금액               */
			, '1' AS RMK_CNTN                /* 비고내용                 */
			, '1' AS DEL_YN                  /* 삭제여부                 */
			, '1' AS DLMN_ENO                /* 삭제자개인번호           */
			, '1' AS DEL_DTM  /* 삭제일시                 */
			, C.WRSNM                                         /* 경제통합상품코드       */
		FROM TB_BY_BYNG_WRS A /*매입_매입상세*/
			, TB_BY_BYNG_M  B /*매입_매입기본*/
			, TB_GD_WRS C 
		WHERE 1=1
			AND A.NA_WRS_C = C.NA_WRS_C
			AND A.NA_BZPLC       = B.NA_BZPLC
			AND A.NA_TEAM_C      = B.NA_TEAM_C
			AND A.SLP_DT         = B.SLP_DT
			AND A.NA_SLPNO       = B.NA_SLPNO
			AND ROWNUM <![CDATA[<]]> 10
		<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
			AND A.NA_BZPLC = #{NA_BZPLC}
		</if>
		<if test="NA_TEAM_C != null and NA_TEAM_C.length() >  0">
			AND A.NA_TEAM_C = #{NA_TEAM_C}
		</if>
		<if test="SLP_DT != null and SLP_DT.length() >  0">
			AND A.SLP_DT = #{SLP_DT}
		</if>
		<if test="NA_SLPNO != null and NA_SLPNO.length() >  0">
			AND A.NA_SLPNO = #{NA_SLPNO}
		</if>
		<if test="BUYPL_NA_TRPL_C != null and BUYPL_NA_TRPL_C.length() >  0">
			AND B.BUYPL_NA_TRPL_C = #{BUYPL_NA_TRPL_C}
		</if>		
	</select>
 	
 	<select id="downloadExcelRecadvSlp_NA_TRPL_C_M_NEW" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		<include refid="sql_recadvSlp_NA_TRPL_C_M" />
	</select>
	
	<!-- 검수실적-상품별 마스터 엑셀 -->
	<select id="downloadExcelRecadvSlpMasterList_WRS_NEW" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		<include refid="sql_recadvSlpMasterList_WRS" />
	</select>
	
	<select id="downloadExcelRecadvSlpDetailList_WRS" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		<include refid="sql_recadvSlpDetailList_WRS" />
	</select>
	
	<select id="downloadExcelRecadvSlpMaster_Join" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		<include refid="sql_recadvSlpMaster" />
	</select>
	
	<!-- 검수실적-직송분 마스터  엑셀 다운로드 -->	
	<select id="downloadExcelRecadvDdlyMaster_Join" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
    	<include refid="sql_recadvDdlyMaster" />
	</select>
	
	<select id="downloadExcelRetrieveRecadvResult" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		<include refid="sql_recadvResult" />
	</select>
	
	<select id="downloadExcelRecadvSlpDetail2List_WRS" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		<include refid="sql_recadvSlpDetail2List_WRS"></include>
	</select>
	
	<select id="downloadExcelRecadvSlpDetail3List_WRS" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		<include refid="sql_recadvSlpDetail3List_WRS"></include>
	</select>
	
	<!-- 검수실적-전표별 전표 상품 수수료 상세  엑셀 다운로드 빌링 -->
	<select id="downloadExcelRecadvSlpCommisionDetailBilling" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		SELECT	/** downloadExcelRecadvSlpCommisionDetailBilling */
		  A.NA_BZPLC ,
  		  A.NA_TEAM_C ,
  		  A.SLP_DT ,
  		  A.NA_SLPNO
		FROM
		(
		SELECT
			A.NA_BZPLC,
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO,
			NVL((CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C,
			A.ACTL_BUYPL_NA_TRPL_C,
			A.NA_DVY_PLASH_SLPNO
		FROM TB_BY_BYNG_M A, TB_BY_BYNG_WRS B, TB_OD_TRTWRS C, TB_GD_WRS D, TB_BY_BYNG_FEE E, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			AND A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_TEAM_C = B.NA_TEAM_C 
			AND A.SLP_DT = B.SLP_DT 
			AND A.NA_SLPNO = B.NA_SLPNO
			AND B.NA_BZPLC = C.NA_BZPLC
			AND B.NA_WRS_C = C.NA_WRS_C
			AND B.NA_WRS_C = D.NA_WRS_C
			AND B.NA_BZPLC = E.NA_BZPLC(+)
			AND B.NA_TEAM_C = E.NA_TEAM_C(+)
			AND B.SLP_DT = E.SLP_DT(+)
			AND B.NA_SLPNO = E.NA_SLPNO(+)
			AND B.SLP_SQNO = E.SLP_SQNO(+)
			AND (E.spy_am > 0 OR E.txt_vat > 0 OR E.na_bzplc IS NULL)			
			
			AND NVL(A.DEL_YN, 0) = '0'  /* 삭제여부 (1: 여, 0: 부) */
			
			AND A.BUYPL_NA_TRPL_C IN
		<foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
    		#{item}
		</foreach>
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
				AND A.slp_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
				AND A.cnr_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
				<!-- 				AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE} -->
				AND B.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				AND A.SLP_DT <![CDATA[>]]> TO_CHAR( TO_DATE(#{FROM_DATE}, 'YYYYMMDD') - 91, 'YYYYMMDD')
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
				<!-- <![CDATA[AND A.na_tr_dsc <> 'ID01']]> -->
			</when>
			<when test="TRADE_TYPE == '1'.toString()">
				AND A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06')
				AND A.na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND A.na_tr_dsc IN ('OB01', 'OB03', 'OB04')
				AND A.na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.na_crc_can_dsc = '1') OR (A.na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND A.na_crc_can_dsc IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.na_crc_can_dsc IN ('2','3')) OR (A.na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND A.na_crc_can_dsc = '1'))
			</when>
		</choose>
		<choose>
			<when test="CNFM_YN == null or CNFM_YN == ''">
			</when>
			<when test="CNFM_YN == '1'.toString()">
				AND A.DOC_NAME IN ('CONADV')
				AND A.FS_RMS_DT IS NULL
			</when>
			<when test="CNFM_YN == '2'.toString()">
				AND A.DOC_NAME IN ('CONRET')
				AND A.FS_RMS_DT IS NULL
			</when>
			<when test="CNFM_YN == '3'.toString()">
				AND A.DOC_NAME IN ('CONRET', 'CONADV')
				AND A.FS_RMS_DT IS NULL
			</when>
		</choose>
		<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
			AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
		</if>		
			<!-- ORDERBY 3, 13, 1 , 2, NA_FEE_C -->
		) A
		, TB_TR_TRPL_CIF B
		, TB_OD_DLVPNSHT_M Y
	WHERE 1=1
		AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C		
		<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
			</if>
		</if>			
		AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
		AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
		AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
		AND Y.DVY_PLA_DT(+) BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-180,'YYYYMMDD') AND #{TO_DATE}
	GROUP BY A.NA_BZPLC , A.NA_TEAM_C, A.SLP_DT, A.NA_SLPNO
	ORDER BY A.NA_BZPLC , A.NA_TEAM_C, A.SLP_DT, A.NA_SLPNO
	<!-- ORDER BY 3, 13, 1 , 2, NA_FEE_C -->
	</select>
	
	<select id="downloadExcelRecadvSlpDetail2ListBilling_WRS" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		with temp_tab as (
		SELECT /*+  USE_NL (A WRS) USE_NL (WRS D)  index(A IDX_BY_BYNG_M_03 ) */
            A.NA_BZPLC,
            A.NA_TEAM_C,
            A.SLP_DT,
            A.NA_SLPNO,
            WRS.NA_WRS_C,
            NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C,
			A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C,
			A.NA_DVY_PLASH_SLPNO			
		FROM 
			TB_BY_BYNG_M A
			, TB_BY_BYNG_WRS WRS
			, TB_CM_SIMPC TC
			, TB_TR_TRPL_CIF B
			, TB_TR_TRPL_CIF C
			, TB_CM_BZPL F						
			, TB_OD_TRTWRS TRT
			, TB_BY_BYNG_FEE D
		WHERE 1=1
			AND WRS.NA_BZPLC = TRT.NA_BZPLC
			AND WRS.NA_WRS_C = TRT.NA_WRS_C
			AND NVL(WRS.DEL_YN, 0) = '0'  /* 삭제여부 (1: 여, 0: 부) */
			
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)
			AND (D.SPY_AM <![CDATA[>]]> 0 OR D.TXT_VAT <![CDATA[>]]> 0 OR D.NA_BZPLC IS NULL)
						
			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">					
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">					
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="WRS_CODE != null and WRS_CODE.length() >  0 and WRS_CODE != 'all'.toString()">
					AND WRS.NA_WRS_C = #{WRS_CODE}
				</if>
		GROUP BY
			WRS.NA_WRS_C
			, A.NA_BZPLC
			, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
			, A.BUYPL_NA_TRPL_C
			, A.NA_DVY_PLASH_SLPNO
	)
	SELECT  /*+  ordered  index(Y XPK_TB_OD_DLVPNSHT_M  ) */
		A.NA_BZPLC /*경제통합사업장코드*/
		, A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
	FROM
		temp_tab A 
		, TB_TR_TRPL_CIF B 
		, TB_OD_DLVPNSHT_M Y
		, TB_GD_WRS C
	WHERE 1=1
		AND A.NA_WRS_C = C.NA_WRS_C
		<if test="MNGT_NA_TRPL_C != null and MNGT_NA_TRPL_C.length() >  0 and MNGT_NA_TRPL_C != 'all'.toString()">
			AND A.MNGT_NA_TRPL_C = #{MNGT_NA_TRPL_C}
		</if>
<!-- 		<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> -->
<!-- 			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> -->
<!-- 				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC} -->
<!-- 			</if> -->
<!-- 		</if> -->
		AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C 
		AND A.ACTL_BUYPL_NA_TRPL_C = Y.SPYPL_NA_TRPL_C (+) 
		AND A.MNGT_NA_TRPL_C = Y.DVYAA_NA_TRPL_C (+) 
		AND A.NA_DVY_PLASH_SLPNO = Y.NA_DVY_PLASH_SLPNO (+)
		AND Y.DVY_PLA_DT(+) BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-180,'YYYYMMDD') AND #{TO_DATE}
		<!-- 
		AND NVL(Y.DVY_PLA_DT, '20191215') BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-94,'YYYYMMDD') AND #{TO_DATE}
		 -->
	GROUP BY
		A.NA_BZPLC
		, A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
	ORDER BY A.NA_BZPLC, A.NA_TEAM_C, A.SLP_DT, A.NA_SLPNO
	</select>
	
	<select id="downloadExcelRecadvSlpDetail3ListBilling_WRS" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		with temp_tab as (
		SELECT /*+  USE_NL (A WRS) USE_NL (WRS D)  index(A IDX_BY_BYNG_M_03 ) */
             A.NA_BZPLC ,
             A.NA_TEAM_C ,
             A.SLP_DT ,
             A.NA_SLPNO ,
			 WRS.NA_WRS_C,
			 NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			 (CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			 WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			 ELSE A.DVYAA_NA_TRPL_C END )
			 WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			 A.NA_BZPLC
			 ELSE
			 (CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			 WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			 ELSE A.DVYAA_NA_TRPL_C END )
			 END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/			
		FROM 
			TB_BY_BYNG_M A
			, TB_BY_BYNG_WRS WRS
			, TB_CM_SIMPC TC
			, TB_TR_TRPL_CIF B
			, TB_TR_TRPL_CIF C
			, TB_CM_BZPL F						
			, TB_OD_TRTWRS TRT
			, TB_BY_BYNG_FEE D
		WHERE 1=1
			AND WRS.NA_BZPLC = TRT.NA_BZPLC
			AND WRS.NA_WRS_C = TRT.NA_WRS_C
			AND NVL(WRS.DEL_YN, 0) = '0'  /* 삭제여부 (1: 여, 0: 부) */
			
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)
			AND (D.SPY_AM <![CDATA[>]]> 0 OR D.TXT_VAT <![CDATA[>]]> 0 OR D.NA_BZPLC IS NULL)
						
			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">					
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">					
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
				<if test="WRS_CODE != null and WRS_CODE.length() >  0 and WRS_CODE != 'all'.toString()">
					AND WRS.NA_WRS_C = #{WRS_CODE}
				</if>
		GROUP BY
			A.NA_BZPLC
			, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
			, WRS.NA_WRS_C
	)
	SELECT  /*+  ordered  index(Y XPK_TB_OD_DLVPNSHT_M  ) */
		A.NA_BZPLC /*경제통합사업장코드*/
		, A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
	FROM
		temp_tab A 
		, TB_TR_TRPL_CIF B 
		, TB_GD_WRS C
	WHERE 1=1
		AND A.NA_WRS_C = C.NA_WRS_C
		<if test="MNGT_NA_TRPL_C != null and MNGT_NA_TRPL_C.length() >  0 and MNGT_NA_TRPL_C != 'all'.toString()">
			AND A.MNGT_NA_TRPL_C = #{MNGT_NA_TRPL_C}
		</if>

		AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C 

	GROUP BY
		A.NA_BZPLC
		, A.NA_TEAM_C
		, A.SLP_DT
		, A.NA_SLPNO
	ORDER BY A.NA_BZPLC, A.NA_TEAM_C, A.SLP_DT, A.NA_SLPNO
	</select>
	
	<select id="downloadExcelRecadvSlpMasterBilling_Join" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		
		SELECT A.NA_BZPLC, 
			   MIN(A.NA_TEAM_C) NA_TEAM_C , 
       		   MIN(A.SLP_DT ) SLP_DT , 
       		   MIN(A.NA_SLPNO) NA_SLPNO 
			FROM (
				SELECT 
				       MIN(A.NA_BZPLC) NA_BZPLC,
				       MIN(A.NA_TEAM_C) NA_TEAM_C,
				       A.TR_DT SLP_DT,
				       A.NA_SLPNO NA_SLPNO,
				       A.NA_DVY_PLASH_SLPNO, 							<!-- 배송예정서번호  -->  
				       MIN(A.NA_TRPL_C) ACTL_BUYPL_NA_TRPL_C, 					<!-- 본/지사코드  -->  
				       MIN(A.ACTL_BUYPL_NA_TRPL_C) MNGT_NA_TRPL_C   			<!-- 실매입처(농협)  --> 
				  FROM TB_DP_CM_SLP_CNR_RZS A
				 WHERE A.NA_TRPL_C IN 
				 		<foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
					    #{item}
						</foreach>
				       <choose>
							<when test="SEARCH_DATE_TYPE == '1'.toString()">
								AND A.TR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
							</when>
							<when test="SEARCH_DATE_TYPE == '2'.toString()">
								AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
							</when>
							<when test="SEARCH_DATE_TYPE == '3'.toString()">
								AND A.PY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
							</when>
						</choose>
						<choose>
								<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
									<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
								</when>
								<when test="TRADE_TYPE == '1'.toString()">
									AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
									AND A.NA_CRC_CAN_DSC = '1'
								</when>
								<when test="TRADE_TYPE == '2'.toString()">
									AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
									AND A.NA_CRC_CAN_DSC = '1'
								</when>
								<when test="TRADE_TYPE == '3'.toString()">
									AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
								</when>
								<when test="TRADE_TYPE == '4'.toString()">
									AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
								</when>
							</choose>
							<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
									AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
							</if>
				  GROUP BY 
				        A.NA_DVY_PLASH_SLPNO, 
				        A.ACTL_BUYPL_NA_TRPL_C, 
				        A.TR_DT,
				        A.NA_SLPNO,
				       A.NA_CRC_CAN_DSC
	       ) A
	       , TB_OD_DLVPNSHT_M B
	        WHERE A.NA_DVY_PLASH_SLPNO = B.NA_DVY_PLASH_SLPNO(+) 
	        AND A.ACTL_BUYPL_NA_TRPL_C = B.SPYPL_NA_TRPL_C(+) 
	        AND A.MNGT_NA_TRPL_C = B.DVYAA_NA_TRPL_C(+)
	        <if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
			</if>
		  	</if>
		  	AND B.DVY_PLA_DT(+) BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-180,'YYYYMMDD') AND #{TO_DATE}
	        GROUP BY
			A.NA_BZPLC
			, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
		ORDER BY A.NA_BZPLC, A.NA_TEAM_C, A.SLP_DT, A.NA_SLPNO
	</select>
	
	<!-- 검수실적-전표별 디테일  엑셀 다운로드  빌링-->
	<select id="downloadExcelRecadvSlpDetailBilling" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
		SELECT GRDM.NA_BZPLC, GRDM.NA_TEAM_C, GRDM.SLP_DT, GRDM.NA_SLPNO
		FROM
		(SELECT 
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.RPY_PLA_DT
	FROM (
	
		SELECT
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			, NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			,A.NA_DVY_PLASH_SLPNO
      		,MIN(WRS.RPY_PLA_DT) RPY_PLA_DT /*지급예정일*/
		FROM TB_BY_BYNG_M A,TB_BY_BYNG_WRS WRS, TB_TR_TRPL_CIF B, TB_TR_TRPL_CIF C, TB_BY_BYNG_FEE D, TB_CM_SIMPC TC, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
		    AND TC.SIMP_TPC='ROTS_CTR_DSC'
    		AND TC.SIMP_C = A.ROTS_CTR_DSC
			AND A.DVYAA_NA_TRPL_C = B.NA_TRPL_C(+)
			AND A.BUYPL_NA_TRPL_C = C.NA_TRPL_C(+)
			
			AND A.NA_BZPLC = WRS.NA_BZPLC 
            AND A.NA_TEAM_C = WRS.NA_TEAM_C 
            AND A.SLP_DT = WRS.SLP_DT 
            AND A.NA_SLPNO = WRS.NA_SLPNO
            
            AND WRS.NA_BZPLC = D.NA_BZPLC(+) 
            AND WRS.NA_TEAM_C = D.NA_TEAM_C(+) 
            AND WRS.SLP_DT = D.SLP_DT(+)                      
            AND WRS.NA_SLPNO = D.NA_SLPNO(+) 
            AND WRS.SLP_SQNO = D.SLP_SQNO(+)

			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			
			AND A.BUYPL_NA_TRPL_C IN
	        <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
	    		#{item}
			</foreach>
			<choose>
				<when test="SEARCH_DATE_TYPE == '1'.toString()">
					AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '2'.toString()">
					AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
				<when test="SEARCH_DATE_TYPE == '3'.toString()">
					AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
					AND WRS.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				</when>
			</choose>
			<choose>
				<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
					<![CDATA[AND A.NA_TR_DSC <> 'ID01']]>
				</when>
				<when test="TRADE_TYPE == '1'.toString()">
					AND A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '2'.toString()">
					AND A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
					AND A.NA_CRC_CAN_DSC = '1'
				</when>
				<when test="TRADE_TYPE == '3'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC IN ('2','3')))
				</when>
				<when test="TRADE_TYPE == '4'.toString()">
					AND ((A.NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND A.NA_CRC_CAN_DSC = '1'))
				</when>
			</choose>
				<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
					AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
				</if>
		GROUP BY
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.BUYPL_NA_TRPL_C /*본지사코드*/
			,A.NA_DVY_PLASH_SLPNO
      ,WRS.RPY_PLA_DT		
	) A
	, TB_TR_TRPL_CIF B
	, TB_OD_DLVPNSHT_M Y              
WHERE 1=1
AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
	GROUP BY
		A.NA_BZPLC,
		A.NA_TEAM_C,
		A.SLP_DT,
		A.NA_SLPNO,
		A.RPY_PLA_DT
		) GRDM,
		(SELECT
			A.NA_BZPLC
			,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.SLP_SQNO
      		,A.RPY_PLA_DT
		FROM TB_BY_BYNG_WRS A, TB_OD_TRTWRS B, TB_GD_WRS C 
		WHERE A.NA_BZPLC = B.NA_BZPLC
		AND A.NA_WRS_C = B.NA_WRS_C
		AND A.NA_WRS_C = C.NA_WRS_C
		AND NVL(A.DEL_YN, 0) = 0  /* 삭제여부 (1: 여, 0: 부) */
		) GRDD,
		(SELECT /*+ no_push_pred(b) */
			A.NA_BZPLC,
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO,
			A.SLP_SQNO
		FROM TB_BY_BYNG_FEE A, TB_BY_BYNG_WRS B
		WHERE 1=1
			AND B.NA_BZPLC = A.NA_BZPLC(+) 
			AND B.NA_TEAM_C = A.NA_TEAM_C(+) 
			AND B.SLP_DT = A.SLP_DT(+) 
			AND B.NA_SLPNO = A.NA_SLPNO(+) 
			AND B.SLP_SQNO = A.SLP_SQNO(+) 
			AND (SPY_AM > 0 OR TXT_VAT > 0)
		) GRDS
		WHERE 1=1
			AND GRDM.NA_BZPLC = GRDD.NA_BZPLC
			AND GRDM.NA_TEAM_C = GRDD.NA_TEAM_C
			AND GRDM.SLP_DT = GRDD.SLP_DT
			AND GRDM.NA_SLPNO = GRDD.NA_SLPNO
			AND GRDM.RPY_PLA_DT = GRDD.RPY_PLA_DT
			AND GRDD.NA_BZPLC = GRDS.NA_BZPLC(+)
			AND GRDD.NA_TEAM_C = GRDS.NA_TEAM_C(+)		
			AND GRDD.SLP_DT = GRDS.SLP_DT(+)
			AND GRDD.NA_SLPNO = GRDS.NA_SLPNO(+)
			AND GRDD.SLP_SQNO = GRDS.SLP_SQNO(+)
			<if test="NA_BZPLC != null and NA_BZPLC.length() > 0">
			AND GRDD.NA_BZPLC = #{NA_BZPLC}
			</if>
			<if test="NA_TEAM_C != null and NA_TEAM_C.length() >  0">
				AND GRDD.NA_TEAM_C = #{NA_TEAM_C}
			</if>
			<if test="SLP_DT != null and SLP_DT.length() > 0">
				AND GRDD.SLP_DT = #{SLP_DT}
			</if>
			<if test="NA_SLPNO != null and NA_SLPNO.length() > 0">
				AND GRDD.NA_SLPNO = #{NA_SLPNO}
			</if>
			<if test="RPY_PLA_DT != null and RPY_PLA_DT.length() > 0">
				AND GRDD.RPY_PLA_DT = #{RPY_PLA_DT}
			</if>	
		GROUP BY GRDM.NA_BZPLC, GRDM.NA_TEAM_C, GRDM.SLP_DT, GRDM.NA_SLPNO
		ORDER BY GRDM.NA_BZPLC, GRDM.NA_TEAM_C, GRDM.SLP_DT, GRDM.NA_SLPNO
	</select>
	
	<!-- 검수실적-전표별 전표 상품 수수료 합계  엑셀 다운로드 빌링-->
	<select id="downloadExcelRecadvSlpCommisionSumBilling" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
	SELECT /** 검수실적-전표별 전표 상품 수수료 합계  엑셀 다운로드 빌링(downloadExcelRecadvSlpCommisionSumBilling) */
		A.NA_BZPLC
     	, A.NA_TEAM_C
     	, A.SLP_DT
     	, A.NA_SLPNO
		FROM
		(SELECT		
			A.NA_BZPLC,
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO, 
			NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본/지사코드*/
      		,A.NA_DVY_PLASH_SLPNO /*배송예정서번호*/
		FROM TB_BY_BYNG_M A, TB_BY_BYNG_WRS B, TB_OD_TRTWRS C, TB_GD_WRS D, TB_BY_BYNG_FEE E, TB_CM_BZPL F
		WHERE 1=1
			AND A.NA_BZPLC            = F.NA_BZPLC
			<!-- AND A.DDLY_YN = '0' /* 직송여부 1: 여 , 0: 부 */ -->
			AND A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_TEAM_C = B.NA_TEAM_C
			AND A.SLP_DT = B.SLP_DT 
			AND A.NA_SLPNO = B.NA_SLPNO
			AND B.NA_BZPLC = C.NA_BZPLC
			AND B.NA_WRS_C = C.NA_WRS_C
			AND B.NA_WRS_C = D.NA_WRS_C
			AND B.NA_BZPLC = E.NA_BZPLC(+)
			AND B.NA_TEAM_C = E.NA_TEAM_C(+)
			AND B.SLP_DT = E.SLP_DT(+)
			AND B.NA_SLPNO = E.NA_SLPNO(+)
			AND B.SLP_SQNO = E.SLP_SQNO(+)
			AND (E.spy_am > 0 OR E.txt_vat > 0 OR E.na_bzplc IS NULL)	
			
			AND NVL(A.DEL_YN, 0) = '0'  /* 삭제여부 (1: 여, 0: 부) */
			
			AND A.BUYPL_NA_TRPL_C IN
		<foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
    		#{item}
		</foreach>
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
				AND A.SLP_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
				AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">
				<!-- 				AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE} -->
				AND B.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
				AND A.SLP_DT <![CDATA[>]]> TO_CHAR( TO_DATE(#{FROM_DATE}, 'YYYYMMDD') - 91, 'YYYYMMDD')
			</when>
		</choose>
		<choose>
			<when test="TRADE_TYPE == null or TRADE_TYPE == ''">
				<!-- <![CDATA[AND A.na_tr_dsc <> 'ID01']]> -->
			</when>
			<when test="TRADE_TYPE == '1'.toString()">
				AND A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06')
				AND A.na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND A.na_tr_dsc IN ('OB01', 'OB03', 'OB04')
				AND A.na_crc_can_dsc = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.na_crc_can_dsc = '1') OR (A.na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND A.na_crc_can_dsc IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((A.na_tr_dsc IN ('IB01', 'IB03', 'IB04', 'IB06') AND A.na_crc_can_dsc IN ('2','3')) OR (A.na_tr_dsc IN ('OB01', 'OB03', 'OB04') AND A.na_crc_can_dsc = '1'))
			</when>
		</choose>
		<choose>
			<when test="CNFM_YN == null or CNFM_YN == ''">
			</when>
			<when test="CNFM_YN == '1'.toString()">
				AND A.DOC_NAME IN ('CONADV')
				AND A.FS_RMS_DT IS NULL
			</when>
			<when test="CNFM_YN == '2'.toString()">
				AND A.DOC_NAME IN ('CONRET')
				AND A.FS_RMS_DT IS NULL
			</when>
			<when test="CNFM_YN == '3'.toString()">
				AND A.DOC_NAME IN ('CONRET', 'CONADV')
				AND A.FS_RMS_DT IS NULL
			</when>
		</choose>			
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>		
		GROUP BY
			A.NA_BZPLC
      		, A.NA_TEAM_C
			, A.SLP_DT
			, A.NA_SLPNO
      		,A.BUYPL_NA_TRPL_C
      		,A.NA_DVY_PLASH_SLPNO
		) A
	, TB_TR_TRPL_CIF B
	, TB_OD_DLVPNSHT_M Y
	WHERE 1=1
	AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
	<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()">
		<if test="NA_BZPLC != null and NA_BZPLC.length() >  0">
			AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}
		</if>
	</if>
	AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
	AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
	AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)
	AND Y.DVY_PLA_DT(+) BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-180,'YYYYMMDD') AND #{TO_DATE}
	GROUP BY A.NA_BZPLC, A.NA_TEAM_C, A.SLP_DT, A.NA_SLPNO
	ORDER BY A.NA_BZPLC, A.NA_TEAM_C, A.SLP_DT, A.NA_SLPNO
	</select>
	
	<!-- 검수실적-직송분 마스터  엑셀 다운로드 -->	
	<select id="downloadExcelRecadvDdlyMasterBilling_Join" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
    	SELECT        
          A.NA_BZPLC,
          MIN(A.NA_TEAM_C) NA_TEAM_C,
          MIN(A.SLP_DT) SLP_DT,
          MIN(A.NA_SLPNO) NA_SLPNO
        FROM 
              (SELECT MIN(A.NA_BZPLC) NA_BZPLC, 
                     MIN(A.NA_TEAM_C) NA_TEAM_C, 
                     A.TR_DT SLP_DT, 
                     A.NA_SLPNO NA_SLPNO, 
                     A.NA_DVY_PLASH_SLPNO,
                     MIN(A.NA_TRPL_C) ACTL_BUYPL_NA_TRPL_C, 
                     MIN(A.ACTL_BUYPL_NA_TRPL_C) MNGT_NA_TRPL_C
                FROM TB_DP_CM_SLP_CNR_RZS A
               WHERE A.NA_TRPL_C IN 
               		<foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
					   	#{item}
					</foreach>		
					<choose>
						<when test="SEARCH_DATE_TYPE == '1'.toString()">
						    AND A.TR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
						<when test="SEARCH_DATE_TYPE == '2'.toString()">
						    AND A.CNR_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
						<when test="SEARCH_DATE_TYPE == '3'.toString()">
						    AND A.PY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
						</when>
					</choose>
					<choose>
						<when test="TRADE_TYPE == '1'.toString()">
							AND A.NA_TR_DSC = 'IB01'
							AND A.NA_CRC_CAN_DSC = '1'
						</when>
						<when test="TRADE_TYPE == '2'.toString()">
							AND A.NA_TR_DSC = 'OB01'
							AND A.NA_CRC_CAN_DSC = '1'
						</when>
						<when test="TRADE_TYPE == '3'.toString()">
							AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC = '1') OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC IN ('2','3')))
						</when>
						<when test="TRADE_TYPE == '4'.toString()">
							AND ((A.NA_TR_DSC = 'IB01' AND A.NA_CRC_CAN_DSC IN ('2','3')) OR (A.NA_TR_DSC = 'OB01' AND A.NA_CRC_CAN_DSC = '1'))
						</when>
					</choose>		
					<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
						AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
					</if>
					<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
						AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
					</if>	 
                     AND A.NA_TR_DSC <![CDATA[<>]]> 'ID01' 
                     AND A.DDLY_YN = '1'
               GROUP BY A.TR_DT,
               			A.NA_SLPNO,
               			A.NA_DVY_PLASH_SLPNO
              ) A, 
              TB_OD_DLVPNSHT_M B
        WHERE A.NA_DVY_PLASH_SLPNO = B.NA_DVY_PLASH_SLPNO(+) 
              AND A.ACTL_BUYPL_NA_TRPL_C = B.SPYPL_NA_TRPL_C(+) 
              AND A.MNGT_NA_TRPL_C = B.DVYAA_NA_TRPL_C(+) 
			  <if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
				  AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}				
			  </if>			
       GROUP BY A.NA_BZPLC,
       			A.NA_TEAM_C,
       			A.SLP_DT,
       			A.NA_SLPNO 
      ORDER BY 
            A.NA_BZPLC,
       		A.NA_TEAM_C,
       		A.SLP_DT,
       		A.NA_SLPNO 
	</select>
	
	<!-- 검수실적-직송별 전표 상품 수수료 합계 엑셀 다운로드 빌링 -->
	<select id="downloadExcelRecadvDdlyCommisionSumBilling" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
	SELECT
		A.NA_BZPLC,
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO
		FROM				
		(SELECT
			A.NA_BZPLC,
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO,
			 NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			,A.NA_DVY_PLASH_SLPNO /*배송예정서번호*/
		FROM TB_BY_BYNG_M A, TB_BY_BYNG_WRS B, TB_OD_TRTWRS C, TB_GD_WRS D, TB_BY_BYNG_FEE E, TB_CM_BZPL F
		WHERE 1=1
			<!-- AND TRIM(A.DDLY_BUYPL_NA_TRPL_C) IS NOT NULL -->
			AND A.NA_BZPLC            = F.NA_BZPLC
			AND A.DDLY_YN = '1' /* 직송여부 1: 여 , 0: 부 */
			AND A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_TEAM_C = B.NA_TEAM_C 
			AND A.SLP_DT = B.SLP_DT
			AND A.NA_SLPNO = B.NA_SLPNO			
			AND B.NA_BZPLC = C.NA_BZPLC
			AND B.NA_WRS_C = C.NA_WRS_C
			AND B.NA_WRS_C = D.NA_WRS_C			
			AND B.NA_BZPLC = E.NA_BZPLC(+)
			AND B.NA_TEAM_C = E.NA_TEAM_C(+)
			AND B.SLP_DT = E.SLP_DT(+)
			AND B.NA_SLPNO = E.NA_SLPNO(+)
			AND B.SLP_SQNO = E.SLP_SQNO(+)
			AND (E.spy_am > 0 OR E.txt_vat > 0 OR E.na_bzplc IS NULL)
			<!-- <![CDATA[ AND ROWNUM <10]]> -->
			AND A.BUYPL_NA_TRPL_C IN
		     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
			</foreach>		
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
			    AND A.slp_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
			    AND A.cnr_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">			    
			    AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
				AND B.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>			
			<when test="TRADE_TYPE == '1'.toString()">
				AND NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
				AND NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
				AND NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND NA_CRC_CAN_DSC = '1') OR (NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND NA_CRC_CAN_DSC IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND NA_CRC_CAN_DSC IN ('2','3')) OR (NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND NA_CRC_CAN_DSC = '1'))
			</when>
		</choose>
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}				
			</if>			
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
				AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
			</if>			
		GROUP BY
			A.NA_BZPLC
	    	,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.BUYPL_NA_TRPL_C
			,A.MNGT_NA_TRPL_C
			,A.NA_DVY_PLASH_SLPNO
			) A
	, TB_TR_TRPL_CIF B
	<!-- , TB_TR_TRPL_CIF C -->
	, TB_OD_DLVPNSHT_M Y
	WHERE 1=1
	AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
	<!-- AND A.DDLY_BUYPL_NA_TRPL_C = C.NA_TRPL_C(+) -->
	AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
	AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
	AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)			
	ORDER BY A.NA_BZPLC , A.NA_TEAM_C, A.SLP_DT, A.NA_SLPNO
	</select>
	
	<!-- 검수실적-직송별 전표 상품 수수료 상세 엑셀 다운로드 빌링 -->
	<select id="downloadExcelRecadvDdlyCommisionDetailBilling" parameterType="java.util.Map" resultType="java.util.Map" fetchSize="1000">
	SELECT
		A.NA_BZPLC,
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO
		FROM
		(	
		SELECT
			A.NA_BZPLC,
			A.NA_TEAM_C,
			A.SLP_DT,
			A.NA_SLPNO,
			 NVL(MIN(CASE WHEN ROTS_CTR_DSC = '4' THEN
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C)<![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			WHEN BZPL_TPC = '504' AND BZPL_DTI_TPC<![CDATA[<>]]>'001' AND A.NA_BZPLC<![CDATA[<>]]>A.DVYAA_NA_TRPL_C THEN
			A.NA_BZPLC
			ELSE
			(CASE WHEN TRIM(A.BUYPL_NA_TRPL_C) <![CDATA[<>]]> TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) AND TRIM(NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')) IS NOT NULL THEN NVL((nvl(A.actl_buypl_na_trpl_c,A.na_bzplc)),' ')
			WHEN TRIM(A.DVYAA_NA_TRPL_C) IS NULL THEN A.NA_BZPLC
			ELSE A.DVYAA_NA_TRPL_C END )
			END),' ' ) AS MNGT_NA_TRPL_C /*실매입처코드*/
			,A.BUYPL_NA_TRPL_C ACTL_BUYPL_NA_TRPL_C /*본지사코드*/
			,A.NA_DVY_PLASH_SLPNO /*배송예정서번호*/
		FROM TB_BY_BYNG_M A, TB_BY_BYNG_WRS B, TB_OD_TRTWRS C, TB_GD_WRS D, TB_BY_BYNG_FEE E, TB_CM_BZPL F
		WHERE 1=1
			<!-- AND TRIM(A.DDLY_BUYPL_NA_TRPL_C) IS NOT NULL -->
			AND A.NA_BZPLC            = F.NA_BZPLC
			AND A.DDLY_YN = '1' /* 직송여부 1: 여 , 0: 부 */
			AND A.NA_BZPLC = B.NA_BZPLC
			AND A.NA_TEAM_C = B.NA_TEAM_C 
			AND A.SLP_DT = B.SLP_DT
			AND A.NA_SLPNO = B.NA_SLPNO			
			AND B.NA_BZPLC = C.NA_BZPLC
			AND B.NA_WRS_C = C.NA_WRS_C
			AND B.NA_WRS_C = D.NA_WRS_C			
			AND B.NA_BZPLC = E.NA_BZPLC(+)
			AND B.NA_TEAM_C = E.NA_TEAM_C(+)
			AND B.SLP_DT = E.SLP_DT(+)
			AND B.NA_SLPNO = E.NA_SLPNO(+)
			AND B.SLP_SQNO = E.SLP_SQNO(+)
			AND (E.spy_am > 0 OR E.txt_vat > 0 OR E.na_bzplc IS NULL)
			<!-- <![CDATA[ AND ROWNUM <10]]> -->
			AND A.BUYPL_NA_TRPL_C IN
		     <foreach collection="srhTrplC" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
			</foreach>		
		<choose>
			<when test="SEARCH_DATE_TYPE == '1'.toString()">
			    AND A.slp_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '2'.toString()">
			    AND A.cnr_dt BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
			<when test="SEARCH_DATE_TYPE == '3'.toString()">			    
			    AND A.RPY_PLA_DT BETWEEN TO_CHAR(TO_DATE(#{FROM_DATE},'YYYYMMDD')-63,'YYYYMMDD') AND #{TO_DATE}
				AND B.RPY_PLA_DT BETWEEN #{FROM_DATE} AND #{TO_DATE}
			</when>
		</choose>
		<choose>			
			<when test="TRADE_TYPE == '1'.toString()">
				AND NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06')
				AND NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '2'.toString()">
				AND NA_TR_DSC IN ('OB01', 'OB03', 'OB04')
				AND NA_CRC_CAN_DSC = '1'
			</when>
			<when test="TRADE_TYPE == '3'.toString()">
				AND ((NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND NA_CRC_CAN_DSC = '1') OR (NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND NA_CRC_CAN_DSC IN ('2','3')))
			</when>
			<when test="TRADE_TYPE == '4'.toString()">
				AND ((NA_TR_DSC IN ('IB01', 'IB03', 'IB04', 'IB06') AND NA_CRC_CAN_DSC IN ('2','3')) OR (NA_TR_DSC IN ('OB01', 'OB03', 'OB04') AND NA_CRC_CAN_DSC = '1'))
			</when>
		</choose>
			<if test="ROTS_CTR_DSC != null and ROTS_CTR_DSC.length() >  0 and ROTS_CTR_DSC != 'all'.toString()">
				AND A.ROTS_CTR_DSC = #{ROTS_CTR_DSC}
			</if>
			<if test="NA_BZPLC != null and NA_BZPLC.length() >  0"> <!-- 물류센터 -->
				AND A.MNGT_NA_TRPL_C = #{NA_BZPLC}				
			</if>			
			<if test="IS_NA_ALL != null and IS_NA_ALL.length() >  0 and IS_NA_ALL == '2'.toString()"> <!-- 실매입처, DVYAA_NA_TRPL_C -->
				AND A.DVYAA_NA_TRPL_C = #{DDLY_BUYPL_NA_TRPL_C}
			</if>
	GROUP BY
			A.NA_BZPLC
	    	,A.NA_TEAM_C
			,A.SLP_DT
			,A.NA_SLPNO
			,A.BUYPL_NA_TRPL_C
			,A.MNGT_NA_TRPL_C
			,A.NA_DVY_PLASH_SLPNO
			) A
	, TB_TR_TRPL_CIF B
	, TB_OD_DLVPNSHT_M Y
	WHERE 1=1
		AND A.MNGT_NA_TRPL_C = B.NA_TRPL_C
		AND A.ACTL_BUYPL_NA_TRPL_C           = Y.SPYPL_NA_TRPL_C (+)
		AND A.MNGT_NA_TRPL_C     = Y.DVYAA_NA_TRPL_C (+)
		AND A.NA_DVY_PLASH_SLPNO  = Y.NA_DVY_PLASH_SLPNO (+)				
	ORDER BY A.NA_BZPLC , A.NA_TEAM_C, A.SLP_DT, A.NA_SLPNO
	</select>
</mapper>